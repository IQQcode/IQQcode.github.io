(window.webpackJsonp=window.webpackJsonp||[]).push([[163],{491:function(s,t,a){"use strict";a.r(t);var n=a(3),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"_1-hashtable"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-hashtable"}},[s._v("#")]),s._v(" 1. Hashtable")]),s._v(" "),t("p",[s._v("é‡é‡çº§é”ï¼Œ"),t("code",[s._v("synchronized")]),s._v("éƒ½æ˜¯åŠ åˆ°äº†æ–¹æ³•ä¸Šï¼Œæ•ˆç‡ä½")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210617200015.png",alt:"c"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210617203816.png",alt:"å½»åº•ææ¸…æ¥šConcurrentHashMapçš„å®ç°åŸç†(å«JDK1.7å’ŒJDK1.8çš„åŒºåˆ«)"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210617200027.png",alt:"image-20200812121435449"}})]),s._v(" "),t("p",[s._v("5å’Œ3æ·»åŠ çš„ä½ç½®ä¸åŒï¼Œä½†æ˜¯ç”±äºæ˜¯é‡é‡çº§é”ï¼Œæ‰€ä»¥5æ— æ³•è·å–é”ï¼Œåªèƒ½ç­‰å¾…")]),s._v(" "),t("ul",[t("li",[s._v("HashTable "),t("strong",[s._v("ä¸å…è®¸")]),s._v(" "),t("code",[s._v("key")]),s._v("å’Œ"),t("code",[s._v("value")]),s._v("ä¸ºnull")]),s._v(" "),t("li",[s._v("ConcurrentHashMap "),t("strong",[s._v("ä¸å…è®¸")]),s._v(" "),t("code",[s._v("key")]),s._v("å’Œ"),t("code",[s._v("value")]),s._v("ä¸ºnull")]),s._v(" "),t("li",[t("strong",[s._v("HashTableæ˜¯çº¿ç¨‹å®‰å…¨çš„")])])]),s._v(" "),t("br"),s._v(" "),t("p",[s._v("åŸºäºè¿™æ ·çš„æ•ˆç‡ä½çš„é—®é¢˜ï¼Œ"),t("strong",[s._v("ConcurrentHashMap")]),s._v("æ¥äº†ã€‚")]),s._v(" "),t("p",[s._v("ä¸»è¦å°±æ˜¯ä¸ºäº†åº”å¯¹HashMapåœ¨å¹¶å‘ç¯å¢ƒä¸‹ä¸å®‰å…¨è€Œè¯ç”Ÿçš„ï¼ŒConcurrentHashMapçš„è®¾è®¡ä¸å®ç°éå¸¸ç²¾å·§ï¼Œå¤§é‡çš„åˆ©ç”¨äº†"),t("code",[s._v("volatile")]),s._v("ï¼Œ"),t("code",[s._v("final")]),s._v("ï¼Œ"),t("strong",[s._v("CAS")]),s._v("ç­‰"),t("strong",[s._v("lock-free")]),s._v("æŠ€æœ¯æ¥å‡å°‘é”ç«äº‰å¯¹äºæ€§èƒ½çš„å½±å“ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("ConcurrentHashMapé¿å…äº†å¯¹å…¨å±€åŠ é”æ”¹æˆäº†å±€éƒ¨åŠ é”æ“ä½œ")]),s._v("ï¼Œè¿™æ ·å°±æå¤§åœ°æé«˜äº†å¹¶å‘ç¯å¢ƒä¸‹çš„æ“ä½œé€Ÿåº¦ï¼Œç”±äºConcurrentHashMapåœ¨JDK1.7å’Œ1.8ä¸­çš„å®ç°éå¸¸ä¸åŒï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è°ˆè°ˆJDKåœ¨1.7å’Œ1.8ä¸­çš„åŒºåˆ«ã€‚")]),s._v(" "),t("h2",{attrs:{id:"_2-hashtableä¸hashmapå¯¹æ¯”"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-hashtableä¸hashmapå¯¹æ¯”"}},[s._v("#")]),s._v(" 2. Hashtableä¸HashMapå¯¹æ¯”")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("**çº¿ç¨‹å®‰å…¨ï¼š**Hashtableçº¿ç¨‹å®‰å…¨")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("å®ç°æ–¹å¼ä¸åŒ")]),s._v("ï¼šHashtable ç»§æ‰¿äº† Dictionaryç±»ï¼Œè€Œ HashMap ç»§æ‰¿çš„æ˜¯ AbstractMap ç±»ã€‚äºŒè€…éƒ½å®ç°äº†Mapæ¥å£")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("åˆå§‹åŒ–å®¹é‡ä¸åŒ")]),s._v("ï¼šHashMap çš„åˆå§‹å®¹é‡ä¸ºï¼š16ï¼ŒHashtable åˆå§‹å®¹é‡ä¸ºï¼š11ï¼Œä¸¤è€…çš„è´Ÿè½½å› å­é»˜è®¤éƒ½æ˜¯ï¼š0.75ã€‚")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("æ‰©å®¹æœºåˆ¶ä¸åŒ")]),s._v("ï¼šå½“ç°æœ‰å®¹é‡å¤§äºæ€»å®¹é‡ * è´Ÿè½½å› å­æ—¶ï¼ŒHashMap æ‰©å®¹è§„åˆ™ä¸ºå½“å‰å®¹é‡ç¿»å€ï¼›Hashtable æ‰©å®¹è§„åˆ™ä¸º"),t("code",[s._v("2N + 1")]),s._v("ã€‚")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("è¿­ä»£å™¨ä¸åŒ")]),s._v("ï¼šHashMap ä¸­çš„ Iterator è¿­ä»£å™¨æ˜¯ "),t("strong",[s._v("fail-fast")]),s._v(" çš„ï¼Œè€Œ Hashtable çš„ Enumerator ä¸æ˜¯ fail-fast çš„ã€‚")]),s._v(" "),t("p",[s._v("æ‰€ä»¥ï¼Œå½“å…¶ä»–çº¿ç¨‹æ”¹å˜äº†HashMap çš„ç»“æ„ï¼Œå¦‚ï¼šå¢åŠ ã€åˆ é™¤å…ƒç´ ï¼Œå°†ä¼šæŠ›å‡º"),t("code",[s._v("ConcurrentModificationException")]),s._v(" å¼‚å¸¸ï¼Œè€Œ Hashtable åˆ™ä¸ä¼šã€‚")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("keyå’Œvalueæ˜¯å¦å…è®¸nullå€¼ï¼š")]),s._v(" Hashtableä¸äºˆè®¸ä¸º"),t("code",[s._v("null-null")]),s._v("ï¼›HashMapåªå…è®¸æœ‰ä¸€ä¸ª")])])]),s._v(" "),t("blockquote",[t("p",[s._v("å½“get()æ–¹æ³•è¿”å›nullå€¼æ—¶ï¼Œå¯èƒ½æ˜¯ HashMapä¸­æ²¡æœ‰è¯¥é”®ï¼Œä¹Ÿå¯èƒ½ä½¿è¯¥é”®æ‰€å¯¹åº”çš„å€¼ä¸ºnullã€‚å› æ­¤ï¼Œåœ¨HashMapä¸­ä¸èƒ½ç”±get()æ–¹æ³•æ¥åˆ¤æ–­HashMapä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªé”®ï¼Œ è€Œåº”è¯¥ç”¨**containsKey()**æ–¹æ³•æ¥åˆ¤æ–­")])]),s._v(" "),t("br"),s._v(" "),t("h2",{attrs:{id:"_3-fail-fastæœºåˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-fail-fastæœºåˆ¶"}},[s._v("#")]),s._v(" 3. fail-fastæœºåˆ¶")]),s._v(" "),t("p",[t("strong",[s._v("Hashtableè¿­ä»£å™¨æä¾›äº†fail-fastæœºåˆ¶")])]),s._v(" "),t("p",[s._v("**å¿«é€Ÿå¤±è´¥ï¼ˆfailâ€”fastï¼‰**æ˜¯javaé›†åˆä¸­çš„ä¸€ç§æœºåˆ¶ï¼Œ åœ¨ç”¨è¿­ä»£å™¨éå†ä¸€ä¸ªé›†åˆå¯¹è±¡æ—¶ï¼Œå¦‚æœéå†è¿‡ç¨‹ä¸­å¯¹é›†åˆå¯¹è±¡çš„å†…å®¹è¿›è¡Œäº†ä¿®æ”¹ï¼ˆå¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹ï¼‰ï¼Œåˆ™ä¼šæŠ›å‡º"),t("code",[s._v("Concurrent Modification Exception")])]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("è¿­ä»£å™¨åœ¨éå†æ—¶ç›´æ¥è®¿é—®é›†åˆä¸­çš„å†…å®¹ï¼Œå¹¶ä¸”åœ¨éå†è¿‡ç¨‹ä¸­ä½¿ç”¨ä¸€ä¸ª "),t("code",[s._v("modCount")]),s._v("å˜é‡ï¼Œé›†åˆåœ¨è¢«éå†æœŸé—´å¦‚æœå†…å®¹å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šæ”¹å˜"),t("code",[s._v("modCount")]),s._v("çš„å€¼ã€‚")]),s._v(" "),t("p",[s._v("æ¯å½“è¿­ä»£å™¨ä½¿ç”¨**hashNext()/next()**éå†ä¸‹ä¸€ä¸ªå…ƒç´ ä¹‹å‰ï¼Œéƒ½ä¼šæ£€æµ‹"),t("code",[s._v("modCount")]),s._v("å˜é‡æ˜¯å¦ç­‰äº"),t("code",[s._v("expectedmodCount")]),s._v("å€¼ï¼Œæ˜¯çš„è¯å°±è¿”å›éå†ï¼›å¦åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œç»ˆæ­¢éå†ã€‚")]),s._v(" "),t("p",[s._v("è¿­ä»£å™¨çš„"),t("code",[s._v("remove")]),s._v("åŒæ­¥äº†"),t("code",[s._v("expectedModCount")]),s._v(" å’Œ"),t("code",[s._v("modCount")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210617200034.png",alt:""}})]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" map "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//Map<String, String> map = new ConcurrentHashMap<>();")]),s._v("\n    map"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    map"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    map"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iterator")]),s._v(" var2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" map"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("keySet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("iterator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("var2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hasNext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" s "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("var2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("next")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("equals")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è°ƒç”¨iteratorçš„remove()")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//map.remove(s);")]),s._v("\n            var2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ä¿è¯äº†modCountå’ŒexceptedModCountç›¸ç­‰")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("blockquote",[t("p",[t("strong",[s._v("Tip")]),s._v("ï¼š**å®‰å…¨å¤±è´¥ï¼ˆfailâ€”safeï¼‰**java.util.concurrentåŒ…ä¸‹çš„å®¹å™¨éƒ½æ˜¯å®‰å…¨å¤±è´¥ï¼Œå¯ä»¥åœ¨å¤šçº¿ç¨‹ä¸‹å¹¶å‘ä½¿ç”¨ï¼Œå¹¶å‘ä¿®æ”¹ã€‚")])]),s._v(" "),t("p",[t("strong",[s._v("JDK-7")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210617200039.png",alt:"img"}})]),s._v(" "),t("p",[t("strong",[s._v("JDK-8")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210617200053.png",alt:"img"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210617200100.png",alt:"image-20201004175151092"}})]),s._v(" "),t("h2",{attrs:{id:"_4-ã€jdk7-åˆ†æ®µé”ã€‘"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-ã€jdk7-åˆ†æ®µé”ã€‘"}},[s._v("#")]),s._v(" 4. ã€JDK7-åˆ†æ®µé”ã€‘")]),s._v(" "),t("p",[s._v("JDK-7 ConcurrentHashMap æ˜¯ç”±ï¼š")]),s._v(" "),t("p",[t("strong",[s._v("Segmentåˆ†æ®µé”ğŸ”’ + HashEntryæ•°ç»„")]),s._v(" ç»„æˆ")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("Segment å®ç°äº† "),t("strong",[s._v("ReentrantLock")]),s._v("å¯é‡å…¥é”ä¿è¯çº¿ç¨‹å®‰å…¨")])]),s._v(" "),t("li",[t("p",[s._v("HashEntry ç”¨äºå­˜å‚¨é”®å€¼å¯¹æ•°æ®ã€‚"),t("strong",[s._v("å½“å¯¹ HashEntry æ•°ç»„çš„æ•°æ®è¿›è¡Œä¿®æ”¹æ—¶ï¼Œå¿…é¡»é¦–å…ˆè·å¾—å¯¹åº”çš„ Segmentçš„é”ã€‚")])])])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210617200113.jpg",alt:"JDK1.7çš„ConcurrentHashMap"}})]),s._v(" "),t("p",[s._v("é¦–å…ˆå°†æ•°æ®åˆ†ä¸ºä¸€æ®µä¸€æ®µçš„å­˜å‚¨ï¼Œç„¶åç»™æ¯ä¸€æ®µæ•°æ®é…ä¸€æŠŠé”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å ç”¨é”è®¿é—®å…¶ä¸­ä¸€ä¸ªæ®µæ•°æ®æ—¶ï¼Œå…¶ä»–æ®µçš„æ•°æ®ä¹Ÿèƒ½è¢«å…¶ä»–çº¿ç¨‹è®¿é—®ã€‚")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210617200122.png",alt:"å½»åº•ææ¸…æ¥šConcurrentHashMapçš„å®ç°åŸç†(å«JDK1.7å’ŒJDK1.8çš„åŒºåˆ«)"}})]),s._v(" "),t("h3",{attrs:{id:"put"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#put"}},[s._v("#")]),s._v(" put")]),s._v(" "),t("ol",[t("li",[s._v("å…ˆå®šä½åˆ°Segmentï¼Œç„¶åå†è¿›è¡Œputæ“ä½œ")]),s._v(" "),t("li",[s._v("å¦‚æœè·å–å¤±è´¥è‚¯å®šå°±æœ‰å…¶ä»–çº¿ç¨‹å­˜åœ¨ç«äº‰ï¼Œåˆ™åˆ©ç”¨ "),t("code",[s._v("scanAndLockForPut()")]),s._v(" "),t("strong",[s._v("è‡ªæ—‹è·å–é”")])]),s._v(" "),t("li",[s._v("å¦‚æœé‡è¯•çš„æ¬¡æ•°è¾¾åˆ°äº† "),t("code",[s._v("MAX_SCAN_RETRIES")]),s._v(" åˆ™æ”¹ä¸º"),t("strong",[s._v("é˜»å¡é”è·å–")]),s._v("ï¼Œä¿è¯èƒ½è·å–æˆåŠŸ")])]),s._v(" "),t("h3",{attrs:{id:"get"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#get"}},[s._v("#")]),s._v(" get")]),s._v(" "),t("p",[s._v("ConcurrentHashMapå®šä½ä¸€ä¸ªå…ƒç´ çš„è¿‡ç¨‹éœ€è¦è¿›è¡Œ"),t("strong",[s._v("ä¸¤æ¬¡Hash")]),s._v("æ“ä½œ")]),s._v(" "),t("ul",[t("li",[s._v("ç¬¬ä¸€æ¬¡å°† Key é€šè¿‡ Hash ä¹‹åå®šä½åˆ°å…·ä½“çš„ Segment")]),s._v(" "),t("li",[s._v("ç¬¬äºŒæ¬¡Hashå®šä½åˆ°å…ƒç´ æ‰€åœ¨çš„"),t("strong",[s._v("é“¾è¡¨çš„å¤´éƒ¨")])])]),s._v(" "),t("h3",{attrs:{id:"è¯¥ç»“æ„çš„ä¼˜åŠ£åŠ¿"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#è¯¥ç»“æ„çš„ä¼˜åŠ£åŠ¿"}},[s._v("#")]),s._v(" è¯¥ç»“æ„çš„ä¼˜åŠ£åŠ¿")]),s._v(" "),t("p",[t("strong",[s._v("ã€åå¤„ã€‘")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("éå†é“¾è¡¨æ•ˆç‡å¾ˆä½")])]),s._v(" "),t("li",[t("p",[s._v("è¿™ä¸€ç§ç»“æ„çš„å¸¦æ¥çš„å‰¯ä½œç”¨æ˜¯Hashçš„è¿‡ç¨‹è¦æ¯”æ™®é€šçš„HashMapè¦é•¿")])])]),s._v(" "),t("p",[t("strong",[s._v("ã€å¥½å¤„ã€‘")])]),s._v(" "),t("p",[s._v("ç”±äº HashEntry ä¸­çš„ value å±æ€§æ˜¯ç”¨ "),t("code",[s._v("volatile")]),s._v("å…³é”®è¯ä¿®é¥°çš„ï¼Œä¿è¯äº†å†…å­˜å¯è§æ€§ï¼Œæ‰€ä»¥æ¯æ¬¡è·å–æ—¶éƒ½æ˜¯æœ€æ–°å€¼")]),s._v(" "),t("p",[s._v("ConcurrentHashMap çš„ get æ–¹æ³•æ˜¯éå¸¸é«˜æ•ˆçš„ï¼Œ"),t("strong",[s._v("å› ä¸ºæ•´ä¸ªè¿‡ç¨‹éƒ½ä¸éœ€è¦åŠ é”")])]),s._v(" "),t("p",[s._v("å¦‚æœå®¹é‡å¤§å°æ˜¯16ï¼Œä»–çš„å¹¶å‘åº¦å°±æ˜¯16ï¼Œå¯ä»¥åŒæ—¶å…è®¸16ä¸ªçº¿ç¨‹æ“ä½œ16ä¸ªSegmentè€Œä¸”è¿˜æ˜¯çº¿ç¨‹å®‰å…¨çš„")]),s._v(" "),t("p",[s._v("æ‰€ä»¥ï¼Œé€šè¿‡è¿™ä¸€ç§ç»“æ„ï¼ŒConcurrentHashMapçš„å¹¶å‘èƒ½åŠ›å¯ä»¥å¤§å¤§çš„æé«˜ã€‚")]),s._v(" "),t("br"),s._v(" "),t("h2",{attrs:{id:"_5-ã€jdk8çš„ä¼˜åŒ–ã€‘"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-ã€jdk8çš„ä¼˜åŒ–ã€‘"}},[s._v("#")]),s._v(" 5. ã€JDK8çš„ä¼˜åŒ–ã€‘")]),s._v(" "),t("p",[s._v("JDK-8çš„ConcurrentHashMap")]),s._v(" "),t("p",[t("strong",[s._v("Node[ ] tableæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("CAS + synchronizedä¿è¯Nodeæ•°ç»„çš„çº¿ç¨‹å®‰å…¨")])]),s._v(" "),t("li",[t("strong",[s._v("Nodeï¼šä¿å­˜keyï¼ŒvalueåŠkeyçš„hashå€¼ã€‚å…¶ä¸­valueå’Œnextéƒ½ç”¨volatileä¿®é¥°ï¼Œä¿è¯å¹¶å‘çš„å¯è§æ€§")])])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210617200138.jpg",alt:"JDK1.8çš„ConcurrentHashMap"}})]),s._v(" "),t("p",[t("strong",[s._v("ä¸HashMapå¾ˆç±»ä¼¼")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210617200143.png",alt:"img"}})]),s._v(" "),t("p",[t("code",[s._v("synchronized")]),s._v("åªé”å®šå½“å‰é“¾è¡¨æˆ–çº¢é»‘äºŒå‰æ ‘çš„"),t("strong",[s._v("é¦–èŠ‚ç‚¹")]),s._v("ï¼Œè¿™æ ·åªè¦"),t("code",[s._v("hash")]),s._v("ä¸å†²çªï¼Œå°±ä¸ä¼šäº§ç”Ÿå¹¶å‘ï¼Œæ•ˆç‡åˆæå‡Nå€ã€‚")]),s._v(" "),t("p",[s._v("æŠŠä¹‹å‰çš„HashEntryæ”¹æˆäº†"),t("strong",[s._v("Node")]),s._v("ï¼Œä½†æ˜¯ä½œç”¨ä¸å˜ï¼ŒæŠŠå€¼å’Œnexté‡‡ç”¨äº†"),t("code",[s._v("volatile")]),s._v("å»ä¿®é¥°ï¼Œä¿è¯äº†å¯è§æ€§ï¼Œå¹¶ä¸”ä¹Ÿå¼•å…¥äº†çº¢é»‘æ ‘ï¼Œåœ¨é“¾è¡¨å¤§äºä¸€å®šå€¼çš„æ—¶å€™ä¼šè½¬æ¢ï¼ˆé»˜è®¤æ˜¯8ï¼‰")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Entry")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" hash"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),s._v(" key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),s._v(" val"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" next"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//... çœç•¥éƒ¨åˆ†ä»£ç ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("é“¾è¡¨ï¼ˆå¯»å€æ—¶é—´å¤æ‚åº¦ä¸ºO(N)ï¼‰ã€çº¢é»‘æ ‘ï¼ˆå¯»å€æ—¶é—´å¤æ‚åº¦ä¸ºO(log(N))ï¼‰")]),s._v(" "),t("h3",{attrs:{id:"put-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#put-2"}},[s._v("#")]),s._v(" put")]),s._v(" "),t("ol",[t("li",[s._v("æ ¹æ® key è®¡ç®—å‡º hashcode")]),s._v(" "),t("li",[s._v("åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œåˆå§‹åŒ–")]),s._v(" "),t("li",[s._v("å½“å‰ key å®šä½å‡º Nodeï¼Œå¦‚æœä¸ºç©ºè¡¨ç¤ºå½“å‰ä½ç½®å¯ä»¥å†™å…¥æ•°æ®ï¼Œåˆ©ç”¨ CAS å°è¯•å†™å…¥ï¼Œå¤±è´¥åˆ™è‡ªæ—‹ä¿è¯æˆåŠŸ")]),s._v(" "),t("li",[s._v("å¦‚æœå½“å‰ä½ç½®çš„ "),t("code",[s._v("hashcode == MOVED == -1")]),s._v("ï¼Œåˆ™éœ€è¦è¿›è¡Œæ‰©å®¹")]),s._v(" "),t("li",[s._v("å¦‚æœéƒ½ä¸æ»¡è¶³ï¼Œåˆ™åˆ©ç”¨ **synchronized **é”å†™å…¥æ•°æ®")]),s._v(" "),t("li",[s._v("å¦‚æœæ•°é‡å¤§äº "),t("code",[s._v("TREEIFY_THRESHOLD")]),s._v(" ï¼Œåˆ™è¦è½¬æ¢ä¸ºçº¢é»‘æ ‘")])]),s._v(" "),t("h3",{attrs:{id:"é”å‡çº§è¿‡ç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é”å‡çº§è¿‡ç¨‹"}},[s._v("#")]),s._v(" é”å‡çº§è¿‡ç¨‹")]),s._v(" "),t("p",[s._v("é’ˆå¯¹ synchronized è·å–é”çš„æ–¹å¼ï¼ŒJVM ä½¿ç”¨äº†é”å‡çº§çš„ä¼˜åŒ–æ–¹å¼ã€‚")]),s._v(" "),t("ol",[t("li",[s._v("å…ˆä½¿ç”¨"),t("strong",[s._v("åå‘é”")]),s._v("ï¼Œä¼˜å…ˆåŒä¸€çº¿ç¨‹è·å–")]),s._v(" "),t("li",[s._v("å¦‚æœå¤±è´¥ï¼Œå°±å‡çº§ä¸º "),t("strong",[s._v("CAS è½»é‡çº§é”")])]),s._v(" "),t("li",[s._v("å¦‚æœå¤±è´¥å°±ä¼šçŸ­æš‚"),t("strong",[s._v("è‡ªæ—‹")]),s._v("ï¼Œé˜²æ­¢çº¿ç¨‹è¢«ç³»ç»ŸæŒ‚èµ·ã€‚")]),s._v(" "),t("li",[s._v("æœ€åå¦‚æœä»¥ä¸Šéƒ½å¤±è´¥å°±å‡çº§ä¸º"),t("strong",[s._v("é‡é‡çº§é”")]),s._v("ã€‚")])]),s._v(" "),t("h3",{attrs:{id:"get-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#get-2"}},[s._v("#")]),s._v(" get")]),s._v(" "),t("ul",[t("li",[s._v("æ ¹æ®è®¡ç®—å‡ºæ¥çš„ hashcode å¯»å€ï¼Œå¦‚æœå°±åœ¨æ¡¶ä¸Šé‚£ä¹ˆç›´æ¥è¿”å›å€¼")]),s._v(" "),t("li",[s._v("å¦‚æœæ˜¯çº¢é»‘æ ‘é‚£å°±æŒ‰ç…§æ ‘çš„æ–¹å¼è·å–å€¼")]),s._v(" "),t("li",[s._v("å°±ä¸æ»¡è¶³é‚£å°±æŒ‰ç…§é“¾è¡¨çš„æ–¹å¼éå†è·å–å€¼")])]),s._v(" "),t("h2",{attrs:{id:"_5-æ„é€ å‚æ•°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-æ„é€ å‚æ•°"}},[s._v("#")]),s._v(" 5. æ„é€ å‚æ•°")]),s._v(" "),t("p",[t("strong",[s._v("ä¾ç„¶æ˜¯2çš„å¹‚æ¬¡æ–¹æ•°")])]),s._v(" "),t("p",[s._v("å¦‚é»˜è®¤ä¼ å…¥32")]),s._v(" "),t("ul",[t("li",[s._v("JDK-7ï¼Œ"),t("code",[s._v("capacity = 32")])]),s._v(" "),t("li",[s._v("JDK8ï¼Œ"),t("code",[s._v("capacity = 64")])])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210617203840.png",alt:"image-20201004162936756"}})]),s._v(" "),t("h2",{attrs:{id:"_6-concurrenthashmapæ€»ç»“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-concurrenthashmapæ€»ç»“"}},[s._v("#")]),s._v(" 6. ConcurrentHashMapæ€»ç»“")]),s._v(" "),t("p",[s._v("JDK-7ç‰ˆæœ¬çš„"),t("strong",[s._v("ReentrantLock + Segment + HashEntry")])]),s._v(" "),t("p",[s._v("JDK-8ç‰ˆæœ¬ä¸­"),t("strong",[s._v("synchronized + CAS + Node + çº¢é»‘æ ‘")])]),s._v(" "),t("p",[t("strong",[s._v("1. æ•°æ®ç»“æ„")]),s._v("ï¼šå–æ¶ˆäº†Segmentåˆ†æ®µé”çš„æ•°æ®ç»“æ„ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘çš„ç»“æ„ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("2. ä¿è¯çº¿ç¨‹å®‰å…¨æœºåˆ¶")]),s._v("ï¼šJDK1.7é‡‡ç”¨segmentçš„åˆ†æ®µé”æœºåˆ¶å®ç°çº¿ç¨‹å®‰å…¨ï¼Œå…¶ä¸­segmentç»§æ‰¿è‡ªReentrantLockã€‚JDK1.8é‡‡ç”¨CAS+Synchronizedä¿è¯çº¿ç¨‹å®‰å…¨ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("3. é”çš„ç²’åº¦")]),s._v("ï¼šåŸæ¥æ˜¯å¯¹éœ€è¦è¿›è¡Œæ•°æ®æ“ä½œçš„SegmentåŠ é”ï¼Œç°è°ƒæ•´ä¸ºå¯¹æ¯ä¸ªæ•°ç»„å…ƒç´ åŠ é”ï¼ˆNodeï¼‰ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("4. é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘")]),s._v(":å®šä½ç»“ç‚¹çš„hashç®—æ³•ç®€åŒ–ä¼šå¸¦æ¥å¼Šç«¯,Hashå†²çªåŠ å‰§,å› æ­¤åœ¨é“¾è¡¨èŠ‚ç‚¹æ•°é‡å¤§äº8æ—¶ï¼Œä¼šå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘è¿›è¡Œå­˜å‚¨ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("5. æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦")]),s._v("ï¼šä»åŸæ¥çš„éå†é“¾è¡¨O(n)ï¼Œå˜æˆéå†çº¢é»‘æ ‘O(logN)ã€‚")])])}),[],!1,null,null,null);t.default=e.exports}}]);