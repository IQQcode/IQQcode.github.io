(window.webpackJsonp=window.webpackJsonp||[]).push([[377],{703:function(t,s,a){"use strict";a.r(s);var n=a(3),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("blockquote",[s("p",[t._v("å‚è€ƒé˜…è¯»ğŸ³"),s("a",{attrs:{href:"http://blog.itpub.net/31556438/viewspace-2662580/",target:"_blank",rel:"noopener noreferrer"}},[t._v("MySQLæ˜¯æ€ä¹ˆä¿è¯æ•°æ®ä¸€è‡´æ€§çš„"),s("OutboundLink")],1)])]),t._v(" "),s("h2",{attrs:{id:"_1-mvccæ˜¯ä»€ä¹ˆ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-mvccæ˜¯ä»€ä¹ˆ"}},[t._v("#")]),t._v(" 1. MVCCæ˜¯ä»€ä¹ˆ")]),t._v(" "),s("p",[t._v("MVCC: Multiversion Concurrency Controlï¼Œç¿»è¯‘ä¸º"),s("strong",[t._v("å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶")]),t._v("ï¼Œå…¶ç›®æ ‡å°±æ˜¯ä¸ºäº†"),s("strong",[t._v("æé«˜æ•°æ®åº“åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹çš„æ€§èƒ½")])]),t._v(" "),s("p",[s("strong",[t._v("ã€åŸç†ã€‘ï¼š")])]),t._v(" "),s("p",[t._v("ç®€å•æ¥è¯´å°±æ˜¯ä¿å­˜æ•°æ®çš„å†å²ç‰ˆæœ¬ï¼Œé€šè¿‡æ¯”è¾ƒç‰ˆæœ¬å·å†³å®šæ•°æ®æ˜¯å¦æ˜¾ç¤ºå‡ºæ¥ã€‚è¯»å–æ•°æ®çš„æ—¶å€™ä¸éœ€è¦åŠ é”å¯ä»¥ä¿è¯äº‹åŠ¡çš„éš”ç¦»æ•ˆæœã€‚")]),t._v(" "),s("p",[s("strong",[t._v("MVCCæœ€å¤§çš„ä¼˜åŠ¿ï¼šè¯»ä¸åŠ é”ï¼Œè¯»å†™ä¸å†²çªã€‚åœ¨è¯»å¤šå†™å°‘çš„åœºæ™¯ä¸‹æå¤§çš„å¢åŠ äº†ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("è¡Œçº§é”çš„å˜ç§ï¼Œå‡å°‘åŠ é”å¸¦æ¥çš„å¼€é”€ï¼ˆç±»æ¯”CASï¼‰")])]),t._v(" "),s("li",[s("p",[t._v("é€‚ç”¨äºè¯»å·²æäº¤ã€å¯é‡å¤è¯»ä¸¤ä¸ªäº‹åŠ¡åœºæ™¯ï¼Œè§£å†³ä¸å¯é‡å¤è¯»å’Œå¹»è¯»é—®é¢˜ï¼ŒMVCC æœºåˆ¶å–ä»£è¡Œé”ï¼Œé™ä½ç³»ç»Ÿå¼€é”€")])])]),t._v(" "),s("h2",{attrs:{id:"_2-mvccè§£å†³ä»€ä¹ˆé—®é¢˜"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-mvccè§£å†³ä»€ä¹ˆé—®é¢˜"}},[t._v("#")]),t._v(" 2. MVCCè§£å†³ä»€ä¹ˆé—®é¢˜")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("è¯»å†™ä¹‹é—´é˜»å¡çš„é—®é¢˜")]),t._v("ã€‚é€šè¿‡ MVCC å¯ä»¥è®©è¯»å†™äº’ç›¸ä¸é˜»å¡ï¼Œè¯»ä¸ç›¸äº’é˜»å¡ï¼Œå†™ä¸é˜»å¡è¯»ï¼Œè¿™æ ·å¯ä»¥æå‡æ•°æ®å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("é™ä½äº†æ­»é”çš„æ¦‚ç‡")]),t._v("ã€‚è¿™ä¸ªæ˜¯å› ä¸º MVCC é‡‡ç”¨äº†ä¹è§‚é”çš„æ–¹å¼ï¼Œè¯»å–æ•°æ®æ—¶ï¼Œä¸éœ€è¦åŠ é”ï¼Œå†™æ“ä½œï¼Œåªéœ€è¦é”å®šå¿…è¦çš„è¡Œã€‚")]),t._v(" "),s("li",[s("strong",[t._v("è§£å†³äº†ä¸€è‡´æ€§è¯»çš„é—®é¢˜")]),t._v("ã€‚å½“æˆ‘ä»¬æœå‘æŸä¸ªæ•°æ®åº“åœ¨æ—¶é—´ç‚¹çš„å¿«ç…§æ˜¯ï¼Œåªèƒ½çœ‹åˆ°è¿™ä¸ªæ—¶é—´ç‚¹ä¹‹å‰äº‹åŠ¡æäº¤æ›´æ–°çš„ç»“æœï¼Œä¸èƒ½çœ‹åˆ°æ—¶é—´ç‚¹ä¹‹åäº‹åŠ¡æäº¤çš„æ›´æ–°ç»“æœ")])]),t._v(" "),s("h3",{attrs:{id:"ä»€ä¹ˆæ˜¯å¿«ç…§è¯»"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯å¿«ç…§è¯»"}},[t._v("#")]),t._v(" ä»€ä¹ˆæ˜¯å¿«ç…§è¯»")]),t._v(" "),s("p",[t._v("å¿«ç…§è¯»ï¼Œè¯»å–çš„æ˜¯"),s("strong",[t._v("å¿«ç…§æ•°æ®")]),t._v("ï¼Œä¸åŠ é”çš„ç®€å• Select éƒ½å±äºå¿«ç…§è¯».")]),t._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("SELECT * FROM player WHERE "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h3",{attrs:{id:"ä»€ä¹ˆæ˜¯å½“å‰è¯»"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯å½“å‰è¯»"}},[t._v("#")]),t._v(" ä»€ä¹ˆæ˜¯å½“å‰è¯»")]),t._v(" "),s("p",[t._v("å½“å‰è¯»å°±æ˜¯è¯»çš„æ˜¯"),s("strong",[t._v("æœ€æ–°æ•°æ®")]),t._v(",è€Œä¸æ˜¯å†å²çš„æ•°æ®ï¼ŒåŠ é”çš„ SELECTï¼Œæˆ–è€…å¯¹æ•°æ®è¿›è¡Œå¢åˆ æ”¹éƒ½ä¼šè¿›è¡Œå½“å‰è¯»ã€‚")]),t._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("SELECT * FROM player LOCK IN SHARE MODE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nSELECT FROM player FOR UPDATE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nINSERT INTO player values "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\nDELETE FROM player WHERE "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\nUPDATE player SET "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("h2",{attrs:{id:"_3-innodb-çš„-mvccå®ç°"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-innodb-çš„-mvccå®ç°"}},[t._v("#")]),t._v(" 3. InnoDB çš„ MVCCå®ç°")]),t._v(" "),s("p",[s("strong",[t._v("äº‹åŠ¡ç‰ˆæœ¬å· + è¡Œè®°å½•ä¸­çš„éšè—åˆ—  + Undo Log")])]),t._v(" "),s("h3",{attrs:{id:"äº‹åŠ¡ç‰ˆæœ¬å·"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#äº‹åŠ¡ç‰ˆæœ¬å·"}},[t._v("#")]),t._v(" äº‹åŠ¡ç‰ˆæœ¬å·")]),t._v(" "),s("p",[t._v("æ¯å¼€å¯ä¸€ä¸ªæ—¥å¿—ï¼Œéƒ½ä¼šä»æ•°æ®åº“ä¸­è·å¾—ä¸€ä¸ªäº‹åŠ¡IDï¼ˆä¹Ÿç§°ä¸ºäº‹åŠ¡ç‰ˆæœ¬å·ï¼‰ï¼Œè¿™ä¸ªäº‹åŠ¡ ID æ˜¯è‡ªå¢çš„ï¼Œé€šè¿‡ ID å¤§å°ï¼Œå¯ä»¥åˆ¤æ–­äº‹åŠ¡çš„æ—¶é—´é¡ºåºã€‚")]),t._v(" "),s("h3",{attrs:{id:"è¡Œè®°å½•çš„éšè—åˆ—"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è¡Œè®°å½•çš„éšè—åˆ—"}},[t._v("#")]),t._v(" è¡Œè®°å½•çš„éšè—åˆ—")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210626232826.png",alt:"image-20201007181210245"}})]),t._v(" "),s("ol",[s("li",[s("code",[t._v("row_id")]),t._v(" ï¼šéšè—çš„è¡Œ ID ï¼Œç”¨æ¥ç”Ÿæˆé»˜è®¤çš„èšé›†ç´¢å¼•ã€‚å¦‚æœåˆ›å»ºæ•°æ®è¡¨æ—¶æ²¡æŒ‡å®šèšé›†ç´¢å¼•ï¼Œè¿™æ—¶ InnoDB å°±ä¼šç”¨è¿™ä¸ªéšè— ID æ¥åˆ›å»ºèšé›†ç´¢å¼•")]),t._v(" "),s("li",[s("code",[t._v("trx_id")]),t._v("ï¼šæ•°æ®äº‹åŠ¡ ID ï¼Œæ¯æ¬¡å¤„ç†åŠ ä¸€")]),t._v(" "),s("li",[s("code",[t._v("roll_ptr")]),t._v("ï¼šå›æ»šæŒ‡é’ˆï¼ŒæŒ‡å‘è¿™ä¸ªè®°å½•çš„ Undo Log ä¿¡æ¯")])]),t._v(" "),s("h3",{attrs:{id:"undo-log"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#undo-log"}},[t._v("#")]),t._v(" Undo Log")]),t._v(" "),s("p",[t._v("InnoDB å°†è¡Œè®°å½•å¿«ç…§ä¿å­˜åœ¨ Undo Log é‡Œ")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210626232830.png",alt:"650"}})]),t._v(" "),s("p",[t._v("æ•°æ®è¡Œé€šè¿‡å¿«ç…§è®°å½•éƒ½é€šè¿‡é“¾è¡¨çš„ç»“æ„çš„ä¸²è”äº†èµ·æ¥ï¼Œæ¯ä¸ªå¿«ç…§éƒ½ä¿å­˜äº† trx_id äº‹åŠ¡IDï¼Œå¦‚æœè¦æ‰¾åˆ°å†å²å¿«ç…§ï¼Œå°±å¯ä»¥é€šè¿‡éå†å›æ»šæŒ‡é’ˆçš„æ–¹å¼è¿›è¡ŒæŸ¥æ‰¾")]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("ã€å‚è€ƒæ–‡ç« ã€‘"),s("a",{attrs:{href:"https://seven.geekfun.club/article/16",target:"_blank",rel:"noopener noreferrer"}},[t._v("MVCCæœºåˆ¶æ€»ç»“"),s("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=r.exports}}]);