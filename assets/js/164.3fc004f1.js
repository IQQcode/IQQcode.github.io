(window.webpackJsonp=window.webpackJsonp||[]).push([[164],{493:function(s,n,a){"use strict";a.r(n);var t=a(3),e=Object(t.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("ğŸ“šæ­é…å®ç”¨"),n("a",{attrs:{href:"https://blog.csdn.net/ZOKEKAI/article/details/90051567?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.channel_param&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.channel_param",target:"_blank",rel:"noopener noreferrer"}},[n("strong",[s._v("ConcurrentHashMap1.8 - æ‰©å®¹è¯¦è§£")]),n("OutboundLink")],1)]),s._v(" "),n("h2",{attrs:{id:"å¸¸è§é—®é¢˜"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#å¸¸è§é—®é¢˜"}},[s._v("#")]),s._v(" å¸¸è§é—®é¢˜")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("è°ˆè°ˆä½ ç†è§£çš„ Hashtableï¼Œè®²è®²å…¶ä¸­çš„ get put è¿‡ç¨‹ã€‚ConcurrentHashMapåŒé—®ã€‚")])]),s._v(" "),n("li",[n("p",[s._v("1.8 åšäº†ä»€ä¹ˆä¼˜åŒ–ï¼Ÿ")])]),s._v(" "),n("li",[n("p",[s._v("çº¿ç¨‹å®‰å…¨æ€ä¹ˆåšçš„ï¼Ÿ")])]),s._v(" "),n("li",[n("p",[s._v("ä¸å®‰å…¨ä¼šå¯¼è‡´å“ªäº›é—®é¢˜ï¼Ÿ")])]),s._v(" "),n("li",[n("p",[s._v("å¦‚ä½•è§£å†³ï¼Ÿæœ‰æ²¡æœ‰çº¿ç¨‹å®‰å…¨çš„å¹¶å‘å®¹å™¨ï¼Ÿ")])]),s._v(" "),n("li",[n("p",[s._v("ConcurrentHashMap æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ")])]),s._v(" "),n("li",[n("p",[s._v("ConcurrentHashMapå¹¶å‘åº¦ä¸ºå•¥å¥½è¿™ä¹ˆå¤šï¼Ÿ")])]),s._v(" "),n("li",[n("p",[s._v("1.7ã€1.8 å®ç°æœ‰ä½•ä¸åŒï¼Ÿä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼Ÿ")])]),s._v(" "),n("li",[n("p",[s._v("CASæ˜¯å•¥ï¼Ÿ")])]),s._v(" "),n("li",[n("p",[s._v("ABAæ˜¯å•¥ï¼Ÿåœºæ™¯æœ‰å“ªäº›ï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ")])]),s._v(" "),n("li",[n("p",[s._v("synchronizedåº•å±‚åŸç†æ˜¯å•¥ï¼Ÿ")])]),s._v(" "),n("li",[n("p",[s._v("synchronizedé”å‡çº§ç­–ç•¥")])]),s._v(" "),n("li",[n("p",[s._v("å¿«é€Ÿå¤±è´¥ï¼ˆfailâ€”fastï¼‰æ˜¯å•¥ï¼Œåº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿå®‰å…¨å¤±è´¥ï¼ˆfailâ€”safeï¼‰")])])]),s._v(" "),n("h2",{attrs:{id:"_1-å‰è¨€"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-å‰è¨€"}},[s._v("#")]),s._v(" 1. å‰è¨€")]),s._v(" "),n("p",[s._v("ConcurrentHashMap ä¸HashMapå’ŒHashtable æœ€å¤§çš„ä¸åŒåœ¨äºï¼šputå’Œ get ä¸¤æ¬¡Hashåˆ°è¾¾æŒ‡å®šçš„HashEntryï¼Œç¬¬ä¸€æ¬¡hashåˆ°è¾¾Segment,ç¬¬äºŒæ¬¡åˆ°è¾¾Segmenté‡Œé¢çš„Entry,ç„¶ååœ¨éå†entryé“¾è¡¨")]),s._v(" "),n("p",[s._v("(1) ä»1.7åˆ°1.8ç‰ˆæœ¬ï¼Œç”±äºHashEntryä»é“¾è¡¨ å˜æˆäº†çº¢é»‘æ ‘æ‰€ä»¥ concurrentHashMapçš„æ—¶é—´å¤æ‚åº¦ä»O(n)åˆ°O(log(n))")]),s._v(" "),n("p",[s._v("(2)  HashEntryæœ€å°çš„å®¹é‡ä¸º2")]),s._v(" "),n("p",[s._v("(3)Segmentçš„åˆå§‹åŒ–å®¹é‡æ˜¯16;")]),s._v(" "),n("p",[s._v("(4)HashEntryåœ¨1.8ä¸­ç§°ä¸ºNode,é“¾è¡¨è½¬çº¢é»‘æ ‘çš„å€¼æ˜¯8 ,å½“Nodeé“¾è¡¨çš„èŠ‚ç‚¹æ•°å¤§äº8æ—¶Nodeä¼šè‡ªåŠ¨è½¬åŒ–ä¸ºTreeNode,ä¼šè½¬æ¢æˆçº¢é»‘æ ‘çš„ç»“æ„")]),s._v(" "),n("h2",{attrs:{id:"_2-æ€»ç»“ä¸æ€è€ƒ"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-æ€»ç»“ä¸æ€è€ƒ"}},[s._v("#")]),s._v(" 2. æ€»ç»“ä¸æ€è€ƒ")]),s._v(" "),n("p",[s._v("å…¶å®å¯ä»¥çœ‹å‡ºJDK1.8ç‰ˆæœ¬çš„ConcurrentHashMapçš„æ•°æ®ç»“æ„å·²ç»æ¥è¿‘HashMapï¼Œç›¸å¯¹è€Œè¨€ï¼ŒConcurrentHashMapåªæ˜¯å¢åŠ äº†åŒæ­¥çš„æ“ä½œæ¥æ§åˆ¶å¹¶å‘ï¼Œä»JDK1.7ç‰ˆæœ¬çš„ReentrantLock+Segment+HashEntryï¼Œåˆ°JDK1.8ç‰ˆæœ¬ä¸­synchronized+CAS+HashEntry+çº¢é»‘æ ‘,ç›¸å¯¹è€Œè¨€ï¼Œæ€»ç»“å¦‚ä¸‹æ€è€ƒ")]),s._v(" "),n("ol",[n("li",[s._v("JDK1.8çš„å®ç°é™ä½é”çš„ç²’åº¦ï¼ŒJDK1.7ç‰ˆæœ¬é”çš„ç²’åº¦æ˜¯åŸºäºSegmentçš„ï¼ŒåŒ…å«å¤šä¸ªHashEntryï¼Œè€ŒJDK1.8é”çš„ç²’åº¦å°±æ˜¯HashEntryï¼ˆé¦–èŠ‚ç‚¹ï¼‰")]),s._v(" "),n("li",[s._v("JDK1.8ç‰ˆæœ¬çš„æ•°æ®ç»“æ„å˜å¾—æ›´åŠ ç®€å•ï¼Œä½¿å¾—æ“ä½œä¹Ÿæ›´åŠ æ¸…æ™°æµç•…ï¼Œå› ä¸ºå·²ç»ä½¿ç”¨synchronizedæ¥è¿›è¡ŒåŒæ­¥ï¼Œæ‰€ä»¥ä¸éœ€è¦åˆ†æ®µé”çš„æ¦‚å¿µï¼Œä¹Ÿå°±ä¸éœ€è¦Segmentè¿™ç§æ•°æ®ç»“æ„äº†ï¼Œç”±äºç²’åº¦çš„é™ä½ï¼Œå®ç°çš„å¤æ‚åº¦ä¹Ÿå¢åŠ äº†")]),s._v(" "),n("li",[s._v("JDK1.8ä½¿ç”¨çº¢é»‘æ ‘æ¥ä¼˜åŒ–é“¾è¡¨ï¼ŒåŸºäºé•¿åº¦å¾ˆé•¿çš„é“¾è¡¨çš„éå†æ˜¯ä¸€ä¸ªå¾ˆæ¼«é•¿çš„è¿‡ç¨‹ï¼Œè€Œçº¢é»‘æ ‘çš„éå†æ•ˆç‡æ˜¯å¾ˆå¿«çš„ï¼Œä»£æ›¿ä¸€å®šé˜ˆå€¼çš„é“¾è¡¨ï¼Œè¿™æ ·å½¢æˆä¸€ä¸ªæœ€ä½³æ‹æ¡£")]),s._v(" "),n("li",[s._v("JDK1.8ä¸ºä»€ä¹ˆä½¿ç”¨å†…ç½®é”synchronizedæ¥ä»£æ›¿é‡å…¥é”ReentrantLockï¼Œæˆ‘è§‰å¾—æœ‰ä»¥ä¸‹å‡ ç‚¹\n"),n("ol",[n("li",[s._v("å› ä¸ºç²’åº¦é™ä½äº†ï¼Œåœ¨ç›¸å¯¹è€Œè¨€çš„ä½ç²’åº¦åŠ é”æ–¹å¼ï¼Œsynchronizedå¹¶ä¸æ¯”ReentrantLockå·®ï¼Œåœ¨ç²—ç²’åº¦åŠ é”ä¸­ReentrantLockå¯èƒ½é€šè¿‡Conditionæ¥æ§åˆ¶å„ä¸ªä½ç²’åº¦çš„è¾¹ç•Œï¼Œæ›´åŠ çš„çµæ´»ï¼Œè€Œåœ¨ä½ç²’åº¦ä¸­ï¼ŒConditionçš„ä¼˜åŠ¿å°±æ²¡æœ‰äº†")]),s._v(" "),n("li",[s._v("JVMçš„å¼€å‘å›¢é˜Ÿä»æ¥éƒ½æ²¡æœ‰æ”¾å¼ƒsynchronizedï¼Œè€Œä¸”åŸºäºJVMçš„synchronizedä¼˜åŒ–ç©ºé—´æ›´å¤§ï¼Œä½¿ç”¨å†…åµŒçš„å…³é”®å­—æ¯”ä½¿ç”¨APIæ›´åŠ è‡ªç„¶")]),s._v(" "),n("li",[s._v("åœ¨å¤§é‡çš„æ•°æ®æ“ä½œä¸‹ï¼Œå¯¹äºJVMçš„å†…å­˜å‹åŠ›ï¼ŒåŸºäºAPIçš„ReentrantLockä¼šå¼€é”€æ›´å¤šçš„å†…å­˜ï¼Œè™½ç„¶ä¸æ˜¯ç“¶é¢ˆï¼Œä½†æ˜¯ä¹Ÿæ˜¯ä¸€ä¸ªé€‰æ‹©ä¾æ®")])])])]),s._v(" "),n("p",[s._v("ä»¥å‰å†™è¿‡ä»‹ç»HashMapçš„æ–‡ç« ï¼Œæ–‡ä¸­æåˆ°è¿‡HashMapåœ¨putçš„æ—¶å€™ï¼Œæ’å…¥çš„å…ƒç´ è¶…è¿‡äº†å®¹é‡ï¼ˆç”±è´Ÿè½½å› å­å†³å®šï¼‰çš„èŒƒå›´å°±ä¼šè§¦å‘æ‰©å®¹æ“ä½œï¼Œå°±æ˜¯rehashï¼Œè¿™ä¸ªä¼šé‡æ–°å°†åŸæ•°ç»„çš„å†…å®¹é‡æ–°hashåˆ°æ–°çš„æ‰©å®¹æ•°ç»„ä¸­ï¼Œåœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œå­˜åœ¨åŒæ—¶å…¶ä»–çš„å…ƒç´ ä¹Ÿåœ¨è¿›è¡Œputæ“ä½œï¼Œå¦‚æœhashå€¼ç›¸åŒï¼Œå¯èƒ½å‡ºç°åŒæ—¶åœ¨åŒä¸€æ•°ç»„ä¸‹ç”¨é“¾è¡¨è¡¨ç¤ºï¼Œé€ æˆé—­ç¯ï¼Œå¯¼è‡´åœ¨getæ—¶ä¼šå‡ºç°æ­»å¾ªç¯ï¼Œæ‰€ä»¥HashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚")]),s._v(" "),n("p",[s._v("æˆ‘ä»¬æ¥äº†è§£å¦ä¸€ä¸ªé”®å€¼å­˜å‚¨é›†åˆHashTableï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå®ƒåœ¨æ‰€æœ‰æ¶‰åŠåˆ°å¤šçº¿ç¨‹æ“ä½œçš„éƒ½åŠ ä¸Šäº†synchronizedå…³é”®å­—æ¥é”ä½æ•´ä¸ªtableï¼Œè¿™å°±æ„å‘³ç€æ‰€æœ‰çš„çº¿ç¨‹éƒ½åœ¨ç«äº‰ä¸€æŠŠé”ï¼Œåœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œå®ƒæ˜¯å®‰å…¨çš„ï¼Œä½†æ˜¯æ— ç–‘æ˜¯æ•ˆç‡ä½ä¸‹çš„ã€‚")]),s._v(" "),n("p",[s._v("å…¶å®HashTableæœ‰å¾ˆå¤šçš„ä¼˜åŒ–ç©ºé—´ï¼Œé”ä½æ•´ä¸ªtableè¿™ä¹ˆç²—æš´çš„æ–¹æ³•å¯ä»¥å˜ç›¸çš„æŸ”å’Œç‚¹ï¼Œæ¯”å¦‚åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œå¯¹ä¸åŒçš„æ•°æ®é›†è¿›è¡Œæ“ä½œæ—¶å…¶å®æ ¹æœ¬å°±ä¸éœ€è¦å»ç«äº‰ä¸€ä¸ªé”ï¼Œå› ä¸ºä»–ä»¬ä¸åŒhashå€¼ï¼Œä¸ä¼šå› ä¸ºrehashé€ æˆçº¿ç¨‹ä¸å®‰å…¨ï¼Œæ‰€ä»¥äº’ä¸å½±å“ï¼Œè¿™å°±æ˜¯é”åˆ†ç¦»æŠ€æœ¯ï¼Œå°†é”çš„ç²’åº¦é™ä½ï¼Œåˆ©ç”¨å¤šä¸ªé”æ¥æ§åˆ¶å¤šä¸ªå°çš„tableï¼Œè¿™å°±æ˜¯è¿™ç¯‡æ–‡ç« çš„ä¸»è§’ConcurrentHashMap JDK1.7ç‰ˆæœ¬çš„æ ¸å¿ƒæ€æƒ³")]),s._v(" "),n("h2",{attrs:{id:"_1-7å®ç°"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-7å®ç°"}},[s._v("#")]),s._v(" 1.7å®ç°")]),s._v(" "),n("p",[s._v("åœ¨JDK1.7ç‰ˆæœ¬ä¸­ï¼ŒConcurrentHashMapçš„æ•°æ®ç»“æ„æ˜¯ç”±ä¸€ä¸ªSegmentæ•°ç»„å’Œå¤šä¸ªHashEntryç»„æˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210617200211.png",alt:"img"}})]),s._v(" "),n("p",[s._v("Segmentæ•°ç»„çš„æ„ä¹‰å°±æ˜¯å°†ä¸€ä¸ªå¤§çš„tableåˆ†å‰²æˆå¤šä¸ªå°çš„tableæ¥è¿›è¡ŒåŠ é”ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„æåˆ°çš„é”åˆ†ç¦»æŠ€æœ¯ï¼Œè€Œæ¯ä¸€ä¸ªSegmentå…ƒç´ å­˜å‚¨çš„æ˜¯HashEntryæ•°ç»„+é“¾è¡¨ï¼Œè¿™ä¸ªå’ŒHashMapçš„æ•°æ®å­˜å‚¨ç»“æ„ä¸€æ ·")]),s._v(" "),n("h4",{attrs:{id:"åˆå§‹åŒ–"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#åˆå§‹åŒ–"}},[s._v("#")]),s._v(" åˆå§‹åŒ–")]),s._v(" "),n("p",[s._v("ConcurrentHashMapçš„åˆå§‹åŒ–æ˜¯ä¼šé€šè¿‡ä½ä¸è¿ç®—æ¥åˆå§‹åŒ–Segmentçš„å¤§å°ï¼Œç”¨ssizeæ¥è¡¨ç¤ºï¼Œæºç å¦‚ä¸‹æ‰€ç¤º")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("private static final int DEFAULT_CONCURRENCY_LEVEL = 16;\nprivate void writeObject(java.io.ObjectOutputStream s)\n        throws java.io.IOException {\n        // For serialization compatibility\n        // Emulate segment calculation from previous version of this class\n        int sshift = 0;\n        int ssize = 1;\n        while (ssize < DEFAULT_CONCURRENCY_LEVEL) {\n            ++sshift;\n            ssize <<= 1;\n        }\n        int segmentShift = 32 - sshift;\n        int segmentMask = ssize - 1;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼šå› ä¸ºssizeç”¨ä½äºè¿ç®—æ¥è®¡ç®—ï¼ˆ"),n("code",[s._v("ssize <<=1")]),s._v("ï¼‰ï¼Œæ‰€ä»¥Segmentçš„å¤§å°å–å€¼éƒ½æ˜¯ä»¥2çš„Næ¬¡æ–¹ï¼Œæ— å…³concurrencyLevelçš„å–å€¼ï¼Œå½“ç„¶concurrencyLevelæœ€å¤§åªèƒ½ç”¨16ä½çš„äºŒè¿›åˆ¶æ¥è¡¨ç¤ºï¼Œå³65536ï¼Œæ¢å¥è¯è¯´ï¼ŒSegmentçš„å¤§å°æœ€å¤š65536ä¸ªï¼Œæ²¡æœ‰æŒ‡å®šconcurrencyLevelå…ƒç´ åˆå§‹åŒ–ï¼Œ"),n("strong",[s._v("Segmentçš„å¤§å°ssizeé»˜è®¤ä¸º")]),s._v(" DEFAULT_CONCURRENCY_LEVEL ="),n("strong",[s._v("16(é˜¿é‡Œé¢è¯•å®˜æ›¾é—®è¿‡)")])]),s._v(" "),n("p",[s._v("æ¯ä¸€ä¸ªSegmentå…ƒç´ ä¸‹çš„HashEntryçš„åˆå§‹åŒ–ä¹Ÿæ˜¯æŒ‰ç…§ä½äºè¿ç®—æ¥è®¡ç®—ï¼Œç”¨capæ¥è¡¨ç¤ºï¼Œå¦‚ä¸‹ï¼š")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("int cap = 1;\nwhile (cap < c)\n    cap <<= 1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("å¦‚ä¸Šæ‰€ç¤ºï¼ŒHashEntryå¤§å°çš„è®¡ç®—ä¹Ÿæ˜¯2çš„Næ¬¡æ–¹ï¼ˆcap <<=1ï¼‰ï¼Œ capçš„åˆå§‹å€¼ä¸º1ï¼Œæ‰€ä»¥HashEntryæœ€å°çš„å®¹é‡ä¸º2")]),s._v(" "),n("h4",{attrs:{id:"putæ“ä½œ"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#putæ“ä½œ"}},[s._v("#")]),s._v(" putæ“ä½œ")]),s._v(" "),n("p",[s._v("å¯¹äºConcurrentHashMapçš„æ•°æ®æ’å…¥ï¼Œè¿™é‡Œè¦"),n("strong",[s._v("è¿›è¡Œä¸¤æ¬¡Hash")]),s._v("å»å®šä½æ•°æ®çš„å­˜å‚¨ä½ç½®")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("   static class Segment<K,V> extends ReentrantLock implements Serializable {\n        private static final long serialVersionUID = 2249069246763182397L;\n        final float loadFactor;\n        Segment(float lf) { this.loadFactor = lf; }\n    }\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("ä»ä¸ŠSegmentçš„ç»§æ‰¿ä½“ç³»å¯ä»¥çœ‹å‡ºï¼ŒSegmentå®ç°äº†ReentrantLock,ä¹Ÿå°±å¸¦æœ‰é”çš„åŠŸèƒ½ï¼Œå½“æ‰§è¡Œputæ“ä½œæ—¶ï¼Œä¼šè¿›è¡Œç¬¬ä¸€æ¬¡keyçš„hashæ¥å®šä½Segmentçš„ä½ç½®ï¼Œå¦‚æœè¯¥Segmentè¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼Œå³é€šè¿‡CASæ“ä½œè¿›è¡Œèµ‹å€¼ï¼Œç„¶åè¿›è¡Œç¬¬äºŒæ¬¡hashæ“ä½œï¼Œæ‰¾åˆ°ç›¸åº”çš„HashEntryçš„ä½ç½®ï¼Œè¿™é‡Œä¼šåˆ©ç”¨ç»§æ‰¿è¿‡æ¥çš„é”çš„ç‰¹æ€§ï¼Œåœ¨å°†æ•°æ®æ’å…¥æŒ‡å®šçš„HashEntryä½ç½®æ—¶ï¼ˆé“¾è¡¨çš„å°¾ç«¯ï¼‰ï¼Œä¼šé€šè¿‡ç»§æ‰¿ReentrantLockçš„tryLockï¼ˆï¼‰æ–¹æ³•å°è¯•å»è·å–é”ï¼Œå¦‚æœè·å–æˆåŠŸå°±ç›´æ¥æ’å…¥ç›¸åº”çš„ä½ç½®ï¼Œå¦‚æœå·²ç»æœ‰çº¿ç¨‹è·å–è¯¥Segmentçš„é”ï¼Œé‚£å½“å‰çº¿ç¨‹ä¼šä»¥"),n("strong",[s._v("è‡ªæ—‹çš„æ–¹å¼(å¦‚æœä¸äº†è§£è‡ªæ—‹é”ï¼Œè¯·å‚è€ƒï¼š")]),n("a",{attrs:{href:"http://www.cnblogs.com/aspirant/p/8746255.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("è‡ªæ—‹é”åŸç†åŠjavaè‡ªæ—‹é”"),n("OutboundLink")],1),s._v("**)**å»ç»§ç»­çš„è°ƒç”¨tryLockï¼ˆï¼‰æ–¹æ³•å»è·å–é”ï¼Œè¶…è¿‡æŒ‡å®šæ¬¡æ•°å°±æŒ‚èµ·ï¼Œç­‰å¾…å”¤é†’ï¼ˆç¾å›¢é¢è¯•å®˜é—®é“çš„ï¼Œå¤šä¸ªçº¿ç¨‹ä¸€èµ·putæ—¶å€™ï¼ŒcurrentHashMapå¦‚ä½•æ“ä½œï¼‰")]),s._v(" "),n("h4",{attrs:{id:"getæ“ä½œ"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#getæ“ä½œ"}},[s._v("#")]),s._v(" getæ“ä½œ")]),s._v(" "),n("p",[s._v("ConcurrentHashMapçš„getæ“ä½œè·ŸHashMapç±»ä¼¼ï¼Œåªæ˜¯ConcurrentHashMapç¬¬ä¸€æ¬¡éœ€è¦ç»è¿‡ä¸€æ¬¡hashå®šä½åˆ°Segmentçš„ä½ç½®ï¼Œç„¶åå†hashå®šä½åˆ°æŒ‡å®šçš„HashEntryï¼Œéå†è¯¥HashEntryä¸‹çš„é“¾è¡¨è¿›è¡Œå¯¹æ¯”ï¼ŒæˆåŠŸå°±è¿”å›ï¼Œä¸æˆåŠŸå°±è¿”å›null")]),s._v(" "),n("h4",{attrs:{id:"sizeæ“ä½œ"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sizeæ“ä½œ"}},[s._v("#")]),s._v(" sizeæ“ä½œ")]),s._v(" "),n("p",[s._v("è®¡ç®—ConcurrentHashMapçš„å…ƒç´ å¤§å°æ˜¯ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ï¼Œå› ä¸ºä»–æ˜¯å¹¶å‘æ“ä½œçš„ï¼Œå°±æ˜¯åœ¨ä½ è®¡ç®—sizeçš„æ—¶å€™ï¼Œä»–è¿˜åœ¨å¹¶å‘çš„æ’å…¥æ•°æ®ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä½ è®¡ç®—å‡ºæ¥çš„sizeå’Œä½ å®é™…çš„sizeæœ‰ç›¸å·®ï¼ˆåœ¨ä½ return sizeçš„æ—¶å€™ï¼Œæ’å…¥äº†å¤šä¸ªæ•°æ®ï¼‰ï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJDK1.7ç‰ˆæœ¬ç”¨ä¸¤ç§æ–¹æ¡ˆ")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("try {\n    for (;;) {\n        if (retries++ == RETRIES_BEFORE_LOCK) {\n            for (int j = 0; j < segments.length; ++j) ensureSegment(j).lock(); // force creation\n        }\n        sum = 0L;\n        size = 0;\n        overflow = false;\n        for (int j = 0; j < segments.length; ++j) {\n            Segment<K,V> seg = segmentAt(segments, j);\n            if (seg != null) { sum += seg.modCount; int c = seg.count; if (c < 0 || (size += c) < 0)\n               overflow = true;\n            } }\n        if (sum == last) break;\n        last = sum; } }\nfinally {\n    if (retries > RETRIES_BEFORE_LOCK) {\n        for (int j = 0; j < segments.length; ++j)\n            segmentAt(segments, j).unlock();\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("p",[s._v("1ã€ç¬¬ä¸€ç§æ–¹æ¡ˆä»–ä¼šä½¿ç”¨ä¸åŠ é”çš„æ¨¡å¼å»å°è¯•å¤šæ¬¡è®¡ç®—ConcurrentHashMapçš„sizeï¼Œæœ€å¤šä¸‰æ¬¡ï¼Œæ¯”è¾ƒå‰åä¸¤æ¬¡è®¡ç®—çš„ç»“æœï¼Œç»“æœä¸€è‡´å°±è®¤ä¸ºå½“å‰æ²¡æœ‰å…ƒç´ åŠ å…¥ï¼Œè®¡ç®—çš„ç»“æœæ˜¯å‡†ç¡®çš„")]),s._v(" "),n("p",[s._v("2ã€ç¬¬äºŒç§æ–¹æ¡ˆæ˜¯å¦‚æœç¬¬ä¸€ç§æ–¹æ¡ˆä¸ç¬¦åˆï¼Œä»–å°±ä¼šç»™æ¯ä¸ªSegmentåŠ ä¸Šé”ï¼Œç„¶åè®¡ç®—ConcurrentHashMapçš„sizeè¿”å›(ç¾å›¢é¢è¯•å®˜çš„é—®é¢˜,å¤šä¸ªçº¿ç¨‹ä¸‹å¦‚ä½•ç¡®å®šsize)")]),s._v(" "),n("h2",{attrs:{id:"jdk1-8çš„ä¼˜åŒ–"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jdk1-8çš„ä¼˜åŒ–"}},[s._v("#")]),s._v(" JDK1.8çš„ä¼˜åŒ–")]),s._v(" "),n("p",[n("strong",[s._v("æ”¹è¿›ä¸€ï¼šå–æ¶ˆsegmentså­—æ®µï¼Œç›´æ¥é‡‡ç”¨transient volatile HashEntry<K,V>[] tableä¿å­˜æ•°æ®ï¼Œé‡‡ç”¨tableæ•°ç»„å…ƒç´ ä½œä¸ºé”ï¼Œä»è€Œå®ç°äº†å¯¹æ¯ä¸€è¡Œæ•°æ®è¿›è¡ŒåŠ é”ï¼Œè¿›ä¸€æ­¥å‡å°‘å¹¶å‘å†²çªçš„æ¦‚ç‡ã€‚")])]),s._v(" "),n("p",[n("strong",[s._v("æ”¹è¿›äºŒï¼šå°†åŸå…ˆtableæ•°ç»„ï¼‹å•å‘é“¾è¡¨çš„æ•°æ®ç»“æ„ï¼Œå˜æ›´ä¸ºtableæ•°ç»„ï¼‹å•å‘é“¾è¡¨ï¼‹çº¢é»‘æ ‘çš„ç»“æ„ã€‚å¯¹äºhashè¡¨æ¥è¯´ï¼Œæœ€æ ¸å¿ƒçš„èƒ½åŠ›åœ¨äºå°†key hashä¹‹åèƒ½å‡åŒ€çš„åˆ†å¸ƒåœ¨æ•°ç»„ä¸­ã€‚å¦‚æœhashä¹‹åæ•£åˆ—çš„å¾ˆå‡åŒ€ï¼Œé‚£ä¹ˆtableæ•°ç»„ä¸­çš„æ¯ä¸ªé˜Ÿåˆ—é•¿åº¦ä¸»è¦ä¸º0æˆ–è€…1ã€‚ä½†å®é™…æƒ…å†µå¹¶éæ€»æ˜¯å¦‚æ­¤ç†æƒ³ï¼Œè™½ç„¶ConcurrentHashMapç±»é»˜è®¤çš„åŠ è½½å› å­ä¸º0.75ï¼Œä½†æ˜¯åœ¨æ•°æ®é‡è¿‡å¤§æˆ–è€…è¿æ°”ä¸ä½³çš„æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯ä¼šå­˜åœ¨ä¸€äº›é˜Ÿåˆ—é•¿åº¦è¿‡é•¿çš„æƒ…å†µï¼Œå¦‚æœè¿˜æ˜¯é‡‡ç”¨å•å‘åˆ—è¡¨æ–¹å¼ï¼Œé‚£ä¹ˆæŸ¥è¯¢æŸä¸ªèŠ‚ç‚¹çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼›å› æ­¤ï¼Œå¯¹äºä¸ªæ•°è¶…è¿‡8(é»˜è®¤å€¼)çš„åˆ—è¡¨ï¼Œjdk1.8ä¸­é‡‡ç”¨äº†çº¢é»‘æ ‘çš„ç»“æ„ï¼Œé‚£ä¹ˆæŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦å¯ä»¥é™ä½åˆ°O(logN)ï¼Œå¯ä»¥æ”¹è¿›æ€§èƒ½ã€‚")])]),s._v(" "),n("p",[s._v("JDK1.8çš„å®ç°å·²ç»æ‘’å¼ƒäº†Segmentçš„æ¦‚å¿µï¼Œè€Œæ˜¯ç›´æ¥ç”¨Nodeæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘çš„æ•°æ®ç»“æ„æ¥å®ç°ï¼Œå¹¶å‘æ§åˆ¶ä½¿ç”¨Synchronizedå’ŒCASæ¥æ“ä½œï¼Œæ•´ä¸ªçœ‹èµ·æ¥å°±åƒæ˜¯ä¼˜åŒ–è¿‡ä¸”çº¿ç¨‹å®‰å…¨çš„HashMapï¼Œè™½ç„¶åœ¨JDK1.8ä¸­è¿˜èƒ½çœ‹åˆ°Segmentçš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯å·²ç»ç®€åŒ–äº†å±æ€§ï¼Œåªæ˜¯ä¸ºäº†å…¼å®¹æ—§ç‰ˆæœ¬")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210617200223.png",alt:"img"}})]),s._v(" "),n("p",[s._v("åœ¨æ·±å…¥JDK1.8çš„putå’Œgetå®ç°ä¹‹å‰è¦çŸ¥é“ä¸€äº›å¸¸é‡è®¾è®¡å’Œæ•°æ®ç»“æ„ï¼Œè¿™äº›æ˜¯æ„æˆConcurrentHashMapå®ç°ç»“æ„çš„åŸºç¡€ï¼Œä¸‹é¢çœ‹ä¸€ä¸‹åŸºæœ¬å±æ€§ï¼š")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// nodeæ•°ç»„æœ€å¤§å®¹é‡ï¼š2^30=1073741824\nprivate static final int MAXIMUM_CAPACITY = 1 << 30;\n// é»˜è®¤åˆå§‹å€¼ï¼Œå¿…é¡»æ˜¯2çš„å¹•æ•°\nprivate static final int DEFAULT_CAPACITY = 16\n//æ•°ç»„å¯èƒ½æœ€å¤§å€¼ï¼Œéœ€è¦ä¸toArrayï¼ˆï¼‰ç›¸å…³æ–¹æ³•å…³è”\nstatic final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;\n//å¹¶å‘çº§åˆ«ï¼Œé—ç•™ä¸‹æ¥çš„ï¼Œä¸ºå…¼å®¹ä»¥å‰çš„ç‰ˆæœ¬\nprivate static final int DEFAULT_CONCURRENCY_LEVEL = 16;\n// è´Ÿè½½å› å­\nprivate static final float LOAD_FACTOR = 0.75f;\n// é“¾è¡¨è½¬çº¢é»‘æ ‘é˜€å€¼,> 8 é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘\nstatic final int TREEIFY_THRESHOLD = 8;\n//æ ‘è½¬é“¾è¡¨é˜€å€¼ï¼Œå°äºç­‰äº6ï¼ˆtranferæ—¶ï¼Œlcã€hc=0ä¸¤ä¸ªè®¡æ•°å™¨åˆ†åˆ«++è®°å½•åŸbinã€æ–°binTreeNodeæ•°é‡ï¼Œ<=UNTREEIFY_THRESHOLD åˆ™untreeify(lo)ï¼‰\nstatic final int UNTREEIFY_THRESHOLD = 6;\nstatic final int MIN_TREEIFY_CAPACITY = 64;\nprivate static final int MIN_TRANSFER_STRIDE = 16;\nprivate static int RESIZE_STAMP_BITS = 16;\n// 2^15-1ï¼Œhelp resizeçš„æœ€å¤§çº¿ç¨‹æ•°\nprivate static final int MAX_RESIZERS = (1 << (32 - RESIZE_STAMP_BITS)) - 1;\n// 32-16=16ï¼ŒsizeCtlä¸­è®°å½•sizeå¤§å°çš„åç§»é‡\nprivate static final int RESIZE_STAMP_SHIFT = 32 - RESIZE_STAMP_BITS;\n// forwarding nodesçš„hashå€¼\nstatic final int MOVED     = -1;\n// æ ‘æ ¹èŠ‚ç‚¹çš„hashå€¼\nstatic final int TREEBIN   = -2;\n// ReservationNodeçš„hashå€¼\nstatic final int RESERVED  = -3;\n// å¯ç”¨å¤„ç†å™¨æ•°é‡\nstatic final int NCPU = Runtime.getRuntime().availableProcessors();\n//å­˜æ”¾nodeçš„æ•°ç»„\ntransient volatile Node<K,V>[] table;\n/*æ§åˆ¶æ ‡è¯†ç¬¦ï¼Œç”¨æ¥æ§åˆ¶tableçš„åˆå§‹åŒ–å’Œæ‰©å®¹çš„æ“ä½œï¼Œä¸åŒçš„å€¼æœ‰ä¸åŒçš„å«ä¹‰\n *å½“ä¸ºè´Ÿæ•°æ—¶ï¼š-1ä»£è¡¨æ­£åœ¨åˆå§‹åŒ–ï¼Œ-Nä»£è¡¨æœ‰N-1ä¸ªçº¿ç¨‹æ­£åœ¨ è¿›è¡Œæ‰©å®¹\n *å½“ä¸º0æ—¶ï¼šä»£è¡¨å½“æ—¶çš„tableè¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–\n *å½“ä¸ºæ­£æ•°æ—¶ï¼šè¡¨ç¤ºåˆå§‹åŒ–æˆ–è€…ä¸‹ä¸€æ¬¡è¿›è¡Œæ‰©å®¹çš„å¤§å°\nprivate transient volatile int sizeCtl;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br")])]),n("p",[s._v("åŸºæœ¬å±æ€§å®šä¹‰äº†ConcurrentHashMapçš„ä¸€äº›è¾¹ç•Œä»¥åŠæ“ä½œæ—¶çš„ä¸€äº›æ§åˆ¶ï¼Œä¸‹é¢çœ‹ä¸€äº›å†…éƒ¨çš„ä¸€äº›ç»“æ„ç»„æˆï¼Œè¿™äº›æ˜¯æ•´ä¸ªConcurrentHashMapæ•´ä¸ªæ•°æ®ç»“æ„çš„æ ¸å¿ƒ")]),s._v(" "),n("h3",{attrs:{id:"node"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#node"}},[s._v("#")]),s._v(" Node")]),s._v(" "),n("p",[s._v("Nodeæ˜¯ConcurrentHashMapå­˜å‚¨ç»“æ„çš„åŸºæœ¬å•å…ƒï¼Œç»§æ‰¿äºHashMapä¸­çš„Entryï¼Œç”¨äºå­˜å‚¨æ•°æ®ï¼Œæºä»£ç å¦‚ä¸‹")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(' static class Node<K,V> implements Map.Entry<K,V> {\n        final int hash;\n        final K key;\n        volatile V val;\n        volatile Node<K,V> next;\n\n        Node(int hash, K key, V val, Node<K,V> next) {\n            this.hash = hash;\n            this.key = key;\n            this.val = val;\n            this.next = next;\n        }\n\n        public final K getKey()       { return key; }\n        public final V getValue()     { return val; }\n        public final int hashCode()   { return key.hashCode() ^ val.hashCode(); }\n        public final String toString(){ return key + "=" + val; }\n        public final V setValue(V value) {\n            throw new UnsupportedOperationException();\n        }\n\n        public final boolean equals(Object o) {\n            Object k, v, u; Map.Entry<?,?> e;\n            return ((o instanceof Map.Entry) &&\n                    (k = (e = (Map.Entry<?,?>)o).getKey()) != null &&\n                    (v = e.getValue()) != null &&\n                    (k == key || k.equals(key)) &&\n                    (v == (u = val) || v.equals(u)));\n        }\n\n        /**\n         * Virtualized support for map.get(); overridden in subclasses.\n         */\n        Node<K,V> find(int h, Object k) {\n            Node<K,V> e = this;\n            if (k != null) {\n                do {\n                    K ek;\n                    if (e.hash == h &&\n                        ((ek = e.key) == k || (ek != null && k.equals(ek))))\n                        return e;\n                } while ((e = e.next) != null);\n            }\n            return null;\n        }\n    }\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br")])]),n("p",[s._v("Nodeæ•°æ®ç»“æ„å¾ˆç®€å•ï¼Œä»ä¸Šå¯çŸ¥ï¼Œå°±æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œä½†æ˜¯åªå…è®¸å¯¹æ•°æ®è¿›è¡ŒæŸ¥æ‰¾ï¼Œä¸å…è®¸è¿›è¡Œä¿®æ”¹")]),s._v(" "),n("h3",{attrs:{id:"treenode"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#treenode"}},[s._v("#")]),s._v(" TreeNode")]),s._v(" "),n("p",[s._v("TreeNodeç»§æ‰¿ä¸Nodeï¼Œä½†æ˜¯æ•°æ®ç»“æ„æ¢æˆäº†äºŒå‰æ ‘ç»“æ„ï¼Œå®ƒæ˜¯çº¢é»‘æ ‘çš„æ•°æ®çš„å­˜å‚¨ç»“æ„ï¼Œç”¨äºçº¢é»‘æ ‘ä¸­å­˜å‚¨æ•°æ®ï¼Œå½“é“¾è¡¨çš„èŠ‚ç‚¹æ•°å¤§äº8æ—¶ä¼šè½¬æ¢æˆçº¢é»‘æ ‘çš„ç»“æ„ï¼Œä»–å°±æ˜¯é€šè¿‡TreeNodeä½œä¸ºå­˜å‚¨ç»“æ„ä»£æ›¿Nodeæ¥è½¬æ¢æˆé»‘çº¢æ ‘æºä»£ç å¦‚ä¸‹")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("  static final class TreeNode<K,V> extends Node<K,V> {\n        TreeNode<K,V> parent;  // red-black tree links\n        TreeNode<K,V> left;\n        TreeNode<K,V> right;\n        TreeNode<K,V> prev;    // needed to unlink next upon deletion\n        boolean red;\n\n        TreeNode(int hash, K key, V val, Node<K,V> next,\n                 TreeNode<K,V> parent) {\n            super(hash, key, val, next);\n            this.parent = parent;\n        }\n\n        Node<K,V> find(int h, Object k) {\n            return findTreeNode(h, k, null);\n        }\n\n        /**\n         * Returns the TreeNode (or null if not found) for the given key\n         * starting at given root.\n         */\n        final TreeNode<K,V> findTreeNode(int h, Object k, Class<?> kc) {\n            if (k != null) {\n                TreeNode<K,V> p = this;\n                do  {\n                    int ph, dir; K pk; TreeNode<K,V> q;\n                    TreeNode<K,V> pl = p.left, pr = p.right;\n                    if ((ph = p.hash) > h)\n                        p = pl;\n                    else if (ph < h)\n                        p = pr;\n                    else if ((pk = p.key) == k || (pk != null && k.equals(pk)))\n                        return p;\n                    else if (pl == null)\n                        p = pr;\n                    else if (pr == null)\n                        p = pl;\n                    else if ((kc != null ||\n                              (kc = comparableClassFor(k)) != null) &&\n                             (dir = compareComparables(kc, k, pk)) != 0)\n                        p = (dir < 0) ? pl : pr;\n                    else if ((q = pr.findTreeNode(h, k, kc)) != null)\n                        return q;\n                    else\n                        p = pl;\n                } while (p != null);\n            }\n            return null;\n        }\n    }\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br")])]),n("h3",{attrs:{id:"treebin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#treebin"}},[s._v("#")]),s._v(" TreeBin")]),s._v(" "),n("p",[s._v("TreeBinä»å­—é¢å«ä¹‰ä¸­å¯ä»¥ç†è§£ä¸ºå­˜å‚¨æ ‘å½¢ç»“æ„çš„å®¹å™¨ï¼Œè€Œæ ‘å½¢ç»“æ„å°±æ˜¯æŒ‡TreeNodeï¼Œæ‰€ä»¥TreeBinå°±æ˜¯å°è£…TreeNodeçš„å®¹å™¨ï¼Œå®ƒæä¾›è½¬æ¢é»‘çº¢æ ‘çš„ä¸€äº›æ¡ä»¶å’Œé”çš„æ§åˆ¶ï¼Œéƒ¨åˆ†æºç ç»“æ„å¦‚ä¸‹")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TreeBin")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TreeNode")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TreeNode")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" first"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" waiter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("volatile")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" lockState"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// values for lockState")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("WRITER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// set while holding write lock")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("WAITER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// set when waiting for write lock")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("READER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// increment value for setting read lock")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n         * Tie-breaking utility for ordering insertions when equal\n         * hashCodes and non-comparable. We don't require a total\n         * order, just a consistent insertion rule to maintain\n         * equivalence across rebalancings. Tie-breaking further than\n         * necessary simplifies testing a bit.\n         */")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tieBreakOrder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" b "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("d "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getClass")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n                 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareTo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getClass")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                d "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("identityHashCode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("identityHashCode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("\n                     "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n         * Creates bin with initial set of nodes headed by b.\n         */")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TreeBin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TreeNode")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TREEBIN")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("first "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TreeNode")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" r "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TreeNode")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" x "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" next"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" x "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" x "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" next"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                next "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TreeNode")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("next"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("left "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("right "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("parent "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("red "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    r "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),s._v(" k "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" h "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" kc "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TreeNode")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" p "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" dir"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ph"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),s._v(" pk "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" p"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ph "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" p"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" h"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                            dir "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ph "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" h"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                            dir "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kc "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n                                  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kc "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("comparableClassFor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("\n                                 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dir "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareComparables")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                            dir "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tieBreakOrder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                            "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TreeNode")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" xp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" p"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("p "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dir "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" p"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("left "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" p"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("right"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("parent "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" xp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dir "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                xp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("left "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n                                xp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("right "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                            r "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("balanceInsertion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("root "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("assert")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("checkInvariants")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br")])]),n("p",[s._v("ä»‹ç»äº†ConcurrentHashMapä¸»è¦çš„å±æ€§ä¸å†…éƒ¨çš„æ•°æ®ç»“æ„ï¼Œç°åœ¨é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­ä»¥debugçš„è§†è§’çœ‹çœ‹ConcurrentHashMapçš„å…·ä½“æ“ä½œç»†èŠ‚")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('public class TestConcurrentHashMap{   \n    public static void main(String[] args){\n        ConcurrentHashMap<String,String> map = new ConcurrentHashMap(); //åˆå§‹åŒ–ConcurrentHashMap\n        //æ–°å¢ä¸ªäººä¿¡æ¯\n        map.put("id","1");\n        map.put("name","andy");\n        map.put("sex","ç”·");\n        //è·å–å§“å\n        String name = map.get("name");\n        Assert.assertEquals(name,"andy");\n        //è®¡ç®—å¤§å°\n        int size = map.size();\n        Assert.assertEquals(size,3);\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("æˆ‘ä»¬å…ˆé€šè¿‡"),n("code",[s._v("new ConcurrentHashMap()")]),s._v("æ¥è¿›è¡Œåˆå§‹åŒ–")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConcurrentHashMap")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("ç”±ä¸Šä½ ä¼šå‘ç°ConcurrentHashMapçš„åˆå§‹åŒ–å…¶å®æ˜¯ä¸€ä¸ªç©ºå®ç°ï¼Œå¹¶æ²¡æœ‰åšä»»ä½•äº‹ï¼Œè¿™é‡Œåé¢ä¼šè®²åˆ°ï¼Œ****è¿™ä¹Ÿæ˜¯å’Œå…¶ä»–çš„é›†åˆç±»æœ‰åŒºåˆ«çš„åœ°æ–¹ï¼Œåˆå§‹åŒ–æ“ä½œå¹¶ä¸æ˜¯åœ¨æ„é€ å‡½æ•°å®ç°çš„ï¼Œè€Œæ˜¯åœ¨putæ“ä½œä¸­å®ç°****ï¼Œå½“ç„¶ConcurrentHashMapè¿˜æä¾›äº†å…¶ä»–çš„æ„é€ å‡½æ•°ï¼Œæœ‰æŒ‡å®šå®¹é‡å¤§å°æˆ–è€…æŒ‡å®šè´Ÿè½½å› å­ï¼Œè·ŸHashMapä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸åšä»‹ç»äº†")]),s._v(" "),n("h3",{attrs:{id:"putæ“ä½œ-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#putæ“ä½œ-2"}},[s._v("#")]),s._v(" putæ“ä½œ")]),s._v(" "),n("p",[s._v("åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­æˆ‘ä»¬æ–°å¢ä¸ªäººä¿¡æ¯ä¼šè°ƒç”¨putæ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),s._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),s._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("putVal")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/** Implementation for put and putIfAbsent */")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("putVal")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),s._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),s._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" onlyIfAbsent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" value "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NullPointerException")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" hash "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("spread")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("hashCode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ä¸¤æ¬¡hashï¼Œå‡å°‘hashå†²çªï¼Œå¯ä»¥å‡åŒ€åˆ†å¸ƒ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" binCount "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" tab "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" table"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å¯¹è¿™ä¸ªtableè¿›è¡Œè¿­ä»£")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" fh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è¿™é‡Œå°±æ˜¯ä¸Šé¢æ„é€ æ–¹æ³•æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–ï¼Œåœ¨è¿™é‡Œè¿›è¡Œåˆ¤æ–­ï¼Œä¸ºnullå°±è°ƒç”¨initTableè¿›è¡Œåˆå§‹åŒ–ï¼Œå±äºæ‡’æ±‰æ¨¡å¼åˆå§‹åŒ–")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tab "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" tab"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            tab "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("initTable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("f "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tabAt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tab"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" hash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å¦‚æœiä½ç½®æ²¡æœ‰æ•°æ®ï¼Œå°±ç›´æ¥æ— é”æ’å…¥")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("casTabAt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tab"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                         "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// no lock when adding to empty bin")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fh "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MOVED")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å¦‚æœåœ¨è¿›è¡Œæ‰©å®¹ï¼Œåˆ™å…ˆè¿›è¡Œæ‰©å®¹æ“ä½œ")]),s._v("\n            tab "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("helpTransfer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tab"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),s._v(" oldVal "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å¦‚æœä»¥ä¸Šæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œé‚£å°±è¦è¿›è¡ŒåŠ é”æ“ä½œï¼Œä¹Ÿå°±æ˜¯å­˜åœ¨hashå†²çªï¼Œé”ä½é“¾è¡¨æˆ–è€…çº¢é»‘æ ‘çš„å¤´ç»“ç‚¹")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tabAt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tab"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fh "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è¡¨ç¤ºè¯¥èŠ‚ç‚¹æ˜¯é“¾è¡¨ç»“æ„")]),s._v("\n                        binCount "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" e "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v("binCount"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),s._v(" ek"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è¿™é‡Œæ¶‰åŠåˆ°ç›¸åŒçš„keyè¿›è¡Œputå°±ä¼šè¦†ç›–åŸå…ˆçš„value")]),s._v("\n                            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hash "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" hash "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n                                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ek "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" key "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("\n                                 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ek "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("equals")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ek"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                                oldVal "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("val"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("onlyIfAbsent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                    e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("val "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                            "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" pred "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("next"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//æ’å…¥é“¾è¡¨å°¾éƒ¨")]),s._v("\n                                pred"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("next "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                                          value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("f "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("instanceof")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TreeBin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//çº¢é»‘æ ‘ç»“æ„")]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" p"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                        binCount "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//çº¢é»‘æ ‘ç»“æ„æ—‹è½¬æ’å…¥")]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("p "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TreeBin")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("putTreeVal")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                                       value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            oldVal "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" p"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("val"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("onlyIfAbsent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                p"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("val "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("binCount "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//å¦‚æœé“¾è¡¨çš„é•¿åº¦å¤§äº8æ—¶å°±ä¼šè¿›è¡Œçº¢é»‘æ ‘çš„è½¬æ¢")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("binCount "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TREEIFY_THRESHOLD")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("treeifyBin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tab"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("oldVal "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" oldVal"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("addCount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1L")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" binCount"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ç»Ÿè®¡sizeï¼Œå¹¶ä¸”æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br")])]),n("p",[s._v("è¿™ä¸ªputçš„è¿‡ç¨‹å¾ˆæ¸…æ™°ï¼Œå¯¹å½“å‰çš„tableè¿›è¡Œæ— æ¡ä»¶è‡ªå¾ªç¯ç›´åˆ°putæˆåŠŸï¼Œå¯ä»¥åˆ†æˆä»¥ä¸‹å…­æ­¥æµç¨‹æ¥æ¦‚è¿°")]),s._v(" "),n("ol",[n("li",[s._v("å¦‚æœæ²¡æœ‰åˆå§‹åŒ–å°±å…ˆè°ƒç”¨initTableï¼ˆï¼‰æ–¹æ³•æ¥è¿›è¡Œåˆå§‹åŒ–è¿‡ç¨‹")]),s._v(" "),n("li",[s._v("å¦‚æœæ²¡æœ‰hashå†²çªå°±ç›´æ¥CASæ’å…¥")]),s._v(" "),n("li",[s._v("å¦‚æœè¿˜åœ¨è¿›è¡Œæ‰©å®¹æ“ä½œå°±å…ˆè¿›è¡Œæ‰©å®¹")]),s._v(" "),n("li",[s._v("å¦‚æœå­˜åœ¨hashå†²çªï¼Œå°±åŠ é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œè¿™é‡Œæœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯é“¾è¡¨å½¢å¼å°±ç›´æ¥éå†åˆ°å°¾ç«¯æ’å…¥ï¼Œä¸€ç§æ˜¯çº¢é»‘æ ‘å°±æŒ‰ç…§çº¢é»‘æ ‘ç»“æ„æ’å…¥ï¼Œ")]),s._v(" "),n("li",[n("strong",[n("em",[s._v("*æœ€åä¸€ä¸ªå¦‚æœè¯¥é“¾è¡¨çš„æ•°é‡å¤§äºé˜ˆå€¼8ï¼Œå°±è¦å…ˆè½¬æ¢æˆé»‘çº¢æ ‘çš„ç»“æ„ï¼Œbreakå†ä¸€æ¬¡è¿›å…¥å¾ªç¯**"),n("code",[s._v("(é˜¿é‡Œé¢è¯•å®˜é—®é¢˜ï¼Œé»˜è®¤çš„é“¾è¡¨å¤§å°ï¼Œè¶…è¿‡äº†è¿™ä¸ªå€¼å°±ä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘)``;")]),s._v("**")]),s._v("*")])]),s._v(" "),n("li",[s._v("å¦‚æœæ·»åŠ æˆåŠŸå°±è°ƒç”¨addCountï¼ˆï¼‰æ–¹æ³•ç»Ÿè®¡sizeï¼Œå¹¶ä¸”æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹")])]),s._v(" "),n("p",[s._v("ç°åœ¨æˆ‘ä»¬æ¥å¯¹æ¯ä¸€æ­¥çš„ç»†èŠ‚è¿›è¡Œæºç åˆ†æï¼Œåœ¨ç¬¬ä¸€æ­¥ä¸­ï¼Œç¬¦åˆæ¡ä»¶ä¼šè¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹initTableï¼ˆï¼‰æ–¹æ³•")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * Initializes table, using the size recorded in sizeCtl.\n */")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("initTable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" tab"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" sc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tab "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" table"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" tab"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ç©ºçš„tableæ‰èƒ½è¿›å…¥åˆå§‹åŒ–æ“ä½œ")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sc "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sizeCtl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//sizeCtl<0è¡¨ç¤ºå…¶ä»–çº¿ç¨‹å·²ç»åœ¨åˆå§‹åŒ–äº†æˆ–è€…æ‰©å®¹äº†ï¼ŒæŒ‚èµ·å½“å‰çº¿ç¨‹")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("yield")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// lost initialization race; just spin")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("U")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSwapInt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SIZECTL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//CASæ“ä½œSIZECTLä¸º-1ï¼Œè¡¨ç¤ºåˆå§‹åŒ–çŠ¶æ€")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tab "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" table"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" tab"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" n "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sc "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" sc "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DEFAULT_CAPACITY")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@SuppressWarnings")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"unchecked"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" nt "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//åˆå§‹åŒ–")]),s._v("\n                    table "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" tab "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" nt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    sc "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" n "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è®°å½•ä¸‹æ¬¡æ‰©å®¹çš„å¤§å°")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                sizeCtl "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" tab"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("p",[s._v("åœ¨ç¬¬äºŒæ­¥ä¸­æ²¡æœ‰hashå†²çªå°±ç›´æ¥è°ƒç”¨Unsafeçš„æ–¹æ³•CASæ’å…¥è¯¥å…ƒç´ ï¼Œè¿›å…¥ç¬¬ä¸‰æ­¥å¦‚æœå®¹å™¨æ­£åœ¨æ‰©å®¹ï¼Œåˆ™ä¼šè°ƒç”¨helpTransferï¼ˆï¼‰æ–¹æ³•å¸®åŠ©æ‰©å®¹ï¼Œç°åœ¨æˆ‘ä»¬è·Ÿè¿›helpTransferï¼ˆï¼‰æ–¹æ³•çœ‹çœ‹")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("å¸®åŠ©ä»æ—§çš„tableçš„å…ƒç´ å¤åˆ¶åˆ°æ–°çš„tableä¸­\n "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("helpTransfer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" tab"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Node")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" nextTab"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" sc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tab "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("f "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("instanceof")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ForwardingNode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nextTab "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ForwardingNode")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("K")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("nextTable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//æ–°çš„table nextTbaå·²ç»å­˜åœ¨å‰æä¸‹æ‰èƒ½å¸®åŠ©æ‰©å®¹")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" rs "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("resizeStamp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tab"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nextTab "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" nextTable "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" table "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" tab "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n               "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sc "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sizeCtl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sc "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RESIZE_STAMP_SHIFT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" rs "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" sc "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" rs "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("\n                sc "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" rs "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MAX_RESIZERS")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" transferIndex "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("U")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("compareAndSwapInt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SIZECTL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sc "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("transfer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tab"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" nextTab"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//è°ƒç”¨æ‰©å®¹æ–¹æ³•")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" nextTab"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" table"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("p",[s._v("å…¶å®helpTransferï¼ˆï¼‰æ–¹æ³•çš„ç›®çš„å°±æ˜¯è°ƒç”¨å¤šä¸ªå·¥ä½œçº¿ç¨‹ä¸€èµ·å¸®åŠ©è¿›è¡Œæ‰©å®¹ï¼Œè¿™æ ·çš„æ•ˆç‡å°±ä¼šæ›´é«˜ï¼Œè€Œä¸æ˜¯åªæœ‰æ£€æŸ¥åˆ°è¦æ‰©å®¹çš„é‚£ä¸ªçº¿ç¨‹è¿›è¡Œæ‰©å®¹æ“ä½œï¼Œå…¶ä»–çº¿ç¨‹å°±è¦ç­‰å¾…æ‰©å®¹æ“ä½œå®Œæˆæ‰èƒ½å·¥ä½œ")]),s._v(" "),n("p",[s._v("æ—¢ç„¶è¿™é‡Œæ¶‰åŠåˆ°æ‰©å®¹çš„æ“ä½œï¼Œæˆ‘ä»¬ä¹Ÿä¸€èµ·æ¥çœ‹çœ‹æ‰©å®¹æ–¹æ³•transferï¼ˆï¼‰")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('private final void transfer(Node<K,V>[] tab, Node<K,V>[] nextTab) {\n        int n = tab.length, stride;\n        // æ¯æ ¸å¤„ç†çš„é‡å°äº16ï¼Œåˆ™å¼ºåˆ¶èµ‹å€¼16\n        if ((stride = (NCPU > 1) ? (n >>> 3) / NCPU : n) < MIN_TRANSFER_STRIDE)\n            stride = MIN_TRANSFER_STRIDE; // subdivide range\n        if (nextTab == null) {            // initiating\n            try {\n                @SuppressWarnings("unchecked")\n                Node<K,V>[] nt = (Node<K,V>[])new Node<?,?>[n << 1];        //æ„å»ºä¸€ä¸ªnextTableå¯¹è±¡ï¼Œå…¶å®¹é‡ä¸ºåŸæ¥å®¹é‡çš„ä¸¤å€\n                nextTab = nt;\n            } catch (Throwable ex) {      // try to cope with OOME\n                sizeCtl = Integer.MAX_VALUE;\n                return;\n            }\n            nextTable = nextTab;\n            transferIndex = n;\n        }\n        int nextn = nextTab.length;\n        // è¿æ¥ç‚¹æŒ‡é’ˆï¼Œç”¨äºæ ‡å¿—ä½ï¼ˆfwdçš„hashå€¼ä¸º-1ï¼Œfwd.nextTable=nextTabï¼‰\n        ForwardingNode<K,V> fwd = new ForwardingNode<K,V>(nextTab);\n        // å½“advance == trueæ—¶ï¼Œè¡¨æ˜è¯¥èŠ‚ç‚¹å·²ç»å¤„ç†è¿‡äº†\n        boolean advance = true;\n        boolean finishing = false; // to ensure sweep before committing nextTab\n        for (int i = 0, bound = 0;;) {\n            Node<K,V> f; int fh;\n            // æ§åˆ¶ --i ,éå†åŸhashè¡¨ä¸­çš„èŠ‚ç‚¹\n            while (advance) {\n                int nextIndex, nextBound;\n                if (--i >= bound || finishing)\n                    advance = false;\n                else if ((nextIndex = transferIndex) <= 0) {\n                    i = -1;\n                    advance = false;\n                }\n                // ç”¨CASè®¡ç®—å¾—åˆ°çš„transferIndex\n                else if (U.compareAndSwapInt\n                        (this, TRANSFERINDEX, nextIndex,\n                                nextBound = (nextIndex > stride ?\n                                        nextIndex - stride : 0))) {\n                    bound = nextBound;\n                    i = nextIndex - 1;\n                    advance = false;\n                }\n            }\n            if (i < 0 || i >= n || i + n >= nextn) {\n                int sc;\n                // å·²ç»å®Œæˆæ‰€æœ‰èŠ‚ç‚¹å¤åˆ¶äº†\n                if (finishing) {\n                    nextTable = null;\n                    table = nextTab;        // table æŒ‡å‘nextTable\n                    sizeCtl = (n << 1) - (n >>> 1);     // sizeCtlé˜ˆå€¼ä¸ºåŸæ¥çš„1.5å€\n                    return;     // è·³å‡ºæ­»å¾ªç¯ï¼Œ\n                }\n                // CAS æ›´æ‰©å®¹é˜ˆå€¼ï¼Œåœ¨è¿™é‡Œé¢sizectlå€¼å‡ä¸€ï¼Œè¯´æ˜æ–°åŠ å…¥ä¸€ä¸ªçº¿ç¨‹å‚ä¸åˆ°æ‰©å®¹æ“ä½œ\n                if (U.compareAndSwapInt(this, SIZECTL, sc = sizeCtl, sc - 1)) {\n                    if ((sc - 2) != resizeStamp(n) << RESIZE_STAMP_SHIFT)\n                        return;\n                    finishing = advance = true;\n                    i = n; // recheck before commit\n                }\n            }\n            // éå†çš„èŠ‚ç‚¹ä¸ºnullï¼Œåˆ™æ”¾å…¥åˆ°ForwardingNode æŒ‡é’ˆèŠ‚ç‚¹\n            else if ((f = tabAt(tab, i)) == null)\n                advance = casTabAt(tab, i, null, fwd);\n            // f.hash == -1 è¡¨ç¤ºéå†åˆ°äº†ForwardingNodeèŠ‚ç‚¹ï¼Œæ„å‘³ç€è¯¥èŠ‚ç‚¹å·²ç»å¤„ç†è¿‡äº†\n            // è¿™é‡Œæ˜¯æ§åˆ¶å¹¶å‘æ‰©å®¹çš„æ ¸å¿ƒ\n            else if ((fh = f.hash) == MOVED)\n                advance = true; // already processed\n            else {\n                // èŠ‚ç‚¹åŠ é”\n                synchronized (f) {\n                    // èŠ‚ç‚¹å¤åˆ¶å·¥ä½œ\n                    if (tabAt(tab, i) == f) {\n                        Node<K,V> ln, hn;\n                        // fh >= 0 ,è¡¨ç¤ºä¸ºé“¾è¡¨èŠ‚ç‚¹\n                        if (fh >= 0) {\n                            // æ„é€ ä¸¤ä¸ªé“¾è¡¨  ä¸€ä¸ªæ˜¯åŸé“¾è¡¨  å¦ä¸€ä¸ªæ˜¯åŸé“¾è¡¨çš„ååºæ’åˆ—\n                            int runBit = fh & n;\n                            Node<K,V> lastRun = f;\n                            for (Node<K,V> p = f.next; p != null; p = p.next) {\n                                int b = p.hash & n;\n                                if (b != runBit) {\n                                    runBit = b;\n                                    lastRun = p;\n                                }\n                            }\n                            if (runBit == 0) {\n                                ln = lastRun;\n                                hn = null;\n                            }\n                            else {\n                                hn = lastRun;\n                                ln = null;\n                            }\n                            for (Node<K,V> p = f; p != lastRun; p = p.next) {\n                                int ph = p.hash; K pk = p.key; V pv = p.val;\n                                if ((ph & n) == 0)\n                                    ln = new Node<K,V>(ph, pk, pv, ln);\n                                else\n                                    hn = new Node<K,V>(ph, pk, pv, hn);\n                            }\n                            // åœ¨nextTable i ä½ç½®å¤„æ’ä¸Šé“¾è¡¨\n                            setTabAt(nextTab, i, ln);\n                            // åœ¨nextTable i + n ä½ç½®å¤„æ’ä¸Šé“¾è¡¨\n                            setTabAt(nextTab, i + n, hn);\n                            // åœ¨table i ä½ç½®å¤„æ’ä¸ŠForwardingNode è¡¨ç¤ºè¯¥èŠ‚ç‚¹å·²ç»å¤„ç†è¿‡äº†\n                            setTabAt(tab, i, fwd);\n                            // advance = true å¯ä»¥æ‰§è¡Œ--iåŠ¨ä½œï¼Œéå†èŠ‚ç‚¹\n                            advance = true;\n                        }\n                        // å¦‚æœæ˜¯TreeBinï¼Œåˆ™æŒ‰ç…§çº¢é»‘æ ‘è¿›è¡Œå¤„ç†ï¼Œå¤„ç†é€»è¾‘ä¸ä¸Šé¢ä¸€è‡´\n                        else if (f instanceof TreeBin) {\n                            TreeBin<K,V> t = (TreeBin<K,V>)f;\n                            TreeNode<K,V> lo = null, loTail = null;\n                            TreeNode<K,V> hi = null, hiTail = null;\n                            int lc = 0, hc = 0;\n                            for (Node<K,V> e = t.first; e != null; e = e.next) {\n                                int h = e.hash;\n                                TreeNode<K,V> p = new TreeNode<K,V>\n                                        (h, e.key, e.val, null, null);\n                                if ((h & n) == 0) {\n                                    if ((p.prev = loTail) == null)\n                                        lo = p;\n                                    else\n                                        loTail.next = p;\n                                    loTail = p;\n                                    ++lc;\n                                }\n                                else {\n                                    if ((p.prev = hiTail) == null)\n                                        hi = p;\n                                    else\n                                        hiTail.next = p;\n                                    hiTail = p;\n                                    ++hc;\n                                }\n                            }\n                            // æ‰©å®¹åæ ‘èŠ‚ç‚¹ä¸ªæ•°è‹¥<=6ï¼Œå°†æ ‘è½¬é“¾è¡¨\n                            ln = (lc <= UNTREEIFY_THRESHOLD) ? untreeify(lo) :\n                                    (hc != 0) ? new TreeBin<K,V>(lo) : t;\n                            hn = (hc <= UNTREEIFY_THRESHOLD) ? untreeify(hi) :\n                                    (lc != 0) ? new TreeBin<K,V>(hi) : t;\n                            setTabAt(nextTab, i, ln);\n                            setTabAt(nextTab, i + n, hn);\n                            setTabAt(tab, i, fwd);\n                            advance = true;\n                        }\n                    }\n                }\n            }\n        }\n    }\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br"),n("span",{staticClass:"line-number"},[s._v("136")]),n("br"),n("span",{staticClass:"line-number"},[s._v("137")]),n("br"),n("span",{staticClass:"line-number"},[s._v("138")]),n("br"),n("span",{staticClass:"line-number"},[s._v("139")]),n("br"),n("span",{staticClass:"line-number"},[s._v("140")]),n("br"),n("span",{staticClass:"line-number"},[s._v("141")]),n("br"),n("span",{staticClass:"line-number"},[s._v("142")]),n("br"),n("span",{staticClass:"line-number"},[s._v("143")]),n("br"),n("span",{staticClass:"line-number"},[s._v("144")]),n("br"),n("span",{staticClass:"line-number"},[s._v("145")]),n("br"),n("span",{staticClass:"line-number"},[s._v("146")]),n("br"),n("span",{staticClass:"line-number"},[s._v("147")]),n("br"),n("span",{staticClass:"line-number"},[s._v("148")]),n("br"),n("span",{staticClass:"line-number"},[s._v("149")]),n("br"),n("span",{staticClass:"line-number"},[s._v("150")]),n("br"),n("span",{staticClass:"line-number"},[s._v("151")]),n("br"),n("span",{staticClass:"line-number"},[s._v("152")]),n("br")])]),n("p",[s._v("æ‰©å®¹è¿‡ç¨‹æœ‰ç‚¹å¤æ‚ï¼Œè¿™é‡Œä¸»è¦æ¶‰åŠåˆ°å¤šçº¿ç¨‹å¹¶å‘æ‰©å®¹,ForwardingNodeçš„ä½œç”¨å°±æ˜¯æ”¯æŒæ‰©å®¹æ“ä½œï¼Œå°†å·²å¤„ç†çš„èŠ‚ç‚¹å’Œç©ºèŠ‚ç‚¹ç½®ä¸ºForwardingNodeï¼Œå¹¶å‘å¤„ç†æ—¶å¤šä¸ªçº¿ç¨‹ç»è¿‡ForwardingNodeå°±è¡¨ç¤ºå·²ç»éå†äº†ï¼Œå°±å¾€åéå†ï¼Œä¸‹å›¾æ˜¯å¤šçº¿ç¨‹åˆä½œæ‰©å®¹çš„è¿‡ç¨‹ï¼š")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210617200243.png",alt:"img"}})]),s._v(" "),n("p",[s._v("ä»‹ç»å®Œæ‰©å®¹è¿‡ç¨‹ï¼Œæˆ‘ä»¬å†æ¬¡å›åˆ°putæµç¨‹ï¼Œåœ¨ç¬¬å››æ­¥ä¸­æ˜¯å‘é“¾è¡¨æˆ–è€…çº¢é»‘æ ‘é‡ŒåŠ èŠ‚ç‚¹ï¼Œåˆ°ç¬¬äº”æ­¥ï¼Œä¼šè°ƒç”¨treeifyBinï¼ˆï¼‰æ–¹æ³•è¿›è¡Œé“¾è¡¨è½¬çº¢é»‘æ ‘çš„è¿‡ç¨‹")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("private final void treeifyBin(Node<K,V>[] tab, int index) {\n    Node<K,V> b; int n, sc;\n    if (tab != null) {\n        //å¦‚æœæ•´ä¸ªtableçš„æ•°é‡å°äº64ï¼Œå°±æ‰©å®¹è‡³åŸæ¥çš„ä¸€å€ï¼Œä¸è½¬çº¢é»‘æ ‘äº†\n        //å› ä¸ºè¿™ä¸ªé˜ˆå€¼æ‰©å®¹å¯ä»¥å‡å°‘hashå†²çªï¼Œä¸å¿…è¦å»è½¬çº¢é»‘æ ‘\n        if ((n = tab.length) < MIN_TREEIFY_CAPACITY)\n            tryPresize(n << 1);\n        else if ((b = tabAt(tab, index)) != null && b.hash >= 0) {\n            synchronized (b) {\n                if (tabAt(tab, index) == b) {\n                    TreeNode<K,V> hd = null, tl = null;\n                    for (Node<K,V> e = b; e != null; e = e.next) {\n                        //å°è£…æˆTreeNode\n                        TreeNode<K,V> p =\n                            new TreeNode<K,V>(e.hash, e.key, e.val,\n                                              null, null);\n                        if ((p.prev = tl) == null)\n                            hd = p;\n                        else\n                            tl.next = p;\n                        tl = p;\n                    }\n                    //é€šè¿‡TreeBinå¯¹è±¡å¯¹TreeNodeè½¬æ¢æˆçº¢é»‘æ ‘\n                    setTabAt(tab, index, new TreeBin<K,V>(hd));\n                }\n            }\n        }\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("p",[s._v("åˆ°ç¬¬å…­æ­¥è¡¨ç¤ºå·²ç»æ•°æ®åŠ å…¥æˆåŠŸäº†ï¼Œç°åœ¨putè°ƒç”¨addCount()æ–¹æ³•è®¡ç®—ConcurrentHashMapçš„sizeï¼Œåœ¨åŸæ¥çš„åŸºç¡€ä¸ŠåŠ ä¸€ï¼Œç°åœ¨æ¥çœ‹çœ‹addCount()æ–¹æ³•")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("private final void addCount(long x, int check) {\n    CounterCell[] as; long b, s;\n    //æ›´æ–°baseCountï¼Œtableçš„æ•°é‡ï¼ŒcounterCellsè¡¨ç¤ºå…ƒç´ ä¸ªæ•°çš„å˜åŒ–\n    if ((as = counterCells) != null ||\n        !U.compareAndSwapLong(this, BASECOUNT, b = baseCount, s = b + x)) {\n        CounterCell a; long v; int m;\n        boolean uncontended = true;\n        //å¦‚æœå¤šä¸ªçº¿ç¨‹éƒ½åœ¨æ‰§è¡Œï¼Œåˆ™CASå¤±è´¥ï¼Œæ‰§è¡ŒfullAddCountï¼Œå…¨éƒ¨åŠ å…¥count\n        if (as == null || (m = as.length - 1) < 0 ||\n            (a = as[ThreadLocalRandom.getProbe() & m]) == null ||\n            !(uncontended =\n              U.compareAndSwapLong(a, CELLVALUE, v = a.value, v + x))) {\n            fullAddCount(x, uncontended);\n            return;\n        }\n        if (check <= 1)\n            return;\n        s = sumCount();\n    }\n     //check>=0è¡¨ç¤ºéœ€è¦è¿›è¡Œæ‰©å®¹æ“ä½œ\n    if (check >= 0) {\n        Node<K,V>[] tab, nt; int n, sc;\n        while (s >= (long)(sc = sizeCtl) && (tab = table) != null &&\n               (n = tab.length) < MAXIMUM_CAPACITY) {\n            int rs = resizeStamp(n);\n            if (sc < 0) {\n                if ((sc >>> RESIZE_STAMP_SHIFT) != rs || sc == rs + 1 ||\n                    sc == rs + MAX_RESIZERS || (nt = nextTable) == null ||\n                    transferIndex <= 0)\n                    break;\n                if (U.compareAndSwapInt(this, SIZECTL, sc, sc + 1))\n                    transfer(tab, nt);\n            }\n            //å½“å‰çº¿ç¨‹å‘èµ·åº“å“¦å“¦è®©æ“ä½œï¼ŒnextTable=null\n            else if (U.compareAndSwapInt(this, SIZECTL, sc,\n                                         (rs << RESIZE_STAMP_SHIFT) + 2))\n                transfer(tab, null);\n            s = sumCount();\n        }\n    }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br")])]),n("p",[s._v("putçš„æµç¨‹ç°åœ¨å·²ç»åˆ†æå®Œäº†ï¼Œä½ å¯ä»¥ä»ä¸­å‘ç°ï¼Œ****ä»–åœ¨å¹¶å‘å¤„ç†ä¸­ä½¿ç”¨çš„æ˜¯ä¹è§‚é”****ï¼Œå½“æœ‰å†²çªçš„æ—¶å€™æ‰è¿›è¡Œå¹¶å‘å¤„ç†ï¼Œè€Œä¸”æµç¨‹æ­¥éª¤å¾ˆæ¸…æ™°ï¼Œä½†æ˜¯ç»†èŠ‚è®¾è®¡çš„å¾ˆå¤æ‚ï¼Œæ¯•ç«Ÿå¤šçº¿ç¨‹çš„åœºæ™¯ä¹Ÿå¤æ‚")]),s._v(" "),n("h3",{attrs:{id:"getæ“ä½œ-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#getæ“ä½œ-2"}},[s._v("#")]),s._v(" getæ“ä½œ")]),s._v(" "),n("p",[s._v("æˆ‘ä»¬ç°åœ¨è¦å›åˆ°å¼€å§‹çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯¹ä¸ªäººä¿¡æ¯è¿›è¡Œäº†æ–°å¢ä¹‹åï¼Œæˆ‘ä»¬è¦è·å–æ‰€æ–°å¢çš„ä¿¡æ¯ï¼Œä½¿ç”¨String name = map.get(â€œnameâ€)è·å–æ–°å¢çš„nameä¿¡æ¯ï¼Œç°åœ¨æˆ‘ä»¬ä¾æ—§ç”¨debugçš„æ–¹å¼æ¥åˆ†æä¸‹ConcurrentHashMapçš„è·å–æ–¹æ³•get()")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("public V get(Object key) {\n    Node<K,V>[] tab; Node<K,V> e, p; int n, eh; K ek;\n    int h = spread(key.hashCode()); //è®¡ç®—ä¸¤æ¬¡hash\n    if ((tab = table) != null && (n = tab.length) > 0 &&\n        (e = tabAt(tab, (n - 1) & h)) != null) {//è¯»å–é¦–èŠ‚ç‚¹çš„Nodeå…ƒç´ \n        if ((eh = e.hash) == h) { //å¦‚æœè¯¥èŠ‚ç‚¹å°±æ˜¯é¦–èŠ‚ç‚¹å°±è¿”å›\n            if ((ek = e.key) == key || (ek != null && key.equals(ek)))\n                return e.val;\n        }\n        //hashå€¼ä¸ºè´Ÿå€¼è¡¨ç¤ºæ­£åœ¨æ‰©å®¹ï¼Œè¿™ä¸ªæ—¶å€™æŸ¥çš„æ˜¯ForwardingNodeçš„findæ–¹æ³•æ¥å®šä½åˆ°nextTableæ¥\n        //æŸ¥æ‰¾ï¼ŒæŸ¥æ‰¾åˆ°å°±è¿”å›\n        else if (eh < 0)\n            return (p = e.find(h, key)) != null ? p.val : null;\n        while ((e = e.next) != null) {//æ—¢ä¸æ˜¯é¦–èŠ‚ç‚¹ä¹Ÿä¸æ˜¯ForwardingNodeï¼Œé‚£å°±å¾€ä¸‹éå†\n            if (e.hash == h &&\n                ((ek = e.key) == key || (ek != null && key.equals(ek))))\n                return e.val;\n        }\n    }\n    return null;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("p",[s._v("ConcurrentHashMapçš„getæ“ä½œçš„æµç¨‹å¾ˆç®€å•ï¼Œä¹Ÿå¾ˆæ¸…æ™°ï¼Œå¯ä»¥åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤æ¥æè¿°")]),s._v(" "),n("ol",[n("li",[s._v("è®¡ç®—hashå€¼ï¼Œå®šä½åˆ°è¯¥tableç´¢å¼•ä½ç½®ï¼Œå¦‚æœæ˜¯é¦–èŠ‚ç‚¹ç¬¦åˆå°±è¿”å›")]),s._v(" "),n("li",[s._v("å¦‚æœé‡åˆ°æ‰©å®¹çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨æ ‡å¿—æ­£åœ¨æ‰©å®¹èŠ‚ç‚¹ForwardingNodeçš„findæ–¹æ³•ï¼ŒæŸ¥æ‰¾è¯¥èŠ‚ç‚¹ï¼ŒåŒ¹é…å°±è¿”å›")]),s._v(" "),n("li",[s._v("ä»¥ä¸Šéƒ½ä¸ç¬¦åˆçš„è¯ï¼Œå°±å¾€ä¸‹éå†èŠ‚ç‚¹ï¼ŒåŒ¹é…å°±è¿”å›ï¼Œå¦åˆ™æœ€åå°±è¿”å›null")])]),s._v(" "),n("h3",{attrs:{id:"sizeæ“ä½œ-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sizeæ“ä½œ-2"}},[s._v("#")]),s._v(" sizeæ“ä½œ")]),s._v(" "),n("p",[s._v("æœ€åæˆ‘ä»¬æ¥çœ‹ä¸‹ä¾‹å­ä¸­æœ€åè·å–sizeçš„æ–¹å¼int size = map.size();ï¼Œç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸‹size()æ–¹æ³•")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("public int size() {\n    long n = sumCount();\n    return ((n < 0L) ? 0 :\n            (n > (long)Integer.MAX_VALUE) ? Integer.MAX_VALUE :\n            (int)n);\n}\nfinal long sumCount() {\n    CounterCell[] as = counterCells; CounterCell a; //å˜åŒ–çš„æ•°é‡\n    long sum = baseCount;\n    if (as != null) {\n        for (int i = 0; i < as.length; ++i) {\n            if ((a = as[i]) != null)\n                sum += a.value;\n        }\n    }\n    return sum;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("åœ¨JDK1.8ç‰ˆæœ¬ä¸­ï¼Œå¯¹äºsizeçš„è®¡ç®—ï¼Œåœ¨æ‰©å®¹å’ŒaddCount()æ–¹æ³•å°±å·²ç»æœ‰å¤„ç†äº†ï¼Œå¯ä»¥æ³¨æ„ä¸€ä¸‹Putå‡½æ•°ï¼Œé‡Œé¢å°±æœ‰addCount()å‡½æ•°ï¼Œæ—©å°±è®¡ç®—å¥½çš„ï¼Œç„¶åä½ sizeçš„æ—¶å€™ç›´æ¥ç»™ä½ ã€‚JDK1.7æ˜¯åœ¨è°ƒç”¨size()æ–¹æ³•æ‰å»è®¡ç®—ï¼Œå…¶å®åœ¨å¹¶å‘é›†åˆä¸­å»è®¡ç®—sizeæ˜¯æ²¡æœ‰å¤šå¤§çš„æ„ä¹‰çš„ï¼Œå› ä¸ºsizeæ˜¯å®æ—¶åœ¨å˜çš„ï¼Œåªèƒ½è®¡ç®—æŸä¸€åˆ»çš„å¤§å°ï¼Œä½†æ˜¯æŸä¸€åˆ»å¤ªå¿«äº†ï¼Œäººçš„æ„ŸçŸ¥æ˜¯ä¸€ä¸ªæ—¶é—´æ®µï¼Œæ‰€ä»¥å¹¶ä¸æ˜¯å¾ˆç²¾ç¡®")]),s._v(" "),n("br"),s._v(" "),n("br"),s._v(" "),n("hr"),s._v(" "),n("p",[n("strong",[s._v("ã€å‚è€ƒã€‘")])]),s._v(" "),n("ol",[n("li",[n("p",[n("a",{attrs:{href:"http://www.cnblogs.com/everSeeker/p/5601861.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Javaå¹¶å‘ç¼–ç¨‹æ€»ç»“4â€”â€”ConcurrentHashMapåœ¨jdk1.8ä¸­çš„æ”¹è¿›"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"http://www.cnblogs.com/study-everyday/p/6430462.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("ConcurrentHashMapåŸç†åˆ†æï¼ˆ1.7ä¸1.8ï¼‰"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://blog.csdn.net/u010412719/article/details/52145145",target:"_blank",rel:"noopener noreferrer"}},[s._v("ConcurrentHashMap JDK1.8"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://www.jianshu.com/p/e694f1e868ec",target:"_blank",rel:"noopener noreferrer"}},[s._v("è°ˆè°ˆConcurrentHashMap1.7å’Œ1.8çš„ä¸åŒå®ç°"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://my.oschina.net/liuxiaomian/blog/880088",target:"_blank",rel:"noopener noreferrer"}},[s._v("ConcurrentHashMap(JDK1.8)ä¸ºä»€ä¹ˆè¦æ”¾å¼ƒSegment"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"http://cmsblogs.com/?p=2283",target:"_blank",rel:"noopener noreferrer"}},[s._v("J.U.Cä¹‹Javaå¹¶å‘å®¹å™¨ï¼šConcurrentHashMap"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://yq.aliyun.com/articles/68282",target:"_blank",rel:"noopener noreferrer"}},[s._v("jdk1.8çš„HashMapå’ŒConcurrentHashMap"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"http://www.cnblogs.com/L-a-u-r-a/p/8557401.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("concurrenthashmap jdk1.8"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"http://blog.csdn.net/mian_csdn/article/details/70185104",target:"_blank",rel:"noopener noreferrer"}},[s._v("ConcurrentHashMap(JDK1.8)ä¸ºä»€ä¹ˆè¦æ”¾å¼ƒSegment"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"http://www.cnblogs.com/study-everyday/p/6430462.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("ConcurrentHashMapåŸç†åˆ†æï¼ˆ1.7ä¸1.8ï¼‰"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"http://blog.csdn.net/fouy_yun/article/details/77816587",target:"_blank",rel:"noopener noreferrer"}},[s._v("ConcurrentHashMapçš„JDK1.8å®ç°"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"http://www.cnblogs.com/everSeeker/p/5601861.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Javaå¹¶å‘ç¼–ç¨‹æ€»ç»“4â€”â€”ConcurrentHashMapåœ¨jdk1.8ä¸­çš„æ”¹è¿›"),n("OutboundLink")],1)])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"http://blog.csdn.net/qq296398300/article/details/79074239",target:"_blank",rel:"noopener noreferrer"}},[s._v("ã€JAVAç§’ä¼šæŠ€æœ¯ä¹‹ConcurrentHashMapã€‘JDK1.7ä¸JDK1.8æºç åŒºåˆ«"),n("OutboundLink")],1)])])])])}),[],!1,null,null,null);n.default=e.exports}}]);