(window.webpackJsonp=window.webpackJsonp||[]).push([[212],{540:function(s,t,a){"use strict";a.r(t);var n=a(3),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("[TOC]")]),s._v(" "),t("blockquote",[t("p",[s._v("上一节内容回顾 ："),t("a",{attrs:{href:"https://blog.csdn.net/weixin_43232955/article/details/100993871",target:"_blank",rel:"noopener noreferrer"}},[t("strong",[s._v("JVM(一)内存区域与内存溢出异常")]),t("OutboundLink")],1)])]),s._v(" "),t("h3",{attrs:{id:"_1-垃圾回收策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-垃圾回收策略"}},[s._v("#")]),s._v(" 1. 垃圾回收策略")]),s._v(" "),t("p",[s._v("回收 针对的是==线程共享内存(堆，方法区)==")]),s._v(" "),t("p",[t("strong",[s._v("判断对象是否存活？")])]),s._v(" "),t("p",[t("strong",[s._v("a. 引用计数法(Python，C++)")])]),s._v(" "),t("ul",[t("li",[s._v("==给每个对象附加一个引用计数器==，每当有引用指向当前对象时，计数器 +1；每当有引用不再指向当前对象时，计数器 -1")]),s._v(" "),t("li",[s._v('任意时刻，引用计数器值为0的对象，被标记为 =="不在存活"==')]),s._v(" "),t("li",[s._v("缺点 ：无法解决循环引用问题(我中有你，你中有我)")])]),s._v(" "),t("p",[t("strong",[s._v("b. 可达性分析算法(Java，C#)")])]),s._v(" "),t("p",[s._v("核心思想：")]),s._v(" "),t("ul",[t("li",[s._v("通过一系列称为"),t("code",[s._v("GC Roots")]),s._v('对象开始向下搜索，若到指定对象有路可走(即"可达")，认为此对象存活；')]),s._v(" "),t("li",[s._v("若从任意一个"),t("code",[s._v("GC Roots")]),s._v("对象到目标对象均不可达，认为目标对象已经不再存活.")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/20190918204716456.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzIzMjk1NQ==,size_16,color_FFFFFF,t_70",alt:"在这里插入图片描述"}})]),s._v(" "),t("p",[s._v("在Java语言中，可作为"),t("code",[s._v("GC Roots")]),s._v("的对象包含下面几种 :")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("虚拟机栈中的==临时变量==引用的对象")])]),s._v(" "),t("li",[t("p",[s._v("本地方法栈中JNI(Native方法)引用的对象")])]),s._v(" "),t("li",[t("p",[s._v("方法区中类静态变量引用的对象")])]),s._v(" "),t("li",[t("p",[s._v("方法区中常量引用的对象")])])]),s._v(" "),t("h3",{attrs:{id:"_2-引用的扩充"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-引用的扩充"}},[s._v("#")]),s._v(" 2. 引用的扩充")]),s._v(" "),t("p",[s._v("JDK 1.2之后关于引用的扩充：强软弱虚，引用强度依次扩充")]),s._v(" "),t("p",[t("strong",[s._v("强引用 ：")])]),s._v(" "),t("blockquote",[t("p",[s._v("程序中普遍存在的，"),t("code",[s._v("GC Roots")]),s._v("对象所指向的引用都属于强引用")])]),s._v(" "),t("p",[t("code",[s._v("Person per = new Person();")])]),s._v(" "),t("p",[s._v("只要当前对象被任意一个强引用指向，即便内存不够用也不能回收此对象")]),s._v(" "),t("p",[t("strong",[s._v("软引用 ：")])]),s._v(" "),t("blockquote",[t("p",[s._v("有用但不必须的对象（缓存对象）")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("当前内存够用时，不回收对象；")])]),s._v(" "),t("li",[t("p",[s._v("当前内存不够用时，回收对象.")])])]),s._v(" "),t("p",[s._v("JDK 1.2之后用"),t("code",[s._v("SoftReference")]),s._v("来表示软引用")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("   "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Person")]),s._v(" per "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Person")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//必须先创建强引用对象")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SoftReference")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Person")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" softReference "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SoftReference")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("per"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   per "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//该对象指向为空，可以被回收")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("strong",[s._v("弱引用 ：")])]),s._v(" "),t("blockquote",[t("p",[s._v("描述非必须对象，强度若于软引用")])]),s._v(" "),t("ul",[t("li",[s._v("被弱引用指向的对象，只能存活到下次GC之前；")]),s._v(" "),t("li",[s._v("当GC开始时，不管内存是否够用，都会回收被弱引用指向的对象")])]),s._v(" "),t("p",[s._v("JDK 1.2之后用"),t("code",[s._v("WeakReference")]),s._v("来表示弱引用")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Person")]),s._v(" per "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Person")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//必须先创建强引用对象")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WeakReference")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Person")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" weakReference "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WeakReference")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("per"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nper "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("strong",[s._v("虚引用 ：")])]),s._v(" "),t("blockquote",[t("p",[s._v("最弱的引用关系，完全对对象的生存周期不造成影响，并且无法通过虚引用取得对象")])]),s._v(" "),t("p",[s._v("为对象设置虚引用的目的 ：该对象在被GC回收之前由系统发回 回收通知")]),s._v(" "),t("p",[s._v("JDK 1.2之后用"),t("code",[s._v("PhantomReference")]),s._v("来表示虚引用")]),s._v(" "),t("h3",{attrs:{id:"_3-对象的自我拯救"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-对象的自我拯救"}},[s._v("#")]),s._v(" 3. 对象的自我拯救")]),s._v(" "),t("p",[s._v("当一个对象到"),t("code",[s._v("GC Root")]),s._v('不可达时，并不是"当场去世"，而是进行自我拯救')]),s._v(" "),t("p",[t("code",[s._v("finalize()")]),s._v(" "),t("strong",[s._v("对象的一次自我拯救机会")])]),s._v(" "),t("p",[s._v("JVM在进行GC之前，需要判断回收对象所在的类 是否覆写了"),t("code",[s._v("finalize()")]),s._v("？")]),s._v(" "),t("ul",[t("li",[s._v("若没覆写，此对象直接回收")]),s._v(" "),t("li",[s._v("若覆写了"),t("code",[s._v("finalize()")])]),s._v(" "),t("li",[t("ul",[t("li",[t("p",[s._v("若"),t("code",[s._v("finalize()")]),s._v(" ==未被JVM调用==，JVM则会调用"),t("code",[s._v("finalize()")]),s._v(" ；对象在此调用过程中与"),t("code",[s._v("GC Roots")]),s._v("有路可达，此对象不再被回收(自救成功)")])]),s._v(" "),t("li",[t("p",[s._v("若"),t("code",[s._v("finalize()")]),s._v(" ==已被JVM调用==，此对象被回收")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/20190921165610653.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzIzMjk1NQ==,size_16,color_FFFFFF,t_70",alt:"在这里插入图片描述"}})])])])])]),s._v(" "),t("p",[t("strong",[s._v("范例:对象自我拯救")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("iqqcode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Study"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("GCRoots")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("concurrent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * @Author: Mr.Q\n * @Date: 2019-09-05 19:37\n * @Description:finalize()对象的自我拯救\n *\n */")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FinalizeTest")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FinalizeTest")]),s._v(" test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("finalize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"finalize method execute!"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        test "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//test等于当前调用finalize()的对象")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InterruptedException")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        test "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FinalizeTest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        test "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//此时test对象没有被强引用指向，无引用指向")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//JVM检查 是否覆写且调用过finalize()")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//对象在此调用过程中与`GC Roots`有路可走，此对象不再被回收")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("gc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("test "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Now I\'m dead..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"I\'m Alive!"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        test "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//此时无引用指向,可以被垃圾回收")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//JVM检查 覆写且调用过finalize()")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//不再调用finalize(),判断对象死亡")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//finalize() 对象的一次自我拯救机会")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("gc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SECONDS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("test "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Now I\'m dead..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"I\'m Alive!"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//TODO")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/20190921161611774.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzIzMjk1NQ==,size_16,color_FFFFFF,t_70",alt:"在这里插入图片描述"}})]),s._v(" "),t("h3",{attrs:{id:"_4-方法区的回收"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-方法区的回收"}},[s._v("#")]),s._v(" 4. 方法区的回收")]),s._v(" "),t("p",[s._v("方法区回收(永久代回收)------废弃常量和无用类")]),s._v(" "),t("p",[s._v("方法区的GC频率非常低")]),s._v(" "),t("h3",{attrs:{id:"_5-垃圾回收算法-堆上"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-垃圾回收算法-堆上"}},[s._v("#")]),s._v(" 5. 垃圾回收算法(堆上)")]),s._v(" "),t("h4",{attrs:{id:"i-标记清除算法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#i-标记清除算法"}},[s._v("#")]),s._v(" I. 标记清除算法")]),s._v(" "),t("p",[s._v('算法分为"标记"和"清除"两个阶段 :')]),s._v(" "),t("ul",[t("li",[s._v("首先==标记==(根据可达性分析算法来标记)出所有需要回收的对象")]),s._v(" "),t("li",[s._v("在标记完成后统一==回收==所有被标记的对象")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/20190918203534560.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzIzMjk1NQ==,size_16,color_FFFFFF,t_70",alt:"在这里插入图片描述"}})]),s._v(" "),t("p",[t("strong",[s._v("标记-清除")]),s._v("算法的不足主要有两个 :")]),s._v(" "),t("ol",[t("li",[s._v("效率问题 : 标记和清除这两个过程的效率都不高")]),s._v(" "),t("li",[s._v("空间问题 : 标记清除后会==产生大量不连续的内存碎片==，导致"),t("code",[s._v("gc")]),s._v("频繁发生")])]),s._v(" "),t("h4",{attrs:{id:"ii-复制算法-新生代回收算法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ii-复制算法-新生代回收算法"}},[s._v("#")]),s._v(" II. 复制算法(新生代回收算法)")]),s._v(" "),t("p",[t("strong",[s._v("堆")]),s._v("（所有对象和数组对象）")]),s._v(" "),t("ul",[t("li",[s._v('新生代： 对象默认在此区域产生，大部分对象都在此区域，该区域的特点是=="朝生夕死"== (存活率低)')]),s._v(" "),t("li",[s._v("老年代： 存活率高")])]),s._v(" "),t("blockquote",[t("p",[s._v('"复制"算法是为了解决"标记-清理"的效率问题.')]),s._v(" "),t("p",[s._v("它将可用内存按容量划分为大小相等的两块，每次只使用其中的一块。当这块内存需要进行垃圾回收时，会将此区域还存活着的对象"),t("strong",[s._v("复制")]),s._v("到另一块上面，然后再把已经使用过的内存区域一次清理掉")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/20190918203603941.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzIzMjk1NQ==,size_16,color_FFFFFF,t_70",alt:"在这里插入图片描述"}}),s._v("\n这样做虽然提高了回收效率，但是降低了内存的利用率(100%的内区域变成了50%)")]),s._v(" "),t("p",[s._v('新生代中98%的对象都是"朝生夕死"的，所以并不需要按照1 : 1的比例来划分内存空间')]),s._v(" "),t("p",[t("strong",[s._v("而是将内存(新生代内存)分为一块较大的 ==Eden(伊甸区)== 空间和两块较小的 ==Survivor(幸存区)== 空间，每次使用 Eden 和其中一块Survivor（Survivor区域一个称为From区，另一个称为To区域）")])]),s._v(" "),t("blockquote",[t("p",[s._v("画图说明")])]),s._v(" "),t("p",[t("strong",[s._v("HotSpot 实现的复制算法流程如下:")])]),s._v(" "),t("ol",[t("li",[s._v("当"),t("code",[s._v("Eden")]),s._v("区满的时候，会触发第一次"),t("code",[s._v("Minor gc")]),s._v("，把还活着的对象拷贝到"),t("code",[s._v("Survivor From")]),s._v("区，然后清理掉"),t("code",[s._v("Eden")]),s._v("区的所有空间.   当Eden区即将满时，再次触发"),t("code",[s._v("Minor gc")]),s._v("，会扫描"),t("code",[s._v("Eden")]),s._v("区和"),t("code",[s._v("From")]),s._v("区域，对两个区域进行垃圾回收，经过这次回收后还存活的对象，则直接复制到"),t("code",[s._v("To")]),s._v("区域，并将"),t("code",[s._v("Eden")]),s._v("和"),t("code",[s._v("From")]),s._v("区域清空")]),s._v(" "),t("li",[s._v("当后续"),t("code",[s._v("Eden")]),s._v("又发生"),t("code",[s._v("Minor gc")]),s._v("的时候,会对"),t("code",[s._v("Eden")]),s._v("和"),t("code",[s._v("To")]),s._v("区域进行垃圾回收.  存活的对象复制到"),t("code",[s._v("From")]),s._v("区域，并将"),t("code",[s._v("Eden")]),s._v("和"),t("code",[s._v("To")]),s._v("区清空.  之后依次循环")]),s._v(" "),t("li",[s._v("部分对象会在"),t("code",[s._v("From")]),s._v("和"),t("code",[s._v("To")]),s._v("区域中复制来复制去，如此交换15次(由JVM参数MaxTenuringThreshold决定,这个参数默认是15)，最终如果还是存活,就存入到老年代")])]),s._v(" "),t("h4",{attrs:{id:"iii-标记-整理算法-老年代回收算法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#iii-标记-整理算法-老年代回收算法"}},[s._v("#")]),s._v(" III. 标记-整理算法(老年代回收算法)")]),s._v(" "),t("p",[s._v("核心思想相较于标记清除算法------整理阶段先让"),t("strong",[s._v("存活对象向一端移动")]),s._v("，而后清理掉端边界以外的内存")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("Question")]),s._v(" ： 为何老年代不采用复制算法？")]),s._v(" "),t("p",[t("strong",[s._v("Answer")]),s._v(" ：新生代中的绝大多数对象都是朝生夕死，所以每次复制存活的对象较少；而老年代中大部分对象都存活，反复复制反而效率低下")])]),s._v(" "),t("h4",{attrs:{id:"iv-分代收集策略-javagc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#iv-分代收集策略-javagc"}},[s._v("#")]),s._v(" IV. 分代收集策略(JavaGC)")]),s._v(" "),t("p",[s._v("将堆空间分为"),t("strong",[s._v("新生代")]),s._v("（-Xmn）与"),t("strong",[s._v("老年代")]),s._v("（堆的大小 - 新生代）空间，其中新生代采用复制算法，老年代采用标记整理算法")]),s._v(" "),t("p",[t("strong",[s._v("面试题 : 请问了解Minor GC和Full GC么，这两种GC有什么不一样吗？")])]),s._v(" "),t("ol",[t("li",[t("code",[s._v("Minor GC")]),s._v(" 又称为新生代 GC : 指的是发生在新生代的垃圾收集. 因为Java对象大多都具备朝生夕灭的特性，因此 "),t("code",[s._v("Minor GC")]),s._v(" (采用复制算法)非常频繁，一般回收速度也比较快.")]),s._v(" "),t("li",[t("code",[s._v("Full GC")]),s._v(" 又称为 老年代 GC 或者 "),t("code",[s._v("Major GC")]),s._v(" : 指发生在老年代的垃圾收集. 出现了 "),t("code",[s._v("Major GC")]),s._v("，经常会伴随至少一次的 "),t("code",[s._v("Minor GC")]),s._v("(并非绝对，在 "),t("code",[s._v("Parallel Scavenge")]),s._v(" 收集器中就有直接进行 "),t("code",[s._v("Full GC")]),s._v(" 的策略选择过程). "),t("code",[s._v("Major GC")]),s._v(" 的速度一般会比 "),t("code",[s._v("Minor GC")]),s._v(" 慢10倍以上.")])])])}),[],!1,null,null,null);t.default=e.exports}}]);