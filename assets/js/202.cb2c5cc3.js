(window.webpackJsonp=window.webpackJsonp||[]).push([[202],{529:function(s,t,a){"use strict";a.r(t);var n=a(3),r=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[t("strong",[s._v("申明：本文是基于HotSpot来学习说明的。方法区是堆上的一个概念，具体的落地实现是永久代或者元空间，它们都统称方法区。")])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"_1-方法区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-方法区"}},[s._v("#")]),s._v(" 1. 方法区")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200625092209.png",alt:""}})]),s._v(" "),t("p",[s._v("从线程的角度来看运行时数据区：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200703231712.png",alt:""}})]),s._v(" "),t("p",[s._v("创建对象各数据区域的声明：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200703233536.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210621203946.png",alt:"image-20200915095045501"}})]),s._v(" "),t("h3",{attrs:{id:"方法区理解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法区理解"}},[s._v("#")]),s._v(" 方法区理解")]),s._v(" "),t("p",[t("strong",[s._v("元空间、永久代是方法区具体的落地实现。方法区看作是一块独立于Java堆的内存空间，它主要是用来存储所加载的类信息的")])]),s._v(" "),t("blockquote",[t("p",[s._v("👉【oracle官方文档】"),t("a",{attrs:{href:"https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.5.4",target:"_blank",rel:"noopener noreferrer"}},[s._v("The Structure of the Java Virtual Machine"),t("OutboundLink")],1)])]),s._v(" "),t("blockquote",[t("p",[s._v("《Java虚拟机规范》中明确说明：“尽管所有的方法区在逻辑上是属于堆的一部分，但些简单的实现可能"),t("strong",[s._v("不会选择去进行垃圾收集或者进行压缩")]),s._v("”。对HotSpot而言，方法区还有一个别名叫做"),t("strong",[s._v("Non-Heap（非堆）")]),s._v("，的就是要和堆分开。")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("方法区（Method Area）同堆区一样，是各个线程共享的内存区域")])]),s._v(" "),t("li",[t("p",[s._v("方法区和堆区都是在实际的物理内存空间中，可以是不连续的")])]),s._v(" "),t("li",[t("p",[s._v("方法区的大小和堆空间一样可以动态调整或者固定")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("方法区的大小决定了系统可以加载多少个类。")]),s._v(" 如果系统定义的类太多，可能会产生OOM")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("加载了大量的第三方jar包")])]),s._v(" "),t("li",[t("p",[s._v("Tomcat部署的工程过多")])])])])]),s._v(" "),t("blockquote",[t("p",[s._v("JDK7及之前：java.lang.OutOfMemoryError：PermGen  [永久代]")]),s._v(" "),t("p",[s._v("JDK8及之后：java.lang.OutOfMemoryError：Metaspae [元空间]")])]),s._v(" "),t("ul",[t("li",[s._v("关闭JVM就会释放方法区的内存")])]),s._v(" "),t("h3",{attrs:{id:"方法区的演进"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法区的演进"}},[s._v("#")]),s._v(" 方法区的演进")]),s._v(" "),t("p",[s._v("JDK7及以前，习惯上把方法区，称为永久代。JDK8开始，使用元空间取代了永久代。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("使用永久代，更容易导致Java程序更容易OOM。"),t("u",[s._v("永久代仍然使用的是Java虚拟机的内存")])])]),s._v(" "),t("li",[t("p",[s._v("在JDK8中，类的元数据现在存储在"),t("mark",[s._v("本地内存")]),s._v("中，这个空间被称为元空间")])])]),s._v(" "),t("p",[s._v("元空间的本质和永久代类似，都是对JVM规范中方法区的实现。")]),s._v(" "),t("p",[s._v("不过元空间与永久代最大的区别在于："),t("strong",[s._v("元空间不在虚拟机设置的内存中，而是使用本地内存")])]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("【JDK7方法区使用的是"),t("mark",[s._v("虚拟机内存")]),s._v("，同时将静态变量和字符串常量池搬移到了堆上】")]),s._v(" "),t("p",[s._v("Oracle官方文档说明：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200706121408.png",alt:""}})]),s._v(" "),t("blockquote",[t("p",[s._v("👉"),t("a",{attrs:{href:"http://openjdk.java.net/jeps/122",target:"_blank",rel:"noopener noreferrer"}},[s._v("JEP 122: Remove the Permanent Generation"),t("OutboundLink")],1)])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200706113544.png",alt:""}})]),s._v(" "),t("p",[s._v("【JDK8将永久代改为元空间，使用的是本地内存】")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200706113822.png",alt:""}})]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("相对于虚拟机的内存，本地内存空间更大，更不容易出现OOM")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("永久代、元空间二者并不只是名字变了，内部结构也调整了")])])])]),s._v(" "),t("hr"),s._v(" "),t("h3",{attrs:{id:"永久代为什么要被替换为元空间"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#永久代为什么要被替换为元空间"}},[s._v("#")]),s._v(" 永久代为什么要被替换为元空间")]),s._v(" "),t("p",[s._v("【Oracle官方解释】")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200706115628.png",alt:""}})]),s._v(" "),t("p",[s._v("【翻译】这是JRockit和Hotspot聚合工作的一部分。JRockit客户不需要配置永久生成（因为JRockit没有永久代），并且习惯于不配置永久生成。")]),s._v(" "),t("blockquote",[t("p",[s._v("好家伙，这解释果然是通俗易懂。收购了JRockit，为了用户方便，怎么喜欢怎么来呗！别人没有，我也不要了。。。")])]),s._v(" "),t("p",[s._v("【解释】")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("因为永久代使用的是虚拟机的内存，为永久代设置空间大小是很难确定的，而元空间的大小仅受本地内存限制")])]),s._v(" "),t("li",[t("p",[s._v("对永久代进行调优是很困难的")])])]),s._v(" "),t("hr"),s._v(" "),t("h3",{attrs:{id:"方法区的设置与oom"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法区的设置与oom"}},[s._v("#")]),s._v(" 方法区的设置与OOM")]),s._v(" "),t("p",[s._v("元数据区大小可以使用参数"),t("code",[s._v("-XX:MetaspaceSize")]),s._v("和"),t("code",[s._v("-XX:MaxMetaSpaceSize")]),s._v("指定替代永久代原有的两个参数。")]),s._v(" "),t("p",[s._v("默认值依赖于平台。 windows下，"),t("code",[s._v("-XX:MetaspaceSize")]),s._v("是21M，"),t("code",[s._v("-XX:MaxMetaSpaceSize")]),s._v("的值是 -1，即没有限制。")]),s._v(" "),t("p",[s._v("元空间与永久代不同，如果不指定大小，默认情况下，虚拟机会耗尽所有的可用系统内存")]),s._v(" "),t("p",[s._v("如果元数据区发生溢出，虚拟机一样会抛出异常"),t("font",{attrs:{color:"red"}},[s._v("OutOfMemoryError：Metaspace")])],1),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"_2-方法区的内部结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-方法区的内部结构"}},[s._v("#")]),s._v(" 2. 方法区的内部结构")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200704085551.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("类加载器将Class文件加载到内存之后，将类的信息存储到方法区中。")])]),s._v(" "),t("p",[t("strong",[s._v("方法区中存储的内容：")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("类型信息（域信息、方法信息）")])]),s._v(" "),t("li",[t("p",[s._v("运行时常量池")])])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200706142741.png",alt:""}})]),s._v(" "),t("hr"),s._v(" "),t("h3",{attrs:{id:"类型信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#类型信息"}},[s._v("#")]),s._v(" 类型信息")]),s._v(" "),t("p",[s._v("对每个加载的类型（类Class、接口 interface、枚举enum、注解 annotation），JVM必须在方法区中存储以下类型信息：")]),s._v(" "),t("p",[s._v("① 这个类型的完整有效名称（全名 = 包名.类名）")]),s._v(" "),t("p",[s._v("② 这个类型直接父类的完整有效名（对于 interface或是java.lang. Object，都没有父类）")]),s._v(" "),t("p",[s._v("③ 这个类型的修饰符（ public, abstract，final的某个子集）")]),s._v(" "),t("p",[s._v("④ 这个类型直接接口的一个有序列表")]),s._v(" "),t("h3",{attrs:{id:"域信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#域信息"}},[s._v("#")]),s._v(" 域信息")]),s._v(" "),t("p",[t("strong",[s._v("域信息，即为类的属性，成员变量")])]),s._v(" "),t("p",[s._v("JVM必须在方法区中保存类所有的成员变量相关信息及声明顺序。")]),s._v(" "),t("p",[s._v("域的相关信息包括：域名称、域类型、域修饰符（pυblic、private、protected、static、final、volatile、transient的某个子集）")]),s._v(" "),t("h3",{attrs:{id:"方法信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法信息"}},[s._v("#")]),s._v(" 方法信息")]),s._v(" "),t("p",[s._v("JVM必须保存所有方法的以下信息，同域信息一样包括声明顺序：")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("方法名称方法的返回类型（或void）")])]),s._v(" "),t("li",[t("p",[s._v("方法参数的数量和类型（按顺序）")])]),s._v(" "),t("li",[t("p",[s._v("方法的修饰符public、private、protected、static、final、synchronized、native,、abstract的一个子集")])]),s._v(" "),t("li",[t("p",[s._v("方法的字节码bytecodes、操作数栈、局部变量表及大小（ abstract和native方法除外）")])]),s._v(" "),t("li",[t("p",[s._v("异常表（ abstract和 native方法除外）。每个异常处理的开始位置、结束位置、代码处理在程序计数器中的偏移地址、被捕获的异常类的常量池索引")])])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"_3-运行时常量池"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-运行时常量池"}},[s._v("#")]),s._v(" 3. 运行时常量池")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200704093734.png",alt:""}})]),s._v(" "),t("p",[s._v("对字节码文件反编译之后，查看常量池相关信息：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200704094138.png",alt:""}})]),s._v(" "),t("blockquote",[t("p",[s._v("注意：这里说的是"),t("strong",[s._v("常量池")]),s._v("，而不是运行时常量池")])]),s._v(" "),t("h3",{attrs:{id:"运行时常量池vs常量池"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行时常量池vs常量池"}},[s._v("#")]),s._v(" 运行时常量池vs常量池")]),s._v(" "),t("p",[t("strong",[s._v("方法区中")]),s._v("，内部包含了运行时常量池")]),s._v(" "),t("p",[t("strong",[s._v("字节码文件中")]),s._v("，内部包含了常量池")]),s._v(" "),t("p",[t("strong",[s._v("常量池：存放编译期间生成的各种字面量与符号引用")])]),s._v(" "),t("p",[t("strong",[s._v("运行时常量池：常量池表在运行时的表现形式")])]),s._v(" "),t("p",[s._v("编译后的字节码文件中包含了"),t("code",[s._v("类型信息")]),s._v("、"),t("code",[s._v("域信息")]),s._v("、"),t("code",[s._v("方法信息")]),s._v("等。通过ClassLoader将"),t("strong",[s._v("字节码文件的常量池")]),s._v("中的信息加载到内存中，存储在了"),t("strong",[s._v("方法区的运行时常量池")]),s._v("中。")]),s._v(" "),t("p",[s._v("理解为字节码中的常量池"),t("code",[s._v("Constant pool")]),s._v("只是文件信息，它想要执行就必须加载到内存中。而Java程序是靠JVM，更具体的来说是JVM的执行引擎来解释执行的。执行引擎在运行时常量池中取数据，被加载的字节码常量池中的信息是放到了方法区的运行时常量池中。")]),s._v(" "),t("p",[s._v("它们不是一个概念，存放的位置是不同的。一个在字节码文件中，一个在方法区中。")]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("要弄清楚方法区的运行时常量池，需要理解清楚字节码中的常量池。")]),s._v(" "),t("p",[s._v("一个有效的字节码文件中除了包含类的版本信息、字段、方法以及接口等描述信息外，还包含一项信息那就是"),t("strong",[s._v("常量池表")]),s._v("（ Constant pool table），包括各种字面量和对类型、域和方法的符号引用。")]),s._v(" "),t("p",[s._v("常量池表Constant pool table：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200704100145.png",alt:""}})]),s._v(" "),t("p",[s._v("在方活中对常量池表的符号引用")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200704100424.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("为什么需要常量池？")])]),s._v(" "),t("p",[s._v("举例来说：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Solution")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("method")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("这段代码很简单，但是里面却使用了 String、 System、 PrintStream及Object等结构。如果代码多，引用到的结构会更多！这里就需要常暈池，将这些引用转变为符号引用，具体用到时，才按需加载。")]),s._v(" "),t("p",[t("strong",[s._v("常量池，可以看做是一张表，虚拟机指令根据这张常量表找到要执行的类名、方法名、参数类型、字面量等类型。")])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"_4-代码追踪方法区的使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-代码追踪方法区的使用"}},[s._v("#")]),s._v(" 4. 代码追踪方法区的使用")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200706092800.png",alt:""}})]),s._v(" "),t("p",[s._v("通过"),t("code",[s._v("javap-v -p")]),s._v("反编译后查看字节码文件：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200706094128.png",alt:""}})]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lang"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    descriptor"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Ljava")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lang"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V")]),s._v("\n    flags"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACC_PUBLIC")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ACC_STATIC")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Code")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//操作数栈  局部变量表  方法形参")]),s._v("\n        stack"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" locals"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" args_size"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" sipush      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//将500压入操作数栈中")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" istore_1            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//将操作数栈中的500存储到局部变量表的1号槽位(0号为形参args,如果")]),s._v("\n                                     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//无形产则存放(this)")]),s._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" bipush      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//将100放入操作数栈中")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" istore_2            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//将操作数栈中的100存储到局部变量表的2号槽位")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" iload_1             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//读取局部变量表1号Slot(槽位),将数据500压入操作数栈")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" iload_2             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//读取局部变量表2号Slot,将数据100压入操作数栈")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" idiv                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//先出栈，对栈中500和100做除法，将结果5再存入栈中(500和100不再进栈)")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" istore_3           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//操作数栈中的5存储到局部变量表的3号槽位")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" bipush      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//定义一个int类型的变量值为50")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" istore      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//存储到局部变量表的4号槽位")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" getstatic   #"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//符号引用做赋值(#31,#32,#33)")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" iload_3            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//将局部变量表3号Slot的数取出(5)")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" iload       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//将局部变量表4号Slot的数取出(50)")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" iadd               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//出栈，对栈中5和50做加法，将结果55再存入栈中(500和100不再进栈)")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" invokevirtual #"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Method java/io/PrintStream.println:(I)V符号引用做输出")]),s._v("\n                                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// (#34,#35,#36)")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//将计算结果返回，结束方法的调用")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LineNumberTable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n            line "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n            line "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n            line "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("\n            line "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("\n            line "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("\n            line "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalVariableTable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Start")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Length")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Slot")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Name")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Signature")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  args   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Ljava")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lang"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     x   "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("I")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("     y   "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("I")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("     a   "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("I")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("     \nb   "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("I")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SourceFile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Solution.java"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br")])]),t("p",[s._v("【详解】：")]),s._v(" "),t("p",[s._v("内存操作图解")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200704123049.png",alt:""}})]),s._v(" "),t("ol",[t("li",[s._v("将500压入操作数栈中")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200704123206.png",alt:""}})]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[s._v("将操作数栈中的500存储到局部变量表的1号槽位(0号为形参args,如果无形产则存放(this)")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200704123238.png",alt:""}})]),s._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[s._v("将100放入操作数栈中")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200704123323.png",alt:""}})]),s._v(" "),t("ol",{attrs:{start:"4"}},[t("li",[s._v("将操作数栈中的100存储到局部变量表的2号槽位")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200704123346.png",alt:""}})]),s._v(" "),t("ol",{attrs:{start:"5"}},[t("li",[s._v("读取局部变量表1号Slot(槽位),将数据500压入操作数栈")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200704123423.png",alt:""}})]),s._v(" "),t("ol",{attrs:{start:"6"}},[t("li",[s._v("读取局部变量表2号Slot,将数据100压入操作数栈")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200704123501.png",alt:""}})]),s._v(" "),t("ol",{attrs:{start:"7"}},[t("li",[t("p",[s._v("先出栈，对栈中数据500和100做除法，将结果5再存入栈中(500和100不再进栈)")])]),s._v(" "),t("li",[t("p",[s._v("操作数栈中的5存储到局部变量表的3号槽位")])])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200704123548.png",alt:""}})]),s._v(" "),t("ol",{attrs:{start:"9"}},[t("li",[s._v("定义一个int类型的变量值为50")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200704123637.png",alt:""}})]),s._v(" "),t("ol",{attrs:{start:"10"}},[t("li",[s._v("存储到局部变量表的4号槽位")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200704123659.png",alt:""}})]),s._v(" "),t("ol",{attrs:{start:"11"}},[t("li",[s._v("真正在执行时，将符号引用转为直接引用")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200704123728.png",alt:""}})]),s._v(" "),t("ol",{attrs:{start:"12"}},[t("li",[s._v("将局部变量表3号Slot的数取出(5)")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200704123957.png",alt:""}})]),s._v(" "),t("ol",{attrs:{start:"13"}},[t("li",[s._v("将局部变量表4号Slot的数取出(50)")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200704124025.png",alt:""}})]),s._v(" "),t("ol",{attrs:{start:"14"}},[t("li",[s._v("出栈，对栈中数据5和50做加法，将结果55再存入栈中(500和100不再进栈)")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200704124040.png",alt:""}})]),s._v(" "),t("ol",{attrs:{start:"15"}},[t("li",[s._v("符号引用做输出(#34,#35,#36)")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200704124116.png",alt:""}})]),s._v(" "),t("ol",{attrs:{start:"16"}},[t("li",[s._v("将计算结果返回，结束方法的调用")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200704124253.png",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"_5-方法区的垃圾回收"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-方法区的垃圾回收"}},[s._v("#")]),s._v(" 5. 方法区的垃圾回收")]),s._v(" "),t("p",[s._v("在大量使用 反射、动态代理、CGLib等字节码框架，动态生成JSP以及OSGi这类频繁自定义类加载器的场景中，通常都需要Java虚拟机具备类型卸载的能力，以保证不会对方法区造成过大的内存压力。")]),s._v(" "),t("h3",{attrs:{id:"频繁的使用反射"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#频繁的使用反射"}},[s._v("#")]),s._v(" 频繁的使用反射")]),s._v(" "),t("p",[s._v("频繁的使用反射，会导致方法区"),t("strong",[s._v("加载大量的类信息")]),s._v("。而方法区是存储在堆上、GC频率很低的区域。")]),s._v(" "),t("p",[s._v("回收方法区会触发Full GC，会导致STW长时间的停顿，程序的执行效率必然降低！")]),s._v(" "),t("p",[t("strong",[s._v("所以反射不能够频繁的使用！")])])])}),[],!1,null,null,null);t.default=r.exports}}]);