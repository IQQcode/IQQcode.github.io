(window.webpackJsonp=window.webpackJsonp||[]).push([[403],{731:function(t,s,a){"use strict";a.r(s);var n=a(3),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("blockquote",[s("p",[t._v("ğŸ“š å®˜æ–¹æ–‡æ¡£ "),s("a",{attrs:{href:"https://tools.ietf.org/html/draft-abarth-thewebsocketprotocol-00",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("The WebSocket protocol")]),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("ğŸ§Š "),s("a",{attrs:{href:"http://websocket.org/aboutwebsocket.html",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("WebSocketå®˜ç½‘")]),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("ğŸ”—å®‰åˆ©æ–‡ç«  "),s("a",{attrs:{href:"https://halfrost.com/websocket/",target:"_blank",rel:"noopener noreferrer"}},[s("strong",[t._v("å…¨åŒå·¥é€šä¿¡çš„ WebSocket")]),s("OutboundLink")],1)])]),t._v(" "),s("p",[s("strong",[t._v("ã€å®æ—¶ Web åº”ç”¨çš„çª˜å¢ƒã€‘")])]),t._v(" "),s("p",[t._v("Web åº”ç”¨çš„ä¿¡æ¯äº¤äº’è¿‡ç¨‹é€šå¸¸æ˜¯å®¢æˆ·ç«¯é€šè¿‡æµè§ˆå™¨å‘å‡ºä¸€ä¸ªè¯·æ±‚ï¼ŒæœåŠ¡å™¨ç«¯æ¥æ”¶å’Œå®¡æ ¸å®Œè¯·æ±‚åè¿›è¡Œå¤„ç†å¹¶è¿”å›ç»“æœç»™å®¢æˆ·ç«¯ï¼Œç„¶åå®¢æˆ·ç«¯æµè§ˆå™¨å°†ä¿¡æ¯å‘ˆç°å‡ºæ¥ï¼Œè¿™ç§æœºåˆ¶å¯¹äºä¿¡æ¯å˜åŒ–ä¸æ˜¯ç‰¹åˆ«é¢‘ç¹çš„åº”ç”¨å°šèƒ½ç›¸å®‰æ— äº‹ï¼Œä½†æ˜¯å¯¹äºé‚£äº›å®æ—¶è¦æ±‚æ¯”è¾ƒé«˜çš„åº”ç”¨æ¥è¯´ï¼Œæ¯”å¦‚è¯´åœ¨çº¿æ¸¸æˆã€åœ¨çº¿è¯åˆ¸ã€è®¾å¤‡ç›‘æ§ã€æ–°é—»åœ¨çº¿æ’­æŠ¥ã€RSS è®¢é˜…æ¨é€ç­‰ç­‰ï¼Œå½“å®¢æˆ·ç«¯æµè§ˆå™¨å‡†å¤‡å‘ˆç°è¿™äº›ä¿¡æ¯çš„æ—¶å€™ï¼Œè¿™äº›ä¿¡æ¯åœ¨æœåŠ¡å™¨ç«¯å¯èƒ½å·²ç»è¿‡æ—¶äº†ã€‚æ‰€ä»¥ä¿æŒå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„ä¿¡æ¯åŒæ­¥æ˜¯å®æ—¶ Web åº”ç”¨çš„å…³é”®è¦ç´ ï¼Œå¯¹ Web å¼€å‘äººå‘˜æ¥è¯´ä¹Ÿæ˜¯ä¸€ä¸ªéš¾é¢˜ã€‚åœ¨ WebSocket è§„èŒƒå‡ºæ¥ä¹‹å‰ï¼Œå¼€å‘äººå‘˜æƒ³å®ç°è¿™äº›å®æ—¶çš„ Web åº”ç”¨ï¼Œä¸å¾—ä¸é‡‡ç”¨ä¸€äº›æŠ˜è¡·çš„æ–¹æ¡ˆï¼Œå…¶ä¸­æœ€å¸¸ç”¨çš„å°±æ˜¯è½®è¯¢ (Polling) å’Œ Comet æŠ€æœ¯ï¼Œè€Œ Comet æŠ€æœ¯å®é™…ä¸Šæ˜¯è½®è¯¢æŠ€æœ¯çš„æ”¹è¿›ï¼Œåˆå¯ç»†åˆ†ä¸ºä¸¤ç§å®ç°æ–¹å¼ï¼Œä¸€ç§æ˜¯é•¿è½®è¯¢æœºåˆ¶ï¼Œä¸€ç§ç§°ä¸ºæµæŠ€æœ¯ã€‚")]),t._v(" "),s("br"),t._v(" "),s("h2",{attrs:{id:"_1-httpè½®è¯¢"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-httpè½®è¯¢"}},[t._v("#")]),t._v(" 1. HTTPè½®è¯¢")]),t._v(" "),s("p",[s("strong",[t._v("é¦–å…ˆHTTPä¸­ï¼Œæ²¡æœ‰é•¿è¿æ¥è¿™æ ·çš„ç±»å‹")]),t._v("ã€‚"),s("strong",[t._v("HTTPè¦å®ç°é•¿è¿æ¥ï¼Œæ˜¯å»ºç«‹åœ¨TCPåè®®çš„åŸºç¡€ä¸Šçš„ã€‚")])]),t._v(" "),s("p",[t._v("ã€"),s("strong",[t._v("TCPçš„keep aliveå’ŒHTTPçš„Keep-alive")]),t._v("ã€‘")]),t._v(" "),s("ul",[s("li",[t._v("TCPçš„keep aliveæ˜¯æ£€æŸ¥å½“å‰TCPè¿æ¥"),s("strong",[t._v("æ˜¯å¦æ´»ç€")])]),t._v(" "),s("li",[t._v("HTTPçš„Keep-aliveæ˜¯è¦è®©ä¸€ä¸ªTCPè¿æ¥"),s("strong",[t._v("æ´»ä¹…ç‚¹")])])]),t._v(" "),s("h3",{attrs:{id:"_1-1-çŸ­è¿æ¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-çŸ­è¿æ¥"}},[t._v("#")]),t._v(" 1.1 çŸ­è¿æ¥")]),t._v(" "),s("p",[t._v("Web åº”ç”¨é€šè¿‡é€šè¿‡é¢‘ç¹çš„å¼‚æ­¥ JavaScript å’Œ XML (AJAX) è¯·æ±‚æ¥å®ç°è½®å¾ª")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210626192247.png",alt:"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"}})]),t._v(" "),s("p",[t._v("å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¿›è¡Œä¸€æ¬¡HTTPè¯·æ±‚/å“åº”ä¹‹åï¼Œå°±å…³é—­è¿æ¥ã€‚ä¸‹ä¸€æ¬¡çš„HTTPè¯·æ±‚/å“åº”æ“ä½œéœ€è¦é‡æ–°å»ºç«‹ã€‚")]),t._v(" "),s("div",{staticClass:"language-http line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[t._v("# åœ¨é¦–éƒ¨å­—æ®µä¸­è®¾ç½®çŸ­è¿æ¥\n"),s("span",{pre:!0,attrs:{class:"token header"}},[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Connection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token header-value"}},[t._v("close")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("åœ¨ä¸€æ¬¡è¯·æ±‚/å“åº”ä¹‹åï¼Œå°±ä¼šå…³é—­è¿æ¥ã€‚è¿™ç§æ–¹å¼ä¸‹ï¼Œæ˜¯ä¸é€‚åˆè·å–å®æ—¶ä¿¡æ¯çš„ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼šä¸€ç›´è¿›è¡Œè¿æ¥ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å°±è¯¢é—®ä¸€æ¬¡ã€‚å®¢æˆ·ç«¯ä¼šè½®è¯¢ï¼Œæœ‰æ²¡æœ‰æ–°æ¶ˆæ¯ã€‚è¿™ç§æ–¹å¼è¿æ¥æ•°ä¼šå¾ˆå¤šï¼Œä¸€ä¸ªæ¥å—ï¼Œä¸€ä¸ªå‘é€ã€‚è€Œä¸”æ¯æ¬¡å‘é€è¯·æ±‚éƒ½ä¼šæœ‰ HTTP çš„ Headerï¼Œä¼šå¾ˆè€—æµé‡ï¼Œä¹Ÿä¼šæ¶ˆè€— CPU çš„åˆ©ç”¨ç‡ã€‚")]),t._v(" "),s("ul",[s("li",[t._v("ä¼˜ç‚¹ï¼šçŸ­è¿æ¥ï¼ŒæœåŠ¡å™¨å¤„ç†ç®€å•ï¼Œæ”¯æŒè·¨åŸŸã€æµè§ˆå™¨å…¼å®¹æ€§è¾ƒå¥½ã€‚")]),t._v(" "),s("li",[t._v("ç¼ºç‚¹ï¼šæœ‰ä¸€å®šå»¶è¿Ÿã€æœåŠ¡å™¨å‹åŠ›è¾ƒå¤§ï¼Œæµªè´¹å¸¦å®½æµé‡ã€å¤§éƒ¨åˆ†æ˜¯æ— æ•ˆè¯·æ±‚ã€‚")])]),t._v(" "),s("br"),t._v(" "),s("h3",{attrs:{id:"_1-2-é•¿è¿æ¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-é•¿è¿æ¥"}},[t._v("#")]),t._v(" 1.2 é•¿è¿æ¥")]),t._v(" "),s("p",[s("strong",[t._v("HTTP1.1")]),t._v("æ”¯æŒäº†å¹¶ä¸”é»˜è®¤äº†"),s("strong",[t._v("é•¿è¿æ¥")]),t._v("ã€‚å› ä¸ºæœ‰äº†é•¿è¿æ¥ï¼Œæ‰€ä»¥ä¸ç”¨å®šæ—¶è½®è¯¢æ¥æˆ¿å­è¿æ¥å…³é—­ã€‚é•¿è½®è¯¢æ˜¯å¯¹å®šæ—¶è½®è¯¢çš„æ”¹è¿›å’Œæé«˜ï¼Œç›®åœ°æ˜¯ä¸ºäº†é™ä½æ— æ•ˆçš„ç½‘ç»œä¼ è¾“ã€‚å½“æœåŠ¡å™¨ç«¯æ²¡æœ‰æ•°æ®æ›´æ–°çš„æ—¶å€™ï¼Œè¿æ¥ä¼šä¿æŒä¸€æ®µæ—¶é—´å‘¨æœŸç›´åˆ°æ•°æ®æˆ–çŠ¶æ€æ”¹å˜æˆ–è€…æ—¶é—´è¿‡æœŸï¼Œé€šè¿‡è¿™ç§æœºåˆ¶æ¥å‡å°‘æ— æ•ˆçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é—´çš„äº¤äº’ã€‚")]),t._v(" "),s("p",[t._v("å®¢æˆ·ç«¯æ‰“å¼€ä¸€ä¸ªåˆ°æœåŠ¡å™¨ç«¯çš„ AJAX è¯·æ±‚ï¼Œç„¶åç­‰å¾…å“åº”ï¼ŒæœåŠ¡å™¨ç«¯éœ€è¦ä¸€äº›ç‰¹å®šçš„åŠŸèƒ½æ¥å…è®¸è¯·æ±‚è¢«æŒ‚èµ·ï¼Œåªè¦ä¸€æœ‰äº‹ä»¶å‘ç”Ÿï¼ŒæœåŠ¡å™¨ç«¯å°±ä¼šåœ¨æŒ‚èµ·çš„è¯·æ±‚ä¸­é€å›å“åº”å¹¶å…³é—­è¯¥è¯·æ±‚ã€‚å®¢æˆ·ç«¯åœ¨å¤„ç†å®ŒæœåŠ¡å™¨è¿”å›çš„ä¿¡æ¯åï¼Œå†æ¬¡å‘å‡ºè¯·æ±‚ï¼Œé‡æ–°å»ºç«‹è¿æ¥ï¼Œå¦‚æ­¤å¾ªç¯ã€‚")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210626192253.png",alt:"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"}})]),t._v(" "),s("p",[t._v("å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å»ºç«‹ä¸€æ¬¡è¿æ¥ä¹‹åï¼Œä¼šå¤ç”¨è¿™æ¡é“¾æ¥ï¼Œå¯ä»¥åœ¨è¿™æ¡è¿æ¥ä¸Šè¿›è¡Œå¤šæ¬¡"),s("code",[t._v("è¯·æ±‚/å“åº”")]),t._v("æ“ä½œã€‚å½“ä¸€ä¸ªç½‘é¡µæ‰“å¼€å®Œæˆåï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ç”¨äºä¼ è¾“HTTPæ•°æ®çš„ TCPè¿æ¥ä¸ä¼šå…³é—­ï¼Œå¦‚æœå®¢æˆ·ç«¯å†æ¬¡è®¿é—®è¿™ä¸ªæœåŠ¡å™¨ä¸Šçš„ç½‘é¡µï¼Œä¼šç»§ç»­ä½¿ç”¨è¿™ä¸€æ¡å·²ç»å»ºç«‹çš„è¿æ¥ã€‚")]),t._v(" "),s("p",[t._v("è¿™ç§æ–¹å¼ä¹Ÿæœ‰ä¸€å®šçš„å¼Šç«¯ï¼Œå®æ—¶æ€§ä¸é«˜ã€‚å¦‚æœæ˜¯é«˜å®æ—¶çš„ç³»ç»Ÿï¼Œè‚¯å®šä¸ä¼šé‡‡ç”¨è¿™ç§åŠæ³•ã€‚å› ä¸ºä¸€ä¸ª GET è¯·æ±‚æ¥å›éœ€è¦ 2ä¸ª RTTï¼Œå¾ˆå¯èƒ½åœ¨è¿™æ®µæ—¶é—´å†…ï¼Œæ•°æ®å˜åŒ–å¾ˆå¤§ï¼Œå®¢æˆ·ç«¯æ‹¿åˆ°çš„æ•°æ®å·²ç»å»¶åå¾ˆå¤šäº†ã€‚")]),t._v(" "),s("p",[t._v("å¦å¤–ï¼Œç½‘ç»œå¸¦å®½ä½åˆ©ç”¨ç‡çš„é—®é¢˜ä¹Ÿæ²¡æœ‰ä»æ ¹æºä¸Šè§£å†³ã€‚æ¯ä¸ª Request éƒ½ä¼šå¸¦ç›¸åŒçš„ Headerã€‚")]),t._v(" "),s("div",{staticClass:"language-http line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[t._v("// åªè®¾ç½®Connection:keep-aliveï¼Œè¡¨æ˜è¿æ¥æ°¸ä¹…æœ‰æ•ˆ\n"),s("span",{pre:!0,attrs:{class:"token header"}},[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Connection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token header-value"}},[t._v("keep-alive")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token header"}},[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Keep-Alive")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token header-value"}},[t._v("timeout = 60")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("ul",[s("li",[t._v("è¡¨æ˜è¿æ¥å»ºç«‹ä¹‹åï¼Œç©ºé—²æ—¶é—´è¶…è¿‡60ç§’ï¼Œè¿æ¥å¤±æ•ˆ")]),t._v(" "),s("li",[t._v("å¦‚æœåœ¨ç©ºé—²ç¬¬58ç§’ä½¿ç”¨æ­¤è¿æ¥ï¼Œåˆ™ä»ç„¶æœ‰æ•ˆï¼Œ")]),t._v(" "),s("li",[t._v("å¹¶ä¸”ä½¿ç”¨å®Œä¹‹åï¼Œé‡æ–°è®¡æ•°ç©ºé—²æ—¶é—´ï¼Œç©ºé—²60ç§’æ— å†ä½¿ç”¨ï¼Œè¿æ¥å¤±æ•ˆ")])]),t._v(" "),s("p",[t._v("æŒä¹…è¿æ¥å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¹Ÿå¯ä»¥ä¸è®¾ç½®ã€‚")]),t._v(" "),s("ul",[s("li",[t._v("ä¼˜ç‚¹ï¼šå‡å°‘è½®è¯¢æ¬¡æ•°ï¼Œä½å»¶è¿Ÿï¼Œæµè§ˆå™¨å…¼å®¹æ€§è¾ƒå¥½ã€‚")]),t._v(" "),s("li",[t._v("ç¼ºç‚¹ï¼šæœåŠ¡å™¨éœ€è¦ä¿æŒå¤§é‡è¿æ¥ã€‚")])]),t._v(" "),s("br"),t._v(" "),s("h3",{attrs:{id:"_1-3-socket"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-socket"}},[t._v("#")]),t._v(" 1.3 Socket")]),t._v(" "),s("p",[t._v("åŸºäºæµçš„æ–¹å¼ï¼Œåœ¨æœåŠ¡å™¨å¾€å®¢æˆ·ç«¯æ¨é€ï¼Œè¿™ä¸ªæ–¹å‘çš„æµ"),s("strong",[t._v("å®æ—¶æ€§")]),t._v("æ¯”è¾ƒå¥½ã€‚"),s("strong",[t._v("ä½†æ˜¯ä¾æ—§æ˜¯å•å‘çš„ï¼Œå®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡å™¨ä¾ç„¶è¿˜éœ€è¦ä¸€æ¬¡ HTTP è¯·æ±‚")])]),t._v(" "),s("p",[s("strong",[t._v("Socketç½‘ç»œç¼–ç¨‹")])]),t._v(" "),s("ul",[s("li",[t._v("Socketåœ¨åº”ç”¨ä¹‹é—´å»ºç«‹ä¿¡é“è¿æ¥ï¼Œé€šè¿‡"),s("code",[t._v("IO")]),t._v("æµæ¥ä¼ è¾“æ•°æ®")]),t._v(" "),s("li",[t._v("åŸºäº"),s("strong",[t._v("JFrame")]),t._v("ï¼Œå°è£…æ€§ã€æ˜“ç”¨æ€§ä½")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210626192259.png",alt:"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"}})]),t._v(" "),s("p",[t._v("åŸºäºTCPåè®®")]),t._v(" "),s("p",[t._v("ã€å®¢æˆ·ç«¯ã€‘ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("åˆ›å»ºå®¢æˆ·ç«¯å¥—æ¥å­—ï¼ˆå°è¯•è¿æ¥ï¼‰")]),t._v(" "),s("li",[t._v("ç­‰å¾…è¿æ¥")]),t._v(" "),s("li",[t._v("è·å–è¾“å…¥æµã€è¾“å‡ºæµ")]),t._v(" "),s("li",[t._v("å…³é—­è¿æ¥")])]),t._v(" "),s("p",[t._v("ã€æœåŠ¡ç«¯ã€‘ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("åˆ›å»ºæœåŠ¡ç«¯å¥—æ¥å­—")]),t._v(" "),s("li",[t._v("ç­‰å¾…è¿æ¥")]),t._v(" "),s("li",[t._v("è·å–è¾“å…¥æµã€è¾“å‡ºæµ")]),t._v(" "),s("li",[t._v("å…³é—­è¿æ¥")])]),t._v(" "),s("p",[t._v("ã€æ•°æ®ä¼ è¾“ã€‘ï¼šåœ¨ä¸¤ä¸ªå¥—æ¥å­—å»ºç«‹çš„"),s("code",[t._v("socket")]),t._v("é€šé“ä¸­è¿›è¡Œä¼ è¾“æ•°æ®æµ")]),t._v(" "),s("br"),t._v(" "),s("ul",[s("li",[s("p",[t._v("çŸ­è½®è¯¢æ•ˆç‡ä½ï¼Œéå¸¸æµªè´¹èµ„æºï¼ˆç½‘ç»œå¸¦å®½å’Œè®¡ç®—èµ„æºï¼‰ã€‚æœ‰ä¸€å®šå»¶è¿Ÿã€æœåŠ¡å™¨å‹åŠ›è¾ƒå¤§ï¼Œå¹¶ä¸”å¤§éƒ¨åˆ†æ˜¯æ— æ•ˆè¯·æ±‚ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("é•¿è½®è¯¢è™½ç„¶çœå»äº†å¤§é‡æ— æ•ˆè¯·æ±‚ï¼Œå‡å°‘äº†æœåŠ¡å™¨å‹åŠ›å’Œä¸€å®šçš„ç½‘ç»œå¸¦å®½çš„å ç”¨ï¼Œä½†æ˜¯è¿˜æ˜¯éœ€è¦ä¿æŒå¤§é‡çš„è¿æ¥ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("æœ€ååˆ°äº†åŸºäºæµçš„æ–¹å¼ï¼Œåœ¨æœåŠ¡å™¨å¾€å®¢æˆ·ç«¯æ¨é€ï¼Œè¿™ä¸ªæ–¹å‘çš„æµå®æ—¶æ€§æ¯”è¾ƒå¥½ã€‚ä½†æ˜¯ä¾æ—§æ˜¯å•å‘çš„ï¼Œå®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡å™¨ä¾ç„¶è¿˜éœ€è¦ä¸€æ¬¡ HTTP è¯·æ±‚ã€‚")])])]),t._v(" "),s("hr"),t._v(" "),s("br"),t._v(" "),s("h2",{attrs:{id:"_2-websocket"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-websocket"}},[t._v("#")]),t._v(" 2. WebSocket")]),t._v(" "),s("h3",{attrs:{id:"_2-1-websocketçš„æ¼”è¿›"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-websocketçš„æ¼”è¿›"}},[t._v("#")]),t._v(" 2.1 WebSocketçš„æ¼”è¿›")]),t._v(" "),s("p",[t._v("ç»¼åˆè¿™å‡ ç§æ–¹æ¡ˆï¼Œä¼šå‘ç°è¿™äº›ç›®å‰æˆ‘ä»¬æ‰€ä½¿ç”¨çš„æ‰€è°“çš„å®æ—¶æŠ€æœ¯å¹¶ä¸æ˜¯çœŸæ­£çš„å®æ—¶æŠ€æœ¯ï¼Œå®ƒä»¬åªæ˜¯åœ¨ç”¨ Ajax æ–¹å¼æ¥æ¨¡æ‹Ÿå®æ—¶çš„æ•ˆæœï¼Œåœ¨æ¯æ¬¡å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯äº¤äº’çš„æ—¶å€™éƒ½æ˜¯ä¸€æ¬¡ HTTP çš„è¯·æ±‚å’Œåº”ç­”çš„è¿‡ç¨‹ï¼Œè€Œæ¯ä¸€æ¬¡çš„ HTTP è¯·æ±‚å’Œåº”ç­”éƒ½å¸¦æœ‰å®Œæ•´çš„ HTTP å¤´ä¿¡æ¯ï¼Œè¿™å°±å¢åŠ äº†æ¯æ¬¡ä¼ è¾“çš„æ•°æ®é‡ã€‚")]),t._v(" "),s("p",[t._v("è€Œä¸”è¿™äº›æ–¹æ¡ˆä¸­å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„ç¼–ç¨‹å®ç°éƒ½æ¯”è¾ƒå¤æ‚ï¼Œåœ¨å®é™…çš„åº”ç”¨ä¸­ï¼Œä¸ºäº†æ¨¡æ‹Ÿæ¯”è¾ƒçœŸå®çš„å®æ—¶æ•ˆæœï¼Œå¼€å‘äººå‘˜å¾€å¾€éœ€è¦æ„é€ ä¸¤ä¸ª HTTP è¿æ¥æ¥æ¨¡æ‹Ÿå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„åŒå‘é€šè®¯ï¼Œä¸€ä¸ªè¿æ¥ç”¨æ¥å¤„ç†å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨ç«¯çš„æ•°æ®ä¼ è¾“ï¼Œä¸€ä¸ªè¿æ¥ç”¨æ¥å¤„ç†æœåŠ¡å™¨ç«¯åˆ°å®¢æˆ·ç«¯çš„æ•°æ®ä¼ è¾“ï¼Œè¿™ä¸å¯é¿å…åœ°å¢åŠ äº†ç¼–ç¨‹å®ç°çš„å¤æ‚åº¦ï¼Œä¹Ÿå¢åŠ äº†æœåŠ¡å™¨ç«¯çš„è´Ÿè½½ï¼Œåˆ¶çº¦äº†åº”ç”¨ç³»ç»Ÿçš„æ‰©å±•æ€§ã€‚")]),t._v(" "),s("br"),t._v(" "),s("h3",{attrs:{id:"_2-2-ğŸš€websocket"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-ğŸš€websocket"}},[t._v("#")]),t._v(" 2.2 ğŸš€Websocket")]),t._v(" "),s("p",[t._v("Websocketæ˜¯ä¸€ç§ç½‘ç»œé€šä¿¡åè®®ã€‚")]),t._v(" "),s("p",[t._v("Websocketæ˜¯"),s("strong",[t._v("HTML5")]),t._v("å¼€å§‹æä¾›çš„ä¸€ç§åœ¨"),s("strong",[t._v("å•ä¸ªTCPè¿æ¥ä¸Šè¿›è¡Œå…¨åŒå·¥é€šè®¯")]),t._v("çš„åè®®ã€‚æ²¡æœ‰äº† Request å’Œ Response çš„æ¦‚å¿µï¼Œä¸¤è€…åœ°ä½å®Œå…¨å¹³ç­‰ï¼Œè¿æ¥ä¸€æ—¦å»ºç«‹ï¼Œå°±å»ºç«‹äº†çœŸæŒä¹…æ€§è¿æ¥ï¼ŒåŒæ–¹å¯ä»¥éšæ—¶å‘å¯¹æ–¹å‘é€æ•°æ®ã€‚ä½¿å¾—æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯äº¤äº’æ•°æ®æ›´åŠ ç®€å•ã€‚")]),t._v(" "),s("p",[t._v("æµè§ˆå™¨å’Œå®¢æˆ·ç«¯åªéœ€è¦å®Œæˆä¸€æ¬¡æ¡æ‰‹ï¼Œå°±å¯ä»¥åˆ›å»ºæŒä¹…æ€§çš„è¿æ¥ï¼Œå¹¶è¿›è¡ŒåŒå‘çš„æ•°æ®ä¼ è¾“")]),t._v(" "),s("p",[t._v("HTTPåè®®æ˜¯ä¸€ç§æ— çŠ¶æ€çš„ã€æ— è¿æ¥çš„ã€å•å‘çš„åº”ç”¨å±‚åè®®ã€‚å®ƒé‡‡ç”¨äº†"),s("strong",[t._v("è¯·æ±‚ / å“åº”")]),t._v("æ¨¡å‹ã€‚"),s("strong",[t._v("é€šä¿¡è¯·æ±‚åªèƒ½ç”±å®¢æˆ·ç«¯å‘èµ·ï¼ŒæœåŠ¡ç«¯å¯¹è¯·æ±‚åšå‡ºåº”ç­”å¤„ç†")])]),t._v(" "),s("p",[t._v("è¿™ç§é€šä¿¡æ¨¡å‹æœ‰ä¸€ä¸ªå¼Šç«¯ï¼šHTTPåè®®æ— æ³•å®ç°æœåŠ¡å™¨"),s("strong",[t._v("ä¸»åŠ¨")]),t._v("å‘å®¢æˆ·ç«¯å‘èµ·æ¶ˆæ¯ã€‚")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210626192306.png",alt:"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"}})]),t._v(" "),s("p",[t._v("è¿™ç§"),s("strong",[t._v("å•å‘è¯·æ±‚")]),t._v("çš„ç‰¹ç‚¹ï¼Œæ³¨å®šäº†å¦‚æœæœåŠ¡å™¨æœ‰è¿ç»­çš„çŠ¶æ€å˜åŒ–ï¼Œå®¢æˆ¶ç«¯è¦è·çŸ¥å°±éå¸¸éº»çƒ¦ã€‚")]),t._v(" "),s("ul",[s("li",[t._v("å› ä¸ºæœåŠ¡å™¨ä¸ä¼šä¸»åŠ¨å›å¤å®¢æˆ·ç«¯è¯´æˆ‘è¿™é‡Œæœ‰æ•°æ®å˜åŒ–")]),t._v(" "),s("li",[t._v("åªèƒ½æ˜¯å®¢æˆ·ç«¯é—®æœåŠ¡å™¨æœ‰æ²¡æœ‰æ•°æ®å‘ç”Ÿå˜åŒ–ï¼ŒæœåŠ¡å™¨ç»™å®¢æˆ·ç«¯åšå›åº”ã€‚")])]),t._v(" "),s("p",[t._v("ä¸ºäº†ä¿æŒé•¿æ—¶é—´çš„é€šä¿¡è¿æ¥ï¼Œå°±éœ€è¦åŒæ­¥å®¢æˆ·ç«¯ä¸æ–­åœ°å‘é€è¯·æ±‚è¯¢é—®ï¼Œç§°ä¸º"),s("strong",[t._v("è½®è¯¢")]),t._v("ã€‚")]),t._v(" "),s("p",[t._v("å¤§å¤šæ•°Webåº”ç”¨ç¨‹åºå°†é€šè¿‡é¢‘ç¹çš„å¼‚æ­¥AJAXè¯·æ±‚å®ç°"),s("strong",[t._v("é•¿è½®è¯¢")]),t._v("ã€‚è½®è¯¢çš„æ•ˆç‡ä½ï¼Œéå¸¸æµªè´¹èµ„æºï¼ˆå› ä¸ºå¿…é¡»ä¸åœè¿æ¥ï¼Œæˆ–è€…HTTPè¿æ¥å§‹ç»ˆæ‰“å¼€ï¼‰")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210626192310.png",alt:"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"}})]),t._v(" "),s("p",[t._v("æ‰€ä»¥ WebSocket å’Œ HTTP æœ‰ä¸€äº›äº¤é›†ï¼Œä¸¤è€…ç›¸å¼‚çš„åœ°æ–¹è¿˜æ˜¯å¾ˆå¤šã€‚ä¸¤è€…äº¤é›†çš„åœ°æ–¹åœ¨ HTTP æ¡æ‰‹é˜¶æ®µï¼Œæ¡æ‰‹æˆåŠŸåï¼Œæ•°æ®å°±ç›´æ¥ä» TCP é€šé“ä¼ è¾“ã€‚")]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("è½®è¯¢")]),t._v("ï¼šåœ¨å®¢æˆ·ç«¯å®šæ—¶çš„å‘æœåŠ¡å™¨å‘é€AJAXè¯·æ±‚ï¼Œè·å–æœåŠ¡ç«¯æœ€æ–°çš„æ•°æ®")])]),t._v(" "),s("h3",{attrs:{id:"_2-3-ä¸ºä»€ä¹ˆè¦é€‰æ‹©websocket"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-ä¸ºä»€ä¹ˆè¦é€‰æ‹©websocket"}},[t._v("#")]),t._v(" 2.3 ä¸ºä»€ä¹ˆè¦é€‰æ‹©WebSocket")]),t._v(" "),s("p",[t._v("è½®è¯¢éƒ½æ˜¯å…ˆç”±å®¢æˆ·ç«¯å‘èµ· Ajax è¯·æ±‚ï¼Œæ‰èƒ½è¿›è¡Œé€šä¿¡ï¼Œèµ°çš„æ˜¯HTTPåè®®ï¼ŒæœåŠ¡å™¨ç«¯æ— æ³•ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€ä¿¡æ¯ã€‚")]),t._v(" "),s("p",[t._v("å½“å‡ºç°ç±»ä¼¼ä½“è‚²èµ›äº‹ã€èŠå¤©å®¤ã€å®æ—¶ä½ç½®ä¹‹ç±»çš„åœºæ™¯æ—¶ï¼Œ"),s("strong",[t._v("è½®è¯¢å°±æ˜¾å¾—ååˆ†ä½æ•ˆå’Œæµªè´¹èµ„æº")]),t._v("ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("é€‰æ‹©WebSocketçš„ç†ç”±ï¼š")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("å…¨åŒå·¥é€šä¿¡ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å¯ä»¥äº’ç›¸ä¸»åŠ¨é€šä¿¡")]),t._v("ã€‚ç”±äºåè®®æ˜¯å…¨åŒå·¥çš„ï¼Œæ‰€ä»¥æœåŠ¡å™¨å¯ä»¥éšæ—¶ä¸»åŠ¨ç»™å®¢æˆ·ç«¯å‘æ•°æ®ã€‚è€ŒHTTPåè®®ä¸­æœåŠ¡å™¨ä¸èƒ½ä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼Œæ˜¯å•å‘é€šä¿¡çš„")]),t._v(" "),s("li",[s("strong",[t._v("è¾ƒå°‘çš„æ§åˆ¶å¼€é”€")]),t._v("ã€‚åè®®æ§åˆ¶çš„æ•°æ®åŒ…å¤´éƒ¨ç›¸å¯¹è¾ƒå°ï¼Œé•¿è¿æ¥å‡å°‘äº†æ¯æ¬¡è¿æ¥æ—¶æ¡æ‰‹æŒ¥æ‰‹çš„èµ„æºæ¶ˆè€—")]),t._v(" "),s("li",[s("strong",[t._v("ä¿æŒé•¿è¿æ¥çŠ¶æ€ï¼Œå®æ—¶æ€§")]),t._v("ã€‚HTTPè¦ä¸æ–­å‘é€è¯·æ±‚æ¥ä¿æŒè¿æ¥ï¼Œå¦åˆ™æœåŠ¡å™¨å“åº”å®Œå®¢æˆ·ç«¯å°±æ–­å¼€è¿æ¥äº†")])]),t._v(" "),s("br"),t._v(" "),s("h3",{attrs:{id:"_2-4-åŸºäºtcp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-åŸºäºtcp"}},[t._v("#")]),t._v(" 2.4 åŸºäºTCP")]),t._v(" "),s("p",[t._v("é¦–å…ˆæ¥é˜æ˜ç»“è®ºï¼š")]),t._v(" "),s("p",[s("strong",[t._v("WebSocketå’ŒHTTPéƒ½æ˜¯åŸºäºTCPåè®®çš„ï¼Œå¦‚æœè¦ç”¨UDPå¯ä»¥ç”¨ "),s("a",{attrs:{href:"https://webrtc.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("WebRTCåè®®"),s("OutboundLink")],1)])]),t._v(" "),s("blockquote",[s("p",[t._v("å‚è§å®˜æ–¹æ–‡æ¡£ "),s("a",{attrs:{href:"https://tools.ietf.org/html/draft-abarth-thewebsocketprotocol-00",target:"_blank",rel:"noopener noreferrer"}},[t._v("Relationship to TCP and HTTP"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("ç›¸å…³é—®é¢˜å‚è§stackoverflow ğŸ”— "),s("a",{attrs:{href:"https://stackoverflow.com/questions/4657033/javascript-websockets-with-udp",target:"_blank",rel:"noopener noreferrer"}},[t._v("WebSockets with UDP"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("1.7  Relationship to TCP and HTTP")]),t._v(" "),s("p",[s("em",[t._v("This section is non-normative.")])]),t._v(" "),s("p",[t._v("The WebSocket protocol is an independent TCP-based protocol. Its\nonly relationship to HTTP is that its handshake is interpreted by\nHTTP servers as an Upgrade request.")]),t._v(" "),s("p",[t._v("Based on the expert recommendation of the IANA, the WebSocket\nprotocol by default uses port 80 for regular WebSocket connections\nand port 443 for WebSocket connections tunneled over TLS.")]),t._v(" "),s("p",[t._v("WebSocket åè®®æ˜¯"),s("font",{attrs:{color:"red"}},[s("strong",[t._v("åŸºäº TCP çš„ç‹¬ç«‹åè®®")])]),t._v("ã€‚å…¶ä¸HTTP çš„å”¯ä¸€å…³ç³»æ˜¯ï¼Œå…¶æ¡æ‰‹ç”±HTTP æœåŠ¡å™¨ä½œä¸ºå‡çº§è¯·æ±‚ã€‚æ ¹æ®IANAçš„ä¸“å®¶å»ºè®®ï¼ŒWebSocketåè®®é»˜è®¤ä½¿ç”¨ç«¯å£80ä½œä¸ºå¸¸è§„çš„WebSocketè¿æ¥ï¼Œä½¿ç”¨ç«¯å£443ä½œä¸ºé€šè¿‡TLSéš§é“çš„WebSocketè¿æ¥ã€‚")],1),t._v(" "),s("br"),t._v(" "),s("h3",{attrs:{id:"_2-5-æˆç†Ÿçš„websocketæœåŠ¡å™¨ç«¯å®ç°"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-æˆç†Ÿçš„websocketæœåŠ¡å™¨ç«¯å®ç°"}},[t._v("#")]),t._v(" 2.5 æˆç†Ÿçš„WebSocketæœåŠ¡å™¨ç«¯å®ç°")]),t._v(" "),s("p",[t._v("ç›®å‰ä¸€äº›æ¯”è¾ƒæˆç†Ÿçš„ WebSocket æœåŠ¡å™¨ç«¯å®ç°,å¦‚ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("Kaazing WebSocket Gateway â€” ä¸€ä¸ª Java å®ç°çš„ WebSocket Server")]),t._v(" "),s("li",[t._v("mod_pywebsocket â€” ä¸€ä¸ª Python å®ç°çš„ WebSocket Server")]),t._v(" "),s("li",[t._v("Netty â€”ä¸€ä¸ª Java å®ç°çš„ç½‘ç»œæ¡†æ¶å…¶ä¸­åŒ…æ‹¬äº†å¯¹ WebSocket çš„æ”¯æŒ")]),t._v(" "),s("li",[t._v("node.js â€”ä¸€ä¸ª Server ç«¯çš„ JavaScript æ¡†æ¶æä¾›äº†å¯¹ WebSocket çš„æ”¯æŒ")])]),t._v(" "),s("br"),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"_3-websocketåè®®é€šä¿¡åŸç†"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-websocketåè®®é€šä¿¡åŸç†"}},[t._v("#")]),t._v(" 3. WebSocketåè®®é€šä¿¡åŸç†")]),t._v(" "),s("p",[s("strong",[t._v("HTTPåè®®ï¼š")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210626192316.png",alt:"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"}})]),t._v(" "),s("p",[t._v("å»¶æ—¶æ—¶é—´é•¿ï¼Œè€Œä¸”åªèƒ½æ˜¯å•å‘é€šä¿¡ï¼Œå•æ¬¡é€šä¿¡å®Œï¼Œè¿æ¥å°±æ–­å¼€äº†ã€‚")]),t._v(" "),s("br"),t._v(" "),s("h3",{attrs:{id:"_3-1-åè®®å‡çº§"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-åè®®å‡çº§"}},[t._v("#")]),t._v(" 3.1 åè®®å‡çº§")]),t._v(" "),s("p",[s("strong",[t._v("WebSocketåè®®æ˜¯å»ºç«‹åœ¨HTTPåè®®åŸºç¡€ä¹‹ä¸Šçš„ï¼Œåœ¨å»ºç«‹HTTPåè®®æ—¶ï¼Œä¼ è¾“å±‚å¦‚æœæ˜¯TCPåè®®å°±å¿…ç„¶ç»å†è¿‡äº†ä¸‰æ¬¡æ¡æ‰‹")])]),t._v(" "),s("p",[t._v("å»ºç«‹TCPè¿æ¥ä¹‹åï¼Œå¼€å§‹å»ºç«‹WebSocketè¿æ¥ï¼Œä¸Šæ–‡è¯´è¿‡WebSocketè¿æ¥åªéœ€ä¸€æ¬¡æˆåŠŸæ¡æ‰‹å³å¯å»ºç«‹ã€‚æ¡æ‰‹è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆå›¾ç‰‡æ¥è‡ªäº’è”ç½‘ï¼‰ï¼š")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210626192321.jpeg",alt:"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"}})]),t._v(" "),s("p",[s("strong",[t._v("1. é¦–å…ˆå®¢æˆ·ç«¯ä¼šå‘é€ä¸€ä¸ªæ¡æ‰‹åŒ…")])]),t._v(" "),s("p",[t._v("è¿™é‡Œå°±ä½“ç°å‡ºäº†WebSocketä¸Httpåè®®çš„è”ç³»ï¼Œæ¡æ‰‹åŒ…çš„æŠ¥æ–‡æ ¼å¼å¿…é¡»ç¬¦åˆHTTPæŠ¥æ–‡æ ¼å¼çš„è§„èŒƒã€‚å…¶ä¸­ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("æ–¹æ³•å¿…é¡»ä½GETæ–¹æ³•")]),t._v(" "),s("li",[t._v("HTTPç‰ˆæœ¬ä¸èƒ½ä½äº1.1")]),t._v(" "),s("li",[t._v("å¿…é¡»åŒ…å«Upgradeå¤´éƒ¨ï¼Œå€¼å¿…é¡»ä¸ºwebsocket")]),t._v(" "),s("li",[t._v("å¿…é¡»åŒ…å«Sec-WebSocket-Keyå¤´éƒ¨ï¼Œå€¼æ˜¯ä¸€ä¸ªBase64ç¼–ç çš„16å­—èŠ‚éšæœºå­—ç¬¦ä¸²ã€‚")]),t._v(" "),s("li",[t._v("å¿…é¡»åŒ…å«Sec-WebSocket-Versionå¤´éƒ¨ï¼Œå€¼å¿…é¡»ä¸º13")]),t._v(" "),s("li",[t._v("å…¶ä»–å¯é€‰é¦–éƒ¨å¯ä»¥å‚è€ƒï¼š"),s("a",{attrs:{href:"https://tools.ietf.org/html/rfc6455#section-4.1",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://tools.ietf.org/html/rfc6455#section-4.1"),s("OutboundLink")],1)])]),t._v(" "),s("p",[s("strong",[t._v("2. æœåŠ¡ç«¯éªŒè¯å®¢æˆ·ç«¯çš„æ¡æ‰‹åŒ…ç¬¦åˆè§„èŒƒä¹‹åä¹Ÿä¼šå‘é€ä¸€ä¸ªæ¡æ‰‹åŒ…ç»™å®¢æˆ·ç«¯ã€‚")])]),t._v(" "),s("p",[t._v("æ ¼å¼å¦‚ä¸‹ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("å¿…é¡»åŒ…å«Connectionå¤´éƒ¨ï¼Œå€¼å¿…é¡»ä¸ºUpgrade")]),t._v(" "),s("li",[t._v("å¿…é¡»åŒ…å«ä¸€ä¸ªUpgradeå¤´éƒ¨ï¼Œå€¼å¿…é¡»ä¸ºwebsocket")]),t._v(" "),s("li",[t._v("å¿…é¡»åŒ…å«ä¸€ä¸ªSec-Websocket-Acceptå¤´éƒ¨ï¼Œå€¼æ˜¯æ ¹æ®å¦‚ä¸‹è§„åˆ™è®¡ç®—çš„ï¼š")])]),t._v(" "),s("p",[t._v("é¦–å…ˆå°†ä¸€ä¸ªå›ºå®šçš„å­—ç¬¦ä¸²")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("258")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("EAFA5")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("E914")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("47D")]),t._v("A"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("95")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CA")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("C5AB0DC85B11")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("æ‹¼æ¥åˆ°Sec-WebSocket-Keyå¯¹åº”å€¼çš„åé¢ã€‚å¯¹æ‹¼æ¥åçš„å­—ç¬¦ä¸²è¿›è¡Œä¸€æ¬¡SHA-1è®¡ç®—ï¼Œå°†è®¡ç®—ç»“æœè¿›è¡ŒBase-64ç¼–ç ")]),t._v(" "),s("p",[s("strong",[t._v("3. å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„æ¡æ‰‹åŒ…ä¹‹åï¼ŒéªŒè¯æŠ¥æ–‡æ ¼å¼æ—¶å€™ç¬¦åˆè§„èŒƒï¼Œä»¥2ä¸­åŒæ ·çš„æ–¹å¼è®¡ç®—Sec-WebSocket-Acceptå¹¶ä¸æœåŠ¡ç«¯æ¡æ‰‹åŒ…é‡Œçš„å€¼è¿›è¡Œæ¯”å¯¹")])]),t._v(" "),s("p",[t._v("å…¶ä¸­ä»»ä½•ä¸€æ­¥ä¸é€šè¿‡åˆ™ä¸èƒ½å»ºç«‹WebSocketè¿æ¥ã€‚")]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("å®¢æˆ·ç«¯å‘é€"),s("code",[t._v("Upgrade")]),t._v("è¯·æ±‚å¤´æ¥å‘ŠçŸ¥æœåŠ¡ç«¯åè®®å‡çº§ï¼Œæƒ³è¦å»ºç«‹ä¸€ä¸ª WebSocket è¿æ¥ã€‚")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210626192326.png",alt:"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"}})]),t._v(" "),s("p",[s("strong",[t._v("ã€101çŠ¶æ€ç ã€‘")])]),t._v(" "),s("p",[t._v("å½“å®¢æˆ·ç«¯åœ¨è¯·æ±‚é‡Œä½¿ç”¨"),s("code",[t._v("Upgrade")]),t._v("æŠ¥å¤´ï¼Œé€šçŸ¥æœåŠ¡å™¨å®ƒæƒ³æ”¹ç”¨é™¤HTTPåè®®ä¹‹å¤–çš„å…¶ä»–åè®®æ—¶ï¼Œå®¢æˆ·ç«¯å°†è·å¾—æ­¤å“åº”ä»£ç ã€‚"),s("strong",[t._v("101")]),t._v(" å“åº”ä»£ç è¡¨ç¤ºâ€œè¡Œï¼Œæˆ‘ç°åœ¨æ”¹ç”¨å¦ä¸€ä¸ªåè®®äº†â€ã€‚")]),t._v(" "),s("p",[t._v("é€šå¸¸HTTPå®¢æˆ·ç«¯ä¼šåœ¨æ”¶åˆ°æœåŠ¡å™¨å‘æ¥çš„101å“åº”å"),s("strong",[t._v("å…³é—­ä¸æœåŠ¡å™¨çš„TCPè¿æ¥")]),t._v("ã€‚101å“åº”ä»£ç æ„å‘³ç€ï¼Œè¯¥å®¢æˆ·ç«¯ä¸å†æ˜¯ä¸€ä¸ªHTTPå®¢æˆ·ç«¯ï¼Œè€Œå°†æˆä¸ºå¦ä¸€ç§å®¢æˆ·ç«¯ã€‚")]),t._v(" "),s("br"),t._v(" "),s("h3",{attrs:{id:"_3-2-å»ºç«‹websocketè¿æ¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-å»ºç«‹websocketè¿æ¥"}},[t._v("#")]),t._v(" 3.2 å»ºç«‹WebSocketè¿æ¥")]),t._v(" "),s("p",[t._v("åœ¨å®¢æˆ·ç«¯å»ºç«‹ä¸€ä¸ª WebSocket è¿æ¥éå¸¸ç®€å•ï¼šè¦è¿æ¥åˆ°ç«¯ç‚¹ï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªæ–°çš„ WebSocket å®ä¾‹ï¼Œä¸ºæ–°å¯¹è±¡æä¾›ä¸€ä¸ª URLï¼Œè¯¥ URL è¡¨ç¤ºè¦è¿æ¥åˆ°çš„ç«¯ç‚¹")]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" ws "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocket")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ws://localhost:9000'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("è¯·æ±‚çš„ URL æ˜¯"),s("code",[t._v("ws://")]),t._v("æˆ–è€… "),s("code",[t._v("wss://")]),t._v("å¼€å¤´çš„ï¼Œè€Œä¸æ˜¯ "),s("code",[t._v("httP://")]),t._v(" æˆ–è€… "),s("code",[t._v("https://")])]),t._v(" "),s("br"),t._v(" "),s("h3",{attrs:{id:"_3-3-æ¡æ‰‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-æ¡æ‰‹"}},[t._v("#")]),t._v(" 3.3 æ¡æ‰‹")]),t._v(" "),s("p",[t._v("WebSocketåè®®çš„å»ºç«‹æ˜¯åŸºäºHTTPåè®®ä¹‹ä¸Šçš„ï¼Œå…ˆå»ºç«‹HTTPåè®®ï¼Œç„¶åé€šè¿‡å‘é€"),s("code",[t._v("101")]),t._v("çŠ¶æ€ç ï¼Œä½¿ç”¨"),s("code",[t._v("Upgrade")]),t._v("æŠ¥å¤´å‡çº§ä¸º"),s("strong",[t._v("WebSocket")]),t._v("åè®®")]),t._v(" "),s("p",[t._v("WebSocket è¿æ¥æ˜¯åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„åˆå§‹æ¡æ‰‹æœŸé—´ä» HTTP åè®®å‡çº§åˆ° WebSocket åè®®å»ºç«‹çš„")]),t._v(" "),s("p",[t._v("æ­¤æ—¶ï¼ŒHTTP è¿æ¥æ–­å¼€ï¼Œå¹¶ç”± WebSocket è¿æ¥é€šè¿‡ç›¸åŒçš„åŸºç¡€ TCP/IP è¿æ¥æ›¿æ¢ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒWebSocket è¿æ¥ä½¿ç”¨ä¸ HTTP ï¼ˆ80ï¼‰ å’Œ HTTPS ï¼ˆ443ï¼‰ ç›¸åŒçš„ç«¯å£ã€‚")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210626192336.png",alt:"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"}})]),t._v(" "),s("p",[t._v("WebSocketåè®®æœ‰ä¸¤éƒ¨åˆ†ï¼š"),s("strong",[t._v("æ¡æ‰‹")]),t._v("å’Œ"),s("strong",[t._v("æ•°æ®ä¼ è¾“")]),t._v("ï¼Œæ¡æ‰‹æ˜¯åŸºäºHTTPåè®®çš„")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210626192346.webp",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_3-4-è¯·æ±‚æ•°æ®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-è¯·æ±‚æ•°æ®"}},[t._v("#")]),t._v(" 3.4 è¯·æ±‚æ•°æ®")]),t._v(" "),s("p",[t._v("å®¢æˆ·ç«¯requestè¯·æ±‚å¤´ï¼š")]),t._v(" "),s("div",{staticClass:"language-http line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[t._v("GET ws://localhostchat HTTP/1.1\n"),s("span",{pre:!0,attrs:{class:"token header"}},[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token header-value"}},[t._v("localhost")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token header"}},[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Upgrade")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token header-value"}},[t._v("websocket  //è¡¨ç¤ºè¦å‡çº§åˆ°websocketåè®®")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token header"}},[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Connection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token header-value"}},[t._v("Upgrade")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token header"}},[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Sec-WebSocket-Extensions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token header-value"}},[t._v("permessage-deflate;")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token header"}},[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Sec-WebSocket-Key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token header-value"}},[t._v("5fTJ1LTuh3RKjSJxydyifQ==\t\t// ä¸å“åº”å¤´ Sec-WebSocket-Accept ç›¸å¯¹åº”")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token header"}},[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Sec-WebSocket-Version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token header-value"}},[t._v("13\t//è¡¨ç¤ºwebsocketåè®®çš„ç‰ˆæœ¬\t")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("p",[t._v("æœåŠ¡ç«¯responseå“åº”å¤´ï¼š")]),t._v(" "),s("div",{staticClass:"language-http line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[s("span",{pre:!0,attrs:{class:"token response-status"}},[s("span",{pre:!0,attrs:{class:"token http-version property"}},[t._v("HTTP/1.1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token status-code number"}},[t._v("101")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token reason-phrase string"}},[t._v("Switching Protocols")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token header"}},[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Upgrade")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token header-value"}},[t._v("websocket")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token header"}},[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Connection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token header-value"}},[t._v("Upgrade")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token header"}},[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Sec-WebSocket-Accept")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token header-value"}},[t._v("ZUip34t+bCjhkvxxwhmdEOyx9hE=")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token header"}},[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Sec-WebSocket-Extensions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token header-value"}},[t._v("permessage-deflate;")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("p",[t._v("ã€å­—æ®µè¯´æ˜ã€‘")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("å¤´åç§°")]),t._v(" "),s("th",[t._v("è¯´æ˜")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("Connection: Upgrade")]),t._v(" "),s("td",[t._v("è¡¨ç¤ºè¯¥HTTPè¯·æ±‚æ˜¯ä¸€ä¸ªäººåè®®å‡çº§è¯·æ±‚")])]),t._v(" "),s("tr",[s("td",[t._v("Upgrade: websocket")]),t._v(" "),s("td",[t._v("åè®®å‡çº§ä¸ºWebSocketåè®®")])]),t._v(" "),s("tr",[s("td",[t._v("Sec-WebSocket-Version: 13")]),t._v(" "),s("td",[t._v("è¡¨ç¤ºwebsocketåè®®çš„ç‰ˆæœ¬")])]),t._v(" "),s("tr",[s("td",[t._v("Sec-WebSocket-Key")]),t._v(" "),s("td",[s("strong",[t._v("ä¸å“åº”å¤´ Sec-WebSocket-Accept ç›¸å¯¹åº”ï¼Œç”¨æ¥å”¯ä¸€æ ‡è¯†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨")])])]),t._v(" "),s("tr",[s("td",[t._v("Sec-WebSocket-Extensions")]),t._v(" "),s("td",[t._v("åè®®æ‹“å±•")])])])]),t._v(" "),s("p",[t._v("å¦‚æœä¸€æ¬¡å‘é€çš„æ¶ˆæ¯è¿‡é•¿ï¼ŒWebSocketçš„å•ä¸ªæ¶ˆæ¯å¯è¢«åˆ†å‰²ä¸ºå¤šä¸ªæ•°æ®å¸§æ¥åˆ†ç»„å‘é€ï¼Œç›´è‡³æœ«å°¾ä¸º"),s("code",[t._v("FIN")]),t._v("æ ‡å¿—ä½ (PS:æ—¢ç„¶çœ‹åˆ°äº†FINæ ‡å¿—ä½ï¼Œè¯´æ˜WebSocketåè®®æ˜¯ä¾æ®TCPçš„)")]),t._v(" "),s("blockquote",[s("p",[t._v("æ¥è‡ªç»´åŸºç™¾ç§‘:")]),t._v(" "),s("p",[t._v("Once the connection is established, the client and server can send WebSocket data or text frames back and forth in "),s("a",{attrs:{href:"https://en.wikipedia.org/wiki/Duplex_(telecommunications)",target:"_blank",rel:"noopener noreferrer"}},[t._v("full-duplex"),s("OutboundLink")],1),t._v(" mode. The data is minimally framed, with a small header followed by "),s("a",{attrs:{href:"https://en.wikipedia.org/wiki/Payload_(computing)",target:"_blank",rel:"noopener noreferrer"}},[t._v("payload"),s("OutboundLink")],1),t._v(".["),s("a",{attrs:{href:"https://en.wikipedia.org/wiki/WebSocket#cite_note-37",target:"_blank",rel:"noopener noreferrer"}},[t._v("36]"),s("OutboundLink")],1),t._v(' WebSocket transmissions are described as "messages", where a single message can optionally be split across several data frames. This can allow for sending of messages where initial data is available but the complete length of the message is unknown (it sends one data frame after another until the end is reached and marked with the FIN bit). With extensions to the protocol, this can also be used for multiplexing several streams simultaneously (for instance to avoid monopolizing use of a socket for a single large payload).['),s("a",{attrs:{href:"https://en.wikipedia.org/wiki/WebSocket#cite_note-38",target:"_blank",rel:"noopener noreferrer"}},[t._v("37]"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v('ä¸€æ—¦å»ºç«‹äº†è¿æ¥ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥åœ¨å…¨åŒå·¥æ¨¡å¼ä¸‹æ¥å›å‘é€WebSocketæ•°æ®æˆ–æ–‡æœ¬å¸§ã€‚WebSocket ä¼ è¾“è¢«æè¿°ä¸º "æ¶ˆæ¯"ï¼Œå…¶ä¸­å•ä¸ªæ¶ˆæ¯å¯ä»¥é€‰æ‹©åœ¨å¤šä¸ªæ•°æ®å¸§ä¸­åˆ†å‰²ï¼Œè¿™å…è®¸å‘é€åˆå§‹æ•°æ®å¯ç”¨ä½†æ¶ˆæ¯çš„å®Œæ•´é•¿åº¦æœªçŸ¥çš„æ¶ˆæ¯ï¼ˆå®ƒå‘é€ä¸€ä¸ªåˆä¸€ä¸ªæ•°æ®å¸§ï¼Œç›´åˆ°åˆ°è¾¾ç»ˆç‚¹å¹¶æ ‡æœ‰ FIN ä½ï¼‰ã€‚é€šè¿‡åè®®çš„æ‰©å±•ï¼Œè¿™è¿˜å¯ç”¨äºåŒæ—¶å¤šè·¯å¤ç”¨å¤šä¸ªæµï¼ˆä¾‹å¦‚ï¼Œé¿å…å¯¹å•ä¸ªå¤§å‹æœ‰æ•ˆè´Ÿè½½çš„å¥—æ¥å­—è¿›è¡Œç‹¬å ä½¿ç”¨ï¼‰ã€‚')]),t._v(" "),s("br"),t._v(" "),s("h2",{attrs:{id:"_4-å®¢æˆ·ç«¯é€šä¿¡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-å®¢æˆ·ç«¯é€šä¿¡"}},[t._v("#")]),t._v(" 4. å®¢æˆ·ç«¯é€šä¿¡")]),t._v(" "),s("h3",{attrs:{id:"_4-1-websocketå¯¹è±¡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-websocketå¯¹è±¡"}},[t._v("#")]),t._v(" 4.1 WebSocketå¯¹è±¡")]),t._v(" "),s("p",[t._v("â€‹\tåˆ›å»ºWebSocketå¯¹è±¡ï¼š")]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" ws "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocket")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//è¯·æ±‚çš„åœ°å€")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("blockquote",[s("p",[t._v("å‚æ•°urlæ ¼å¼ï¼š"),s("code",[t._v("ws://ipåœ°å€:ç«¯å£å·/èµ„æºåç§°")])])]),t._v(" "),s("h3",{attrs:{id:"_4-2-websocketäº‹ä»¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-websocketäº‹ä»¶"}},[t._v("#")]),t._v(" 4.2 WebSocketäº‹ä»¶")]),t._v(" "),s("p",[t._v("WebSocketå¯¹è±¡çš„ç›¸å…³äº‹ä»¶ï¼š")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("äº‹ä»¶")]),t._v(" "),s("th",[t._v("äº‹ä»¶å¤„ç†ç¨‹åº")]),t._v(" "),s("th",[t._v("æè¿°")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("open")]),t._v(" "),s("td",[t._v("websocketå¯¹è±¡.onopen")]),t._v(" "),s("td",[t._v("è¿æ¥å»ºç«‹æ—¶è§¦å‘")])]),t._v(" "),s("tr",[s("td",[t._v("message")]),t._v(" "),s("td",[t._v("websocketå¯¹è±¡.onmessage")]),t._v(" "),s("td",[t._v("å®¢æˆ·ç«¯æ¥æ”¶æœåŠ¡ç«¯æ•°æ®æ—¶è§¦å‘")])]),t._v(" "),s("tr",[s("td",[t._v("error")]),t._v(" "),s("td",[t._v("websocketå¯¹è±¡.onerror")]),t._v(" "),s("td",[t._v("é€šä¿¡å‘ç”Ÿé”™è¯¯æ˜¯è§¦å‘")])]),t._v(" "),s("tr",[s("td",[t._v("close")]),t._v(" "),s("td",[t._v("websocketå¯¹è±¡.onclose")]),t._v(" "),s("td",[t._v("è¿æ¥å…³é—­æ—¶è§¦å‘")])])])]),t._v(" "),s("h3",{attrs:{id:"_4-3-websocketæ–¹æ³•"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-websocketæ–¹æ³•"}},[t._v("#")]),t._v(" 4.3 WebSocketæ–¹æ³•")]),t._v(" "),s("p",[t._v("WebSocketå¯¹è±¡çš„ç›¸å…³æ–¹æ³•ï¼š")]),t._v(" "),s("p",[s("code",[t._v("send()")]),t._v("ï¼šä½¿ç”¨è¿æ¥å‘é€æ•°æ®")]),t._v(" "),s("br"),t._v(" "),s("h2",{attrs:{id:"_5-æœåŠ¡ç«¯é€šä¿¡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-æœåŠ¡ç«¯é€šä¿¡"}},[t._v("#")]),t._v(" 5. æœåŠ¡ç«¯é€šä¿¡")]),t._v(" "),s("p",[t._v("Java Websocketåº”ç”¨ç”±ä¸€ç³»åˆ—çš„ "),s("code",[t._v("WebSocketEndpoint")]),t._v("ç»„æˆã€‚ "),s("code",[t._v("Endpoint")]),t._v("æ˜¯ä¸€ä¸ªjavaå¯¹è±¡ï¼Œä»£è¡¨ WebSocketé“¾æ¥çš„ä¸€ç«¯ã€‚å¯¹äºæœåŠ¡ç«¯ï¼Œæˆ‘ä»¬å¯ä»¥è§†ä¸ºå¤„ç†å…·ä½“WebSocketæ¶ˆæ¯çš„æ¥å£ï¼Œå°±åƒServletä¹‹ä¸HTTPè¯·æ±‚ä¸€æ ·ã€‚\næˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼å®šä¹‰ Endpointï¼š")]),t._v(" "),s("ul",[s("li",[t._v("ç¬¬ä¸€ç§æ˜¯ç¼–ç¨‹å¼ï¼Œå³ç»§æ‰¿ç±» "),s("code",[t._v("javax.websocket")]),t._v("ï¼ŒEndpointå¹¶å®ç°å…¶æ–¹æ³•")]),t._v(" "),s("li",[t._v("ç¬¬äºŒç§æ˜¯æ³¨è§£å¼ï¼Œå³å®šä¹‰ä¸€ä¸ª"),s("code",[t._v("POJO")]),t._v("ï¼Œå¹¶æ·»åŠ  "),s("code",[t._v("ServerEndpoint")]),t._v("ç›¸å…³æ³¨è§£")])]),t._v(" "),s("p",[s("code",[t._v("Endpoint")]),t._v("å®ä¾‹åœ¨ WebSocketæ¡æ‰‹æ—¶åˆ›å»ºï¼Œå¹¶åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é“¾æ¥è¿‡ç¨‹ä¸­æœ‰æ•ˆï¼Œæœ€ååœ¨é“¾æ¥å…³é—­æ—¶ç»“æŸã€‚åœ¨Endpointæ¥å£ä¸­æ˜ç¡®å®šä¹‰äº†ä¸å…¶ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„æ–¹æ³•ï¼Œè§„èŒƒå®ç°è€…ç¡®ä¿ç”Ÿå‘½å‘¨æœŸçš„å„ä¸ªé˜¶æ®µè°ƒç”¨å®ä¾‹çš„ç›¸å…³æ–¹æ³•ã€‚ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å¦‚ä¸‹ï¼š")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("æ–¹æ³•")]),t._v(" "),s("th",[t._v("å«ä¹‰")]),t._v(" "),s("th",[t._v("æ³¨è§£")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("onClose")]),t._v(" "),s("td",[t._v("å½“ä¼šè¯å¼€å¯æ—¶è°ƒç”¨")]),t._v(" "),s("td",[t._v("@OoClose")])]),t._v(" "),s("tr",[s("td",[t._v("onOpen")]),t._v(" "),s("td",[t._v("å½“å¼€å¯ä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æ¡æ‰‹æˆåŠŸåè°ƒç”¨")]),t._v(" "),s("td",[t._v("@OnOpen")])]),t._v(" "),s("tr",[s("td",[t._v("onError")]),t._v(" "),s("td",[t._v("è¿æ¥è§„ç¨‹ä¸­äº§ç”Ÿå¼‚å¸¸")]),t._v(" "),s("td",[t._v("@OnError")])]),t._v(" "),s("tr",[s("td",[t._v("OnMessage")]),t._v(" "),s("td",[t._v("å®¢æˆ·ç«¯æ¥æ”¶æœåŠ¡ç«¯æ•°æ®æ—¶è§¦å‘")]),t._v(" "),s("td",[t._v("@OnMessage")])])])]),t._v(" "),s("p",[s("strong",[t._v("æœåŠ¡ç«¯å¦‚ä½•æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®å‘¢ï¼Ÿ")])]),t._v(" "),s("p",[t._v("é€šè¿‡ä¸º Sessionæ·»åŠ  MessageHandleræ¶ˆæ¯å¤„ç†å™¨æ¥æ¥æ”¶æ¶ˆæ¯ï¼Œå½“é‡‡ç”¨æ³¨è§£æ–¹å¼å®šä¹‰ Endpointæ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡"),s("code",[t._v("@OnMessage")]),t._v("æ³¨è§£æŒ‡å®šæ¥æ”¶æ¶ˆæ¯çš„æ–¹æ³•ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("æœåŠ¡ç«¯å¦‚ä½•æ¨é€æ•°æ®ç»å®¢æˆ·ç«¯å‘¢ï¼Ÿ")])]),t._v(" "),s("p",[t._v("å‘é€æ¶ˆæ¯åˆ™ç”± RemoteEndpointå®Œæˆï¼Œå…¶å®ä¾‹ç”± sessionç»´æŠ¤ï¼Œæ ¹æ®ä½¿ç”¨æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡"),s("code",[t._v("Session.getBasicRemote")]),t._v("è·å–åŒæ­¥æ¶ˆæ¯å‘é€çš„å®ä¾‹ï¼Œç„¶åè°ƒç”¨å…¶ "),s("code",[t._v("sendXxx()")]),t._v("æ–¹æ³•å°±å¯ä»¥å‘é€æ¶ˆæ¯ï¼Œå¯ä»¥é€šè¿‡"),s("code",[t._v("Session.getAsyncRemote")]),t._v("è·å–å¼‚æ­¥æ¶ˆæ¯å‘é€å®ä¾‹")]),t._v(" "),s("h3",{attrs:{id:"å¿ƒè·³ä¿æ´»"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å¿ƒè·³ä¿æ´»"}},[t._v("#")]),t._v(" å¿ƒè·³ä¿æ´»")]),t._v(" "),s("p",[t._v("åœ¨å®é™…ä½¿ç”¨ WebSocket ä¸­ï¼Œé•¿æ—¶é—´ä¸é€šæ¶ˆæ¯å¯èƒ½ä¼šå‡ºç°ä¸€äº›è¿æ¥ä¸ç¨³å®šçš„æƒ…å†µï¼Œè¿™äº›æœªçŸ¥æƒ…å†µå¯¼è‡´çš„è¿æ¥ä¸­æ–­ä¼šå½±å“å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹å‰çš„é€šä¿¡ï¼Œ")]),t._v(" "),s("p",[t._v("ä¸ºäº†é˜²æ­¢è¿™ç§çš„æƒ…å†µçš„å‡ºç°ï¼Œæœ‰ä¸€ç§å¿ƒè·³ä¿æ´»çš„æ–¹æ³•ï¼šå®¢æˆ·ç«¯å°±åƒå¿ƒè·³ä¸€æ ·æ¯éš”å›ºå®šçš„æ—¶é—´å‘é€ä¸€æ¬¡ pingï¼Œæ¥å‘Šè¯‰æœåŠ¡å™¨ï¼Œæˆ‘è¿˜æ´»ç€ï¼Œè€ŒæœåŠ¡å™¨ä¹Ÿä¼šè¿”å› pongï¼Œæ¥å‘Šè¯‰å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨è¿˜æ´»ç€ã€‚ping/pong å…¶å®æ˜¯ä¸€æ¡ä¸ä¸šåŠ¡æ— å…³çš„å‡æ¶ˆæ¯ï¼Œä¹Ÿç§°ä¸ºå¿ƒè·³åŒ…ã€‚")]),t._v(" "),s("p",[t._v("å¯ä»¥åœ¨è¿æ¥æˆåŠŸä¹‹åï¼Œæ¯éš”ä¸€ä¸ªå›ºå®šæ—¶é—´å‘é€å¿ƒè·³åŒ…ï¼Œæ¯”å¦‚ 60s:")]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setInterval")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ws"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'è¿™æ˜¯ä¸€æ¡å¿ƒè·³åŒ…æ¶ˆæ¯'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("60000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210626192359.webp",alt:""}})]),t._v(" "),s("p",[t._v("é€šè¿‡ä¸Šé¢çš„ä»‹ç»ï¼Œå¤§å®¶åº”è¯¥å¯¹ WebSocket æœ‰äº†ä¸€å®šè®¤è¯†ï¼Œå…¶å®å¹¶ä¸ç¥ç§˜ï¼Œè¿™é‡Œå¯¹æ–‡ç« å†…å®¹ç®€å•æ€»ç»“ä¸€ä¸‹ã€‚å½“åˆ›å»º WebSocket å®ä¾‹çš„æ—¶å€™ï¼Œä¼šå‘ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œè¯·æ±‚æŠ¥æ–‡ä¸­æœ‰ä¸ªç‰¹æ®Šçš„å­—æ®µ Upgradeï¼Œç„¶åè¿™ä¸ªè¿æ¥ä¼šç”± HTTP åè®®è½¬æ¢ä¸º WebSocket åè®®ï¼Œè¿™æ ·å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å»ºç«‹äº†å…¨åŒå·¥é€šä¿¡ï¼Œé€šè¿‡ WebSocket çš„ send æ–¹æ³•å’Œ onmessage äº‹ä»¶å°±å¯ä»¥é€šè¿‡è¿™æ¡é€šä¿¡è¿æ¥äº¤æ¢ä¿¡æ¯ã€‚")]),t._v(" "),s("br"),t._v(" "),s("h2",{attrs:{id:"_6-websocketç¤ºä¾‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-websocketç¤ºä¾‹"}},[t._v("#")]),t._v(" 6. WebSocketç¤ºä¾‹")]),t._v(" "),s("p",[s("strong",[t._v("1. é¦–å…ˆåˆ›å»ºmavenå·¥ç¨‹")])]),t._v(" "),s("p",[t._v("ã€ç›®å½•ç»“æ„å¦‚å›¾ã€‘")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocketChatDemo")]),t._v("\n â”œâ”€â”€ pom"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("xml\n â”œâ”€â”€ src\n â”‚   â””â”€â”€ main\n â”‚       â”œâ”€â”€ java\n â”‚       â”‚   â””â”€â”€ top"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("iqqcode\n â”‚\t             â””â”€â”€ "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocketTest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("java\n â”‚       â””â”€â”€ webapp\n â”‚           â”œâ”€â”€ index"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html\n â”‚           â””â”€â”€ "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("WEB")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INF")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("p",[s("strong",[t._v("2. pomä¾èµ–")])]),t._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[t._v("\t"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("javax"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("javaee-api"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("7.0"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("scope")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("provided"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("scope")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- https://mvnrepository.com/artifact/org.java-websocket/Java-WebSocket --\x3e")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.java-websocket"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Java-WebSocket"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("1.5.1"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br")])]),s("p",[s("strong",[t._v("3. æœåŠ¡ç«¯ä»£ç -WebSocketTest.java")])]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("concurrent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CopyOnWriteArraySet")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("concurrent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("atomic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AtomicInteger")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("javax"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("websocket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("javax"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("websocket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServerEndpoint")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * @ServerEndpoint æ³¨è§£æ˜¯ä¸€ä¸ªç±»å±‚æ¬¡çš„æ³¨è§£ï¼Œå®ƒçš„åŠŸèƒ½ä¸»è¦æ˜¯å°†ç›®å‰çš„ç±»å®šä¹‰æˆä¸€ä¸ªwebsocketæœåŠ¡å™¨ç«¯,\n * æ³¨è§£çš„å€¼å°†è¢«ç”¨äºç›‘å¬ç”¨æˆ·è¿æ¥çš„ç»ˆç«¯è®¿é—®URLåœ°å€,å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¿™ä¸ªURLæ¥è¿æ¥åˆ°WebSocketæœåŠ¡å™¨ç«¯\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@ServerEndpoint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/websocket"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocketTest")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// é™æ€å˜é‡ï¼Œç”¨æ¥è®°å½•å½“å‰åœ¨çº¿è¿æ¥æ•°ã€‚åº”è¯¥æŠŠå®ƒè®¾è®¡æˆçº¿ç¨‹å®‰å…¨çš„ã€‚")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AtomicInteger")]),t._v(" onlineCount "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AtomicInteger")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// (ç¾¤èŠ) ConcurrentåŒ…çš„çº¿ç¨‹å®‰å…¨Setï¼Œç”¨æ¥å­˜æ”¾æ¯ä¸ªå®¢æˆ·ç«¯å¯¹åº”çš„MyWebSocketå¯¹è±¡ã€‚")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// (ç§èŠ) è‹¥è¦å®ç°æœåŠ¡ç«¯ä¸å•ä¸€å®¢æˆ·ç«¯é€šä¿¡çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨Mapæ¥å­˜æ”¾ï¼Œå…¶ä¸­Keyå¯ä»¥ä¸ºç”¨æˆ·æ ‡è¯†")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CopyOnWriteArraySet")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocketTest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" webSocketSet "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CopyOnWriteArraySet")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocketTest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä¸æŸä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ä¼šè¯ï¼Œéœ€è¦é€šè¿‡å®ƒæ¥ç»™å®¢æˆ·ç«¯å‘é€æ•°æ®")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Session")]),t._v(" session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * è¿æ¥å»ºç«‹æˆåŠŸè°ƒç”¨çš„æ–¹æ³•\n     *\n     * @param session å¯é€‰çš„å‚æ•°ã€‚sessionä¸ºä¸æŸä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ä¼šè¯ï¼Œéœ€è¦é€šè¿‡å®ƒæ¥ç»™å®¢æˆ·ç«¯å‘é€æ•°æ®\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@OnOpen")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onOpen")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Session")]),t._v(" session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("session "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        webSocketSet"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//åŠ å…¥setä¸­")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addOnlineCount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//åœ¨çº¿æ•°åŠ 1")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"æœ‰æ–°è¿æ¥åŠ å…¥ï¼å½“å‰åœ¨çº¿äººæ•°ä¸º"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getOnlineCount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯åè°ƒç”¨çš„æ–¹æ³•\n     *\n     * @param message å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ¶ˆæ¯\n     * @param session å¯é€‰çš„å‚æ•°\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@OnMessage")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Session")]),t._v(" session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"æ¥è‡ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯:"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//ç¾¤å‘æ¶ˆæ¯")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocketTest")]),t._v(" item "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" webSocketSet"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("continue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * è¿æ¥å…³é—­è°ƒç”¨çš„æ–¹æ³•\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@OnClose")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onClose")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        webSocketSet"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("remove")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//ä»setä¸­åˆ é™¤")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("subOnlineCount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//åœ¨çº¿æ•°å‡1")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"æœ‰ä¸€è¿æ¥å…³é—­ï¼å½“å‰åœ¨çº¿äººæ•°ä¸º"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getOnlineCount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * å‘ç”Ÿé”™è¯¯æ—¶è°ƒç”¨\n     *\n     * @param session\n     * @param error\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@OnError")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onError")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Session")]),t._v(" session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Throwable")]),t._v(" error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"å‘ç”Ÿé”™è¯¯"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * å‘é€ä¿¡æ¯æ–¹æ³•\n     * è¿™ä¸ªæ–¹æ³•ä¸ä¸Šé¢å‡ ä¸ªæ–¹æ³•ä¸ä¸€æ ·ã€‚æ²¡æœ‰ç”¨æ³¨è§£ï¼Œæ˜¯æ ¹æ®è‡ªå·±éœ€è¦æ·»åŠ çš„æ–¹æ³•\n     *\n     * @param message\n     * @throws IOException\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("session"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBasicRemote")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendText")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//this.session.getAsyncRemote().sendText(message);")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * (çº¿ç¨‹å®‰å…¨) è·å–åœ¨çº¿äººæ•°\n     * @return\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AtomicInteger")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getOnlineCount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" onlineCount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// (çº¿ç¨‹å®‰å…¨) åœ¨çº¿äººæ•° +1")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addOnlineCount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocketTest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onlineCount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("incrementAndGet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// (çº¿ç¨‹å®‰å…¨) åœ¨çº¿äººæ•° -1")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("subOnlineCount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocketTest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onlineCount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("decrementAndGet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br"),s("span",{staticClass:"line-number"},[t._v("44")]),s("br"),s("span",{staticClass:"line-number"},[t._v("45")]),s("br"),s("span",{staticClass:"line-number"},[t._v("46")]),s("br"),s("span",{staticClass:"line-number"},[t._v("47")]),s("br"),s("span",{staticClass:"line-number"},[t._v("48")]),s("br"),s("span",{staticClass:"line-number"},[t._v("49")]),s("br"),s("span",{staticClass:"line-number"},[t._v("50")]),s("br"),s("span",{staticClass:"line-number"},[t._v("51")]),s("br"),s("span",{staticClass:"line-number"},[t._v("52")]),s("br"),s("span",{staticClass:"line-number"},[t._v("53")]),s("br"),s("span",{staticClass:"line-number"},[t._v("54")]),s("br"),s("span",{staticClass:"line-number"},[t._v("55")]),s("br"),s("span",{staticClass:"line-number"},[t._v("56")]),s("br"),s("span",{staticClass:"line-number"},[t._v("57")]),s("br"),s("span",{staticClass:"line-number"},[t._v("58")]),s("br"),s("span",{staticClass:"line-number"},[t._v("59")]),s("br"),s("span",{staticClass:"line-number"},[t._v("60")]),s("br"),s("span",{staticClass:"line-number"},[t._v("61")]),s("br"),s("span",{staticClass:"line-number"},[t._v("62")]),s("br"),s("span",{staticClass:"line-number"},[t._v("63")]),s("br"),s("span",{staticClass:"line-number"},[t._v("64")]),s("br"),s("span",{staticClass:"line-number"},[t._v("65")]),s("br"),s("span",{staticClass:"line-number"},[t._v("66")]),s("br"),s("span",{staticClass:"line-number"},[t._v("67")]),s("br"),s("span",{staticClass:"line-number"},[t._v("68")]),s("br"),s("span",{staticClass:"line-number"},[t._v("69")]),s("br"),s("span",{staticClass:"line-number"},[t._v("70")]),s("br"),s("span",{staticClass:"line-number"},[t._v("71")]),s("br"),s("span",{staticClass:"line-number"},[t._v("72")]),s("br"),s("span",{staticClass:"line-number"},[t._v("73")]),s("br"),s("span",{staticClass:"line-number"},[t._v("74")]),s("br"),s("span",{staticClass:"line-number"},[t._v("75")]),s("br"),s("span",{staticClass:"line-number"},[t._v("76")]),s("br"),s("span",{staticClass:"line-number"},[t._v("77")]),s("br"),s("span",{staticClass:"line-number"},[t._v("78")]),s("br"),s("span",{staticClass:"line-number"},[t._v("79")]),s("br"),s("span",{staticClass:"line-number"},[t._v("80")]),s("br"),s("span",{staticClass:"line-number"},[t._v("81")]),s("br"),s("span",{staticClass:"line-number"},[t._v("82")]),s("br"),s("span",{staticClass:"line-number"},[t._v("83")]),s("br"),s("span",{staticClass:"line-number"},[t._v("84")]),s("br"),s("span",{staticClass:"line-number"},[t._v("85")]),s("br"),s("span",{staticClass:"line-number"},[t._v("86")]),s("br"),s("span",{staticClass:"line-number"},[t._v("87")]),s("br"),s("span",{staticClass:"line-number"},[t._v("88")]),s("br"),s("span",{staticClass:"line-number"},[t._v("89")]),s("br"),s("span",{staticClass:"line-number"},[t._v("90")]),s("br"),s("span",{staticClass:"line-number"},[t._v("91")]),s("br"),s("span",{staticClass:"line-number"},[t._v("92")]),s("br"),s("span",{staticClass:"line-number"},[t._v("93")]),s("br"),s("span",{staticClass:"line-number"},[t._v("94")]),s("br"),s("span",{staticClass:"line-number"},[t._v("95")]),s("br"),s("span",{staticClass:"line-number"},[t._v("96")]),s("br"),s("span",{staticClass:"line-number"},[t._v("97")]),s("br"),s("span",{staticClass:"line-number"},[t._v("98")]),s("br"),s("span",{staticClass:"line-number"},[t._v("99")]),s("br"),s("span",{staticClass:"line-number"},[t._v("100")]),s("br"),s("span",{staticClass:"line-number"},[t._v("101")]),s("br"),s("span",{staticClass:"line-number"},[t._v("102")]),s("br"),s("span",{staticClass:"line-number"},[t._v("103")]),s("br"),s("span",{staticClass:"line-number"},[t._v("104")]),s("br"),s("span",{staticClass:"line-number"},[t._v("105")]),s("br"),s("span",{staticClass:"line-number"},[t._v("106")]),s("br"),s("span",{staticClass:"line-number"},[t._v("107")]),s("br"),s("span",{staticClass:"line-number"},[t._v("108")]),s("br")])]),s("p",[s("strong",[t._v("4. é¡µé¢åŠå®¢æˆ·ç«¯ä»£ç ")])]),t._v(" "),s("div",{staticClass:"language-html line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token doctype"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),s("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("ChatDemo"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("ã€€ã€€ã€€ã€€ã€€ã€€\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("viewport"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    ã€€ã€€ã€€ã€€\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("http-equiv")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("Content-Type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("text/html; charset=utf-8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\nWelcome"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("br")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("input")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("text"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("text"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("button")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token special-attr"}},[s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onclick")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),s("span",{pre:!0,attrs:{class:"token value javascript language-javascript"}},[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("å‘é€æ¶ˆæ¯"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("button")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("hr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("button")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token special-attr"}},[s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onclick")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),s("span",{pre:!0,attrs:{class:"token value javascript language-javascript"}},[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("closeWebSocket")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("å…³é—­WebSocketè¿æ¥"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("button")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("hr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--å®¢æˆ·ç«¯ä»£ç --\x3e")]),t._v("    \n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("text/javascript"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}},[s("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" websocket "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//åˆ¤æ–­å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒWebSocket")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'WebSocket'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        websocket "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebSocket")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ws://localhost:8080/websocket"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'å½“å‰æµè§ˆå™¨ Not support websocket'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//è¿æ¥å‘ç”Ÿé”™è¯¯çš„å›è°ƒæ–¹æ³•")]),t._v("\n    websocket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onerror")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setMessageInnerHTML")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"WebSocketè¿æ¥å‘ç”Ÿé”™è¯¯"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//è¿æ¥æˆåŠŸå»ºç«‹çš„å›è°ƒæ–¹æ³•")]),t._v("\n    websocket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onopen")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setMessageInnerHTML")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"WebSocketè¿æ¥æˆåŠŸ"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//æ¥æ”¶åˆ°æ¶ˆæ¯çš„å›è°ƒæ–¹æ³•")]),t._v("\n    websocket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setMessageInnerHTML")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//è¿æ¥å…³é—­çš„å›è°ƒæ–¹æ³•")]),t._v("\n    websocket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onclose")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setMessageInnerHTML")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"WebSocketè¿æ¥å…³é—­"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//ç›‘å¬çª—å£å…³é—­äº‹ä»¶ï¼Œå½“çª—å£å…³é—­æ—¶ï¼Œä¸»åŠ¨å»å…³é—­websocketè¿æ¥ï¼Œé˜²æ­¢è¿æ¥è¿˜æ²¡æ–­å¼€å°±å…³é—­çª—å£ï¼Œserverç«¯ä¼šæŠ›å¼‚å¸¸ã€‚")]),t._v("\n    window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onbeforeunload")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("closeWebSocket")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//å°†æ¶ˆæ¯æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Š")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setMessageInnerHTML")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("innerHTML")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerHTML "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" innerHTML "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<br/>'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//å…³é—­WebSocketè¿æ¥")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("closeWebSocket")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        websocket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//å‘é€æ¶ˆæ¯")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" message "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        websocket"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br"),s("span",{staticClass:"line-number"},[t._v("44")]),s("br"),s("span",{staticClass:"line-number"},[t._v("45")]),s("br"),s("span",{staticClass:"line-number"},[t._v("46")]),s("br"),s("span",{staticClass:"line-number"},[t._v("47")]),s("br"),s("span",{staticClass:"line-number"},[t._v("48")]),s("br"),s("span",{staticClass:"line-number"},[t._v("49")]),s("br"),s("span",{staticClass:"line-number"},[t._v("50")]),s("br"),s("span",{staticClass:"line-number"},[t._v("51")]),s("br"),s("span",{staticClass:"line-number"},[t._v("52")]),s("br"),s("span",{staticClass:"line-number"},[t._v("53")]),s("br"),s("span",{staticClass:"line-number"},[t._v("54")]),s("br"),s("span",{staticClass:"line-number"},[t._v("55")]),s("br"),s("span",{staticClass:"line-number"},[t._v("56")]),s("br"),s("span",{staticClass:"line-number"},[t._v("57")]),s("br"),s("span",{staticClass:"line-number"},[t._v("58")]),s("br"),s("span",{staticClass:"line-number"},[t._v("59")]),s("br"),s("span",{staticClass:"line-number"},[t._v("60")]),s("br"),s("span",{staticClass:"line-number"},[t._v("61")]),s("br"),s("span",{staticClass:"line-number"},[t._v("62")]),s("br"),s("span",{staticClass:"line-number"},[t._v("63")]),s("br"),s("span",{staticClass:"line-number"},[t._v("64")]),s("br"),s("span",{staticClass:"line-number"},[t._v("65")]),s("br"),s("span",{staticClass:"line-number"},[t._v("66")]),s("br"),s("span",{staticClass:"line-number"},[t._v("67")]),s("br"),s("span",{staticClass:"line-number"},[t._v("68")]),s("br"),s("span",{staticClass:"line-number"},[t._v("69")]),s("br")])]),s("p",[s("strong",[t._v("5. æµ‹è¯•")])]),t._v(" "),s("p",[t._v("åŒæ–¹äº’ç›¸å‘é€æ¶ˆæ¯~")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210626192408.png",alt:"image-20201211090322335"}})]),t._v(" "),s("p",[t._v("åå°æ—¥å¿—æ‰“å°å½“å‰èŠå¤©äººæ•°ï¼š")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/imgs02/20201211091551.png",alt:""}})]),t._v(" "),s("br"),t._v(" "),s("h2",{attrs:{id:"_7-websocketä»‹ç»å’Œsocketçš„åŒºåˆ«"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-websocketä»‹ç»å’Œsocketçš„åŒºåˆ«"}},[t._v("#")]),t._v(" 7. WebSocketä»‹ç»å’ŒSocketçš„åŒºåˆ«")]),t._v(" "),s("blockquote",[s("p",[t._v("ä»¥ä¸‹ä¸¤ä¸ªæ ‡é¢˜æ®µä¸ºè½¬è½½å†…å®¹ï¼ŒåŸæ–‡æŸ¥çœ‹ğŸ‘‰ä¸€ç¼•æ®‡æµåŒ–éšåŠè¾¹å†°éœœ.ã€Šè°ˆè°ˆ Websocketã€‹"),s("a",{attrs:{href:"https://halfrost.com/ios_weixin_qq_websocket/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://halfrost.com/ios_weixin_qq_websocket/"),s("OutboundLink")],1)])]),t._v(" "),s("p",[s("strong",[t._v("Socket å…¶å®å¹¶ä¸æ˜¯ä¸€ä¸ªåè®®ã€‚å®ƒå·¥ä½œåœ¨ OSI æ¨¡å‹ä¼šè¯å±‚ï¼ˆç¬¬5å±‚ï¼‰ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿å¤§å®¶ç›´æ¥ä½¿ç”¨æ›´åº•å±‚åè®®ï¼ˆä¸€èˆ¬æ˜¯ TCP æˆ– UDP ï¼‰è€Œå­˜åœ¨çš„ä¸€ä¸ªæŠ½è±¡å±‚ã€‚Socketæ˜¯å¯¹TCP/IPåè®®çš„å°è£…ï¼ŒSocketæœ¬èº«å¹¶ä¸æ˜¯åè®®ï¼Œè€Œæ˜¯ä¸€ä¸ªè°ƒç”¨æ¥å£(API)ã€‚")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/20210626192414.png",alt:"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"}})]),t._v(" "),s("p",[t._v("å½“ä¸¤å°ä¸»æœºé€šä¿¡æ—¶ï¼Œå¿…é¡»é€šè¿‡Socketè¿æ¥ï¼ŒSocketåˆ™åˆ©ç”¨TCP/IPåè®®å»ºç«‹TCPè¿æ¥ã€‚TCPè¿æ¥åˆ™æ›´ä¾é äºåº•å±‚çš„IPåè®®ï¼ŒIPåè®®çš„è¿æ¥åˆ™ä¾èµ–äºé“¾è·¯å±‚ç­‰æ›´ä½å±‚æ¬¡ã€‚Socketæ˜¯ä¼ è¾“æ§åˆ¶å±‚åè®®ï¼ŒWebSocketæ˜¯åº”ç”¨å±‚åè®®ã€‚")]),t._v(" "),s("p",[t._v("Socketé€šå¸¸ä¹Ÿç§°ä½œ "),s("strong",[t._v("å¥—æ¥å­—")]),t._v("ï¼Œç”¨äºæè¿°IPåœ°å€å’Œç«¯å£ï¼Œæ˜¯ä¸€ä¸ªé€šä¿¡é“¾çš„å¥æŸ„ã€‚ç½‘ç»œä¸Šçš„ä¸¤ä¸ªç¨‹åºé€šè¿‡ä¸€ä¸ªåŒå‘çš„é€šè®¯è¿æ¥å®ç°æ•°æ®çš„äº¤æ¢ï¼Œè¿™ä¸ªåŒå‘é“¾è·¯çš„ä¸€ç«¯ç§°ä¸ºä¸€ä¸ªSocketï¼Œä¸€ä¸ªSocketç”±ä¸€ä¸ªIPåœ°å€å’Œä¸€ä¸ªç«¯å£å·å”¯ä¸€ç¡®å®šã€‚åº”ç”¨ç¨‹åºé€šå¸¸é€šè¿‡â€å¥—æ¥å­—â€å‘ç½‘ç»œå‘å‡ºè¯·æ±‚æˆ–è€…åº”ç­”ç½‘ç»œè¯·æ±‚ã€‚")]),t._v(" "),s("p",[t._v("Socketåœ¨é€šè®¯è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡ç«¯ç›‘å¬æŸä¸ªç«¯å£æ˜¯å¦æœ‰è¿æ¥è¯·æ±‚ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€è¿æ¥è¯·æ±‚ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°è¿æ¥è¯·æ±‚å‘å®¢æˆ·ç«¯å‘å‡ºæ¥æ”¶æ¶ˆæ¯ï¼Œè¿™æ ·ä¸€ä¸ªè¿æ¥å°±å»ºç«‹èµ·æ¥äº†ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹Ÿéƒ½å¯ä»¥ç›¸äº’å‘é€æ¶ˆæ¯ä¸å¯¹æ–¹è¿›è¡Œé€šè®¯ï¼Œç›´åˆ°åŒæ–¹è¿æ¥æ–­å¼€ã€‚")]),t._v(" "),s("p",[t._v("æ‰€ä»¥åŸºäºWebSocketå’ŒåŸºäºSocketéƒ½å¯ä»¥å¼€å‘å‡ºIMç¤¾äº¤èŠå¤©ç±»çš„å³æ—¶é€šè®¯app")]),t._v(" "),s("br"),t._v(" "),s("h2",{attrs:{id:"_8-websocketçš„ä½¿ç”¨åœºæ™¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-websocketçš„ä½¿ç”¨åœºæ™¯"}},[t._v("#")]),t._v(" 8. WebSocketçš„ä½¿ç”¨åœºæ™¯")]),t._v(" "),s("p",[s("strong",[t._v("1.ç¤¾äº¤èŠå¤©")])]),t._v(" "),s("p",[t._v("æœ€è‘—åçš„å°±æ˜¯å¾®ä¿¡ï¼ŒQQï¼Œè¿™ä¸€ç±»ç¤¾äº¤èŠå¤©çš„appã€‚è¿™ä¸€ç±»èŠå¤©appçš„ç‰¹ç‚¹æ˜¯ä½å»¶è¿Ÿï¼Œé«˜å³æ—¶ã€‚å³æ—¶æ˜¯è¿™é‡Œé¢è¦æ±‚æœ€é«˜çš„ï¼Œå¦‚æœæœ‰ä¸€ä¸ªç´§æ€¥çš„äº‹æƒ…ï¼Œé€šè¿‡IMè½¯ä»¶é€šçŸ¥ä½ ï¼Œå‡è®¾ç½‘ç»œç¯å¢ƒè‰¯å¥½çš„æƒ…å†µä¸‹ï¼Œè¿™æ¡messageè¿˜æ— æ³•ç«‹å³é€è¾¾åˆ°ä½ çš„å®¢æˆ·ç«¯ä¸Šï¼Œç´§æ€¥çš„äº‹æƒ…éƒ½ç»“æŸäº†ï¼Œä½ æ‰æ”¶åˆ°æ¶ˆæ¯ï¼Œé‚£ä¹ˆè¿™ä¸ªè½¯ä»¶è‚¯å®šæ˜¯å¤±è´¥çš„ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("2.å¼¹å¹•")])]),t._v(" "),s("p",[t._v("è¯´åˆ°è¿™é‡Œï¼Œå¤§å®¶ä¸€å®šé‡Œé¢æƒ³åˆ°äº†Aç«™å’ŒBç«™äº†ã€‚ç¡®å®ï¼Œä»–ä»¬çš„å¼¹å¹•ä¸€ç›´æ˜¯ä¸€ç§ç‰¹è‰²ã€‚è€Œä¸”å¼¹å¹•å¯¹äºä¸€ä¸ªè§†é¢‘æ¥è¯´ï¼Œå¾ˆå¯èƒ½å¼¹å¹•æ‰æ˜¯ç²¾åã€‚å‘å¼¹å¹•éœ€è¦å®æ—¶æ˜¾ç¤ºï¼Œä¹Ÿéœ€è¦å’ŒèŠå¤©ä¸€æ ·ï¼Œéœ€è¦å³æ—¶ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("3.å¤šç©å®¶æ¸¸æˆ")])]),t._v(" "),s("p",[s("strong",[t._v("4.ååŒç¼–è¾‘")])]),t._v(" "),s("p",[t._v("ç°åœ¨å¾ˆå¤šå¼€æºé¡¹ç›®éƒ½æ˜¯åˆ†æ•£åœ¨ä¸–ç•Œå„åœ°çš„å¼€å‘è€…ä¸€èµ·ååŒå¼€å‘ï¼Œæ­¤æ—¶å°±ä¼šç”¨åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œæ¯”å¦‚Gitï¼ŒSVNå»åˆå¹¶å†²çªã€‚ä½†æ˜¯å¦‚æœæœ‰ä¸€ä»½æ–‡æ¡£ï¼Œæ”¯æŒå¤šäººå®æ—¶åœ¨çº¿ååŒç¼–è¾‘ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šç”¨åˆ°æ¯”å¦‚WebSocketäº†ï¼Œå®ƒå¯ä»¥ä¿è¯å„ä¸ªç¼–è¾‘è€…éƒ½åœ¨ç¼–è¾‘åŒä¸€ä¸ªæ–‡æ¡£ï¼Œæ­¤æ—¶ä¸éœ€è¦ç”¨åˆ°Gitï¼ŒSVNè¿™äº›ç‰ˆæœ¬æ§åˆ¶ï¼Œå› ä¸ºåœ¨ååŒç¼–è¾‘ç•Œé¢å°±ä¼šå®æ—¶çœ‹åˆ°å¯¹æ–¹ç¼–è¾‘äº†ä»€ä¹ˆï¼Œè°åœ¨ä¿®æ”¹å“ªäº›æ®µè½å’Œæ–‡å­—ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("5.è‚¡ç¥¨åŸºé‡‘å®æ—¶æŠ¥ä»·")])]),t._v(" "),s("p",[t._v("é‡‘èç•Œç¬æ¯ä¸‡å˜â€”â€”å‡ ä¹æ˜¯æ¯æ¯«ç§’éƒ½åœ¨å˜åŒ–ã€‚å¦‚æœé‡‡ç”¨çš„ç½‘ç»œæ¶æ„æ— æ³•æ»¡è¶³å®æ—¶æ€§ï¼Œé‚£ä¹ˆå°±ä¼šç»™å®¢æˆ·å¸¦æ¥å·¨å¤§çš„æŸå¤±ã€‚å‡ æ¯«ç§’é’±è‚¡ç¥¨å¼€å§‹å¤§è·Œï¼Œå‡ ç§’ä»¥åæ‰åˆ·æ–°æ•°æ®ï¼Œä¸€ç§’é’Ÿçš„æ—¶é—´å†…ï¼Œå¾ˆå¯èƒ½ç”¨æˆ·å°±å·²ç»æŸå¤±å·¨å¤§è´¢äº§äº†ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("6.ä½“è‚²å®å†µæ›´æ–°")])]),t._v(" "),s("p",[t._v("å…¨ä¸–ç•Œçš„çƒè¿·ï¼Œä½“è‚²çˆ±å¥½è€…ç‰¹åˆ«å¤šï¼Œå½“ç„¶å¤§å®¶åœ¨å…³å¿ƒè‡ªå·±å–œæ¬¢çš„ä½“è‚²æ´»åŠ¨çš„æ—¶å€™ï¼Œæ¯”èµ›å®æ—¶çš„èµ›å†µæ˜¯ä»–ä»¬æœ€æœ€å…³å¿ƒçš„äº‹æƒ…ã€‚è¿™ç±»æ–°é—»ä¸­æœ€å¥½çš„ä½“éªŒå°±æ˜¯åˆ©ç”¨Websocketè¾¾åˆ°å®æ—¶çš„æ›´æ–°ï¼")]),t._v(" "),s("p",[s("strong",[t._v("7.è§†é¢‘ä¼šè®®/èŠå¤©")])]),t._v(" "),s("p",[t._v("è§†é¢‘ä¼šè®®å¹¶ä¸èƒ½ä»£æ›¿å’ŒçœŸäººç›¸è§ï¼Œä½†æ˜¯ä»–èƒ½è®©åˆ†å¸ƒåœ¨å…¨çƒå¤©æ¶¯æµ·è§’çš„äººèšåœ¨ç”µè„‘å‰ä¸€èµ·å¼€ä¼šã€‚æ—¢èƒ½èŠ‚çœå¤§å®¶èšåœ¨ä¸€èµ·è·¯ä¸ŠèŠ±è´¹çš„æ—¶é—´ï¼Œè®¨è®ºèšä¼šåœ°ç‚¹çš„çº ç»“ï¼Œè¿˜èƒ½éšæ—¶éšåœ°ï¼Œåªè¦æœ‰ç½‘ç»œå°±å¯ä»¥å¼€ä¼šã€‚")]),t._v(" "),s("p",[s("strong",[t._v("8.åŸºäºä½ç½®çš„åº”ç”¨")])]),t._v(" "),s("p",[t._v("è¶Šæ¥è¶Šå¤šçš„å¼€å‘è€…å€Ÿç”¨ç§»åŠ¨è®¾å¤‡çš„GPSåŠŸèƒ½æ¥å®ç°ä»–ä»¬åŸºäºä½ç½®çš„ç½‘ç»œåº”ç”¨ã€‚å¦‚æœä½ ä¸€ç›´è®°å½•ç”¨æˆ·çš„ä½ç½®(æ¯”å¦‚è¿è¡Œåº”ç”¨æ¥è®°å½•è¿åŠ¨è½¨è¿¹)ï¼Œä½ å¯ä»¥æ”¶é›†åˆ°æ›´åŠ ç»†è‡´åŒ–çš„æ•°æ®ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("9.åœ¨çº¿æ•™è‚²")])]),t._v(" "),s("p",[t._v("åœ¨çº¿æ•™è‚²è¿‘å‡ å¹´ä¹Ÿå‘å±•è¿…é€Ÿã€‚ä¼˜ç‚¹å¾ˆå¤šï¼Œå…å»äº†åœºåœ°çš„é™åˆ¶ï¼Œèƒ½è®©åå¸ˆçš„èµ„æºåˆç†çš„åˆ†é…ç»™å…¨å›½å„åœ°æƒ³è¦å­¦ä¹ çŸ¥è¯†çš„åŒå­¦æ‰‹ä¸Šï¼ŒWebsocketæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œå¯ä»¥è§†é¢‘èŠå¤©ã€å³æ—¶èŠå¤©ä»¥åŠå…¶ä¸åˆ«äººåˆä½œä¸€èµ·åœ¨ç½‘ä¸Šè®¨è®ºé—®é¢˜...")]),t._v(" "),s("p",[s("strong",[t._v("10.æ™ºèƒ½å®¶å±…")])]),t._v(" "),s("p",[t._v("è¿™ä¹Ÿæ˜¯æˆ‘ä¸€æ¯•ä¸šåŠ å…¥çš„ä¸€ä¸ªä¼Ÿå¤§çš„ç‰©è”ç½‘æ™ºèƒ½å®¶å±…çš„å…¬å¸ã€‚è€ƒè™‘åˆ°å®¶é‡Œçš„æ™ºèƒ½è®¾å¤‡çš„çŠ¶æ€å¿…é¡»éœ€è¦å®æ—¶çš„å±•ç°åœ¨æ‰‹æœºappå®¢æˆ·ç«¯ä¸Šï¼Œæ¯«æ— ç–‘é—®é€‰æ‹©äº†Websocketã€‚")]),t._v(" "),s("p",[t._v("ä»ä¸Šé¢æˆ‘åˆ—ä¸¾çš„è¿™äº›åœºæ™¯æ¥çœ‹ï¼Œä¸€ä¸ªå…±åŒç‚¹å°±æ˜¯ï¼Œé«˜å®æ—¶æ€§ï¼")]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("ã€å‚è€ƒèµ„æ–™ã€‘")]),t._v(" "),s("p",[t._v("[1] http://websocket.org/")]),t._v(" "),s("p",[t._v("[2] HyBi Working Group.The WebSocket protocol.https://tools.ietf.org/html/draft-abarth-thewebsocketprotocol-00")]),t._v(" "),s("p",[t._v("[3] wiki.websocket.https://en.wikipedia.org/wiki/WebSocket#:~:text=WebSocket")]),t._v(" "),s("p",[t._v("[4] Google.WebRTC.https://webrtc.org/")]),t._v(" "),s("p",[t._v("[5] IBM Developer.ä½¿ç”¨ HTML5 WebSocket æ„å»ºå®æ—¶ Web åº”ç”¨.https://developer.ibm.com/zh/articles/1112-huangxa-websocket/")]),t._v(" "),s("p",[t._v("[6] spring.Using WebSocket to build an interactive web application.https://spring.io/guides/gs/messaging-stomp-websocket/")]),t._v(" "),s("p",[t._v("[7] é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—.WebSocket.http://www.ruanyifeng.com/blog/2017/05/websocket.html")]),t._v(" "),s("p",[t._v("[8] èœé¸Ÿæ•™ç¨‹.HTML5 WebSocket.https://www.runoob.com/html/html5-websocket.html")]),t._v(" "),s("p",[t._v("[9] "),s("a",{attrs:{href:"https://halfrost.com/author/halfrost/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ä¸€ç¼•æ®‡æµåŒ–éšåŠè¾¹å†°éœœ"),s("OutboundLink")],1),t._v(".å…¨åŒå·¥é€šä¿¡çš„ WebSocket.https://halfrost.com/websocket/")]),t._v(" "),s("p",[t._v("[10] å°è±†ä¸ä¸ªäººåšå®¢.SpringBootå®ç°Websocketé€šä¿¡è¯¦è§£.http://www.mydlq.club/article/86/")])])}),[],!1,null,null,null);s.default=e.exports}}]);