(window.webpackJsonp=window.webpackJsonp||[]).push([[250],{577:function(s,t,a){"use strict";a.r(t);var n=a(3),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200420190351.png",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"_2-mybatis缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-mybatis缓存"}},[s._v("#")]),s._v(" 2. MyBatis缓存")]),s._v(" "),t("p",[s._v("Mybatis中的一级缓存和二级缓存：")]),s._v(" "),t("p",[s._v("【一级缓存】")]),s._v(" "),t("p",[s._v("它指的是Mybatis中"),t("code",[s._v("SqlSession")]),s._v("对象的缓存")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("当我们执行查询之后，查询的结果会同时存入到SqlSession为我们提供一块区域中。该区域的结构是一个Map。")])]),s._v(" "),t("li",[t("p",[s._v("当我们再次查询同样的数据，Mybatis会先去SqlSession中查询是否有，有的话直接拿出来用。")])]),s._v(" "),t("li",[t("p",[s._v("当SqlSession对象消失时，Mybatis的一级缓存也就消失了。")])])]),s._v(" "),t("p",[s._v("【二级缓存】")]),s._v(" "),t("p",[s._v("它指的是Mybatis中SqlSessionFactory对象的缓存。")]),s._v(" "),t("p",[s._v("由同一个"),t("code",[s._v("SqlSessionFactory")]),s._v("对象创建的"),t("code",[s._v("SqlSession")]),s._v("共享其缓存")]),s._v(" "),t("p",[s._v("二级缓存的使用步骤：")]),s._v(" "),t("ol",[t("li",[s._v("让Mybatis框架支持二级缓存（在SqlMapConfig.xml中配置）")]),s._v(" "),t("li",[s._v("让当前的映射文件支持二级缓存（在IUserDao.xml中配置）")]),s._v(" "),t("li",[s._v("让当前的操作支持二级缓存（在select标签中配置）")])]),s._v(" "),t("hr"),s._v(" "),t("h3",{attrs:{id:"一级缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一级缓存"}},[s._v("#")]),s._v(" 一级缓存")]),s._v(" "),t("p",[s._v("MyBatis提供了缓存策略，通过缓存策略来减少数据库的查询次数，从而提高性能。 Mybatis中缓存分为一级缓存，二级缓存。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200421142515.png",alt:""}})]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("Mybatis的一级缓存的作用域是"),t("code",[s._v("session")]),s._v("，是"),t("strong",[s._v("SqlSession")]),s._v("级别的缓存，只要"),t("strong",[s._v("SqlSession")]),s._v("没有"),t("code",[s._v("flush")]),s._v("或"),t("code",[s._v("close")]),s._v("，它就存在。")]),s._v(" "),t("p",[s._v("如果执行相同的SQL（相同语句和参数）， MyBatis不进行执行SQL，而是从缓存中命中返回查询；如果命中直接返回，没有命中则执行SQL，从数据库中査询")]),s._v(" "),t("p",[t("strong",[s._v("一级缓存存在测试")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200421144333.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200421144201.png",alt:""}})]),s._v(" "),t("p",[s._v("我们可以发现，虽然在上面的代码中我们查询了两次，但最后只执行了一次数据库操作，这就是Mybatis提供给我们的一级缓起作用了。因为一级缓存的存在，导致第二次查询id为51的记录时，并没有发出SQL语句从数据库中查询数据，而是从一级缓存中查询。")]),s._v(" "),t("p",[s._v("一级缓存是SqlSession范围的缓存，当调用SqlSession的修改，添加，删除，commit()，close()等方法时，就会清空一级缓存。")]),s._v(" "),t("p",[t("strong",[s._v("一级缓存清空测试")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200421145144.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200421145339.png",alt:""}})]),s._v(" "),t("p",[s._v("当执行"),t("code",[s._v("sqlSession.close()")]),s._v("后，再次获取sqlSession并查询id=51的User对象时，又重新执行了SQL 语句，从数据库进行了查询操作。")]),s._v(" "),t("h3",{attrs:{id:"二级缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二级缓存"}},[s._v("#")]),s._v(" 二级缓存")]),s._v(" "),t("p",[s._v("MyBatis 的二级缓存是"),t("code",[s._v("mapper映射")]),s._v("级别的缓存，作用域是同一个mapper的"),t("strong",[s._v("namespace")]),s._v(" ，同一个"),t("strong",[s._v("namespace")]),s._v("中查询SQL可以从缓存中命中，多个SqlSession可以共用二级缓存，二级缓存是跨SqlSession的。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200421145855.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200421152532.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("二级缓存测试")])]),s._v(" "),t("p",[s._v("主配置文件"),t("code",[s._v("SqlMapConfig.xml")]),s._v("中开启缓存（默认是开启的）")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200420190351.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200421152733.png",alt:""}})]),s._v(" "),t("p",[s._v("映射配置文件"),t("code",[s._v("IUserDao.xml")]),s._v("中开启二级缓存")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--开启user支持二级缓存--\x3e")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("cache")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Test")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("testFirstLevelCache")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SqlSession")]),s._v(" sqlSession1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" factory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("openSession")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IUserDao")]),s._v(" dao1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sqlSession1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getMapper")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IUserDao")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),s._v(" user1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" dao1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("findById")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("41")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//一级缓存消失")]),s._v("\n        sqlSession1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SqlSession")]),s._v(" sqlSession2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" factory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("openSession")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IUserDao")]),s._v(" dao2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sqlSession2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getMapper")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IUserDao")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),s._v(" user2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" dao2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("findById")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("41")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        sqlSession2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" user2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200421155723.png",alt:""}})]),s._v(" "),t("p",[s._v("经过上面的测试，我们发现执行了两次查询，并且在执行第一次查询后，我们关闭了一级缓存，再去执行第二次查询时，我们发现并没有对数据库发出SQL语句，所以此时的数据就只能是来自于我们所说的二级缓存。")])])}),[],!1,null,null,null);t.default=e.exports}}]);