(window.webpackJsonp=window.webpackJsonp||[]).push([[214],{541:function(s,t,a){"use strict";a.r(t);var n=a(3),r=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[t("img",{attrs:{src:"https://images.unsplash.com/photo-1593980280424-102c6245deae?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjkwODQwfQ",alt:"text",title:"Gemma Evans"}})]),s._v(" "),t("h2",{attrs:{id:"_1-string的基本特性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-string的基本特性"}},[s._v("#")]),s._v(" 1. String的基本特性")]),s._v(" "),t("p",[t("strong",[s._v("【定义方式】")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" str "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"abc"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//直接定义")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" str "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"abc"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200711124154.png",alt:""}})]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("String类被"),t("code",[s._v("final")]),s._v("修饰，不可被继承")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("String实现了"),t("code",[s._v("Serializable")]),s._v("接口：表示字符串是支持序列化的")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("String实现了"),t("code",[s._v("Comparable")]),s._v("接口：表示 String可以比较大小")])])])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200711124324.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("【String底层的变化】")])]),s._v(" "),t("ul",[t("li",[s._v("JDK8及之前是"),t("code",[s._v("char value[]")]),s._v("，JDK9及之后时"),t("code",[s._v("byte value[]")])])]),s._v(" "),t("p",[s._v("改成了"),t("code",[s._v("byte")]),s._v("加上编码标记，节约了一些空间")]),s._v(" "),t("blockquote",[t("p",[s._v("1 char = 2 byte;")]),s._v(" "),t("p",[s._v("一个汉字为一个char，2个byte")])]),s._v(" "),t("h3",{attrs:{id:"string的不可变性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#string的不可变性"}},[s._v("#")]),s._v(" String的不可变性")]),s._v(" "),t("p",[s._v("String："),t("strong",[s._v("代表不可变的字符序列")]),s._v("。即：不可变性。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("当对字符串"),t("code",[s._v("重新赋值")]),s._v("时，需要重写指定内存区域赋值，"),t("strong",[s._v("不能使用原有的value进行赋值")]),s._v("。")])]),s._v(" "),t("li",[t("p",[s._v("当对现有的字符串进行"),t("code",[s._v("连接")]),s._v("操作时，也需要重新指定内存区域赋值，"),t("strong",[s._v("不能使用原有的value进行赋值")]),s._v("。")])]),s._v(" "),t("li",[t("p",[s._v("当调用 String的"),t("code",[s._v("replace")]),s._v("方法修改指定字符或字符串时，也需要重新指定内存区域赋值，不能使用原有的 value进行赋值。")])])]),s._v(" "),t("p",[t("font",{attrs:{color:"red"}},[t("strong",[s._v("通过字面量的方式（区别于new）给一个字符串赋值，此时的字符串值声明在字符串常量池中")])])],1),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" str "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("code",[s._v("str")]),s._v("存储在"),t("strong",[s._v("字符串常量池")]),s._v("中，字符串常量池从JDK7开始移到了"),t("strong",[s._v("堆")]),s._v("上")]),s._v(" "),t("p",[s._v("【重新赋值】")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200711153414.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200711132907.png",alt:""}})]),s._v(" "),t("p",[s._v("【连接操作】")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200711153455.png",alt:""}})]),s._v(" "),t("p",[s._v("【替换操作】")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200711153821.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200711154030.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200711155235.png",alt:""}})]),s._v(" "),t("hr"),s._v(" "),t("p",[t("font",{attrs:{color:"red"}},[t("strong",[s._v("字符串常量池中是 不会 存储相同内容的字符串的")])])],1),s._v(" "),t("p",[s._v("String的 String pool是一个固定大小的 "),t("strong",[s._v("Hashtable")]),s._v("，默认值大小长度是"),t("code",[s._v("1009")]),s._v("。如果放进入String pool的 String非常多，就会造成Hash冲突严重，从而导致链表会很长，而链表长了后造成的影响就是当调用"),t("code",[s._v("String.intern()")]),s._v("时性能会大幅下降")]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"_2-string的内存分配"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-string的内存分配"}},[s._v("#")]),s._v(" 2. String的内存分配")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("JDK6及之前，字符串常量池存放在永久代")])]),s._v(" "),t("li",[t("p",[s._v("JDK7 将字符串常量池由永久代（方法区）调整到堆内")])]),s._v(" "),t("li",[t("p",[s._v("JDK8 永久代改为元空间，字符串常量池仍在堆上")])])]),s._v(" "),t("p",[t("strong",[s._v("所有的字符串都保存在堆（Heap）中")]),s._v("，和其他普通对象一样，可以在进行调优应用时仅需要调整堆大小就可以了")]),s._v(" "),t("p",[t("strong",[s._v("StringTable为什么要调整位置？")])]),s._v(" "),t("ol",[t("li",[t("p",[s._v("永久代空间默认比较小（使用的是虚拟机内存）")])]),s._v(" "),t("li",[t("p",[s._v("永久代垃圾回收频率低（相对于Eden区的YangGC，Full GC频率低）")])])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"_3-字符串的拼接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-字符串的拼接"}},[s._v("#")]),s._v(" 3. 字符串的拼接")]),s._v(" "),t("h3",{attrs:{id:"字符串拼接细节说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#字符串拼接细节说明"}},[s._v("#")]),s._v(" 字符串拼接细节说明")]),s._v(" "),t("p",[s._v("s4到底是怎么将s1和s2拼接起来的呢？")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200711182002.png",alt:""}})]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("false")])]),s._v(" "),t("p",[s._v("s3在字符串常量池中，s4在堆上，二者地址不相同")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200711184813.png",alt:""}})]),s._v(" "),t("p",[s._v("【s1 + s2操作微观的解释】")]),s._v(" "),t("p",[t("code",[s._v("javap -v -p")]),s._v("反编译查看字节码（要深究具体是怎么实现的，最直观的方式就是查看字节码指令）")]),s._v(" "),t("p",[t("code",[s._v("this")]),s._v("在索引0的位置处")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200711182109.png",alt:""}})]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ldc #"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//字符串常量池中的"a"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" astore_1        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//存放在局部变量表索引1位置处(当前方法为非静态，0处存放的是this)")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" ldc #"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//字符串常量池中的"b"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" astore_2        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//存放在局部变量表索引2位置处")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" ldc #"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("ab"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//字符串常量池中的"ab"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" astore_3        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//存放在局部变量表索引3位置处")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" #"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("java"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lang"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringBuilder")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//堆上创建StringBuilder")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" dup                               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//将堆上对象的地址复制到局部变量表中")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" invokespecial #"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("java"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lang"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringBuilder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("init"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//init构造器初始化")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" aload_1                                              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//取出局部变量表中的"a"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" invokevirtual #"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("java"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lang"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringBuilder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("append"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//调用StringBuilder的append方法，将"a"添加apperd("a")   ')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" aload_2                                              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//取出局部变量表中的"b"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" invokevirtual #"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("java"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lang"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringBuilder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("append"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//调用StringBuilder的append方法，将"b"添加apperd("b")  ')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" invokevirtual #"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("java"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lang"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringBuilder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("toString"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//toString()转为字符串，"ab"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" astore "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("                                             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//"ab"存放在局部变量表索引4位置处')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("                                               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//返回")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("此处，我们也可以再次清晰创建对象的三步骤：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200711182805.png",alt:""}})]),s._v(" "),t("blockquote",[t("p",[s._v("间接说明"),t("code",[s._v("new")]),s._v("关键字不是原子性的")])]),s._v(" "),t("ol",[t("li",[t("p",[s._v("在堆上分配空间创建对象")])]),s._v(" "),t("li",[t("p",[s._v("局部变量表存储对象地址的引用"),t("code",[s._v("dup")]),s._v("指令")])]),s._v(" "),t("li",[t("p",[s._v("构造器初始化"),t("code",[s._v("<init>")])])])]),s._v(" "),t("p",[t("strong",[s._v("【dup指令简介】：")])]),s._v(" "),t("p",[s._v("查看字节码指令的时候，可以看到每个new指令之后都会跟一个dup指令。")]),s._v(" "),t("p",[s._v("因为new指令之后紧跟着就会调用指 invokespecial行初始化：下面是 invokespecia的指令格式。看一下操作数栈，需要一objectref彐用（对象的地址），后面是可选的数；由于初始化没有返回值，调用之后没有东西入栈（用…表示没有入栈）")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://pic2.zhimg.com/v2-50373bbe5e54173177b8b1427081730c_r.jpg?source=1940ef5c",alt:"preview"}})]),s._v(" "),t("p",[t("strong",[s._v("dup指令就是将当前对象在堆内存上的地址复制一份到局部变量表中")]),s._v("。也就是说初始化指令会使当前对象的引用出栈。如果不复制一份，操作数栈中就没有当前对象的引用了，后面再进行其他的夭于区个对象的指令操作时，就无法完成。")]),s._v(" "),t("blockquote",[t("p",[s._v("https://www.zhihu.com/question/52749416")])]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("【s1 + s2操作宏观的解释】")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("首先创建StringBuilder对象StringBuilder sb = new StringBuilder();")])]),s._v(" "),t("li",[t("p",[t("code",[s._v('sb.append("a");')])])]),s._v(" "),t("li",[t("p",[t("code",[s._v('sb.append("b");')])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("sb.toString();")]),s._v('  //new String 返回字符串"ab"')])])]),s._v(" "),t("p",[s._v("就是将字符追加到StringBuilder的字符缓存区内，然后通过"),t("code",[s._v("toString()")]),s._v("返回该字符串")]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("【拓展】")]),s._v(" "),t("p",[t("strong",[s._v("字符拼接操作不一定使用的是StringBuilder")])]),s._v(" "),t("p",[s._v("如果是常量引用，被"),t("code",[s._v("final")]),s._v("修饰，如果拼接符号左右两边教是"),t("strong",[s._v("字符常量")]),s._v("或"),t("strong",[s._v("常量引用")]),s._v("，则仍然使用编译期优化，非StringBuilder的方式")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200711201134.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200711200959.png",alt:""}})]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("总结来说，字符串的拼接就这四句话：")]),s._v(" "),t("ol",[t("li",[s._v("常量与常量的拼接结果在常量池，原理是编译期优化")]),s._v(" "),t("li",[s._v("常量池中不会存在相同的内容")]),s._v(" "),t("li",[s._v("只要其中一个是变量，结果就在"),t("strong",[s._v("堆上的非字符串常量")]),s._v("中，拼接的原理是StringBuilder字符缓存区")]),s._v(" "),t("li",[s._v("拼接结果调用"),t("code",[s._v("intern()")]),s._v("方法，将字符串常量池中没有的对象放入，返回该对象的地址")])]),s._v(" "),t("blockquote",[t("p",[s._v("常量或者被final修饰的变量，在编译器可以确定，所以存放在常量池中")]),s._v(" "),t("p",[s._v("变量由于其引用的地址不确定，所以不能放入常量池，在堆上创建")])]),s._v(" "),t("hr"),s._v(" "),t("h3",{attrs:{id:"面试题测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#面试题测试"}},[s._v("#")]),s._v(" 面试题测试")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200711170509.png",alt:""}})]),s._v(" "),t("p",[s._v("显然，都为true")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200711170636.png",alt:""}})]),s._v(" "),t("p",[s._v("在编译完的class文件中，s1和s2是相同的，说白了s1就是语法糖")]),s._v(" "),t("hr"),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200711170901.png",alt:""}})]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" s5 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" s1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"world"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//此时，s1相当于变量")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如果拼接符号的前后出现了变量，则相当于在堆空间中"),t("code",[s._v("new String()")]),s._v("，"),t("code",[s._v("new")]),s._v(" 出来的存放在新生代（一般情况），具体的内容为拼接的结果")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" s8 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" s6"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("intern")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s3 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" s8"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//true")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("code",[s._v("intern()")]),s._v("方法校验字符串常量池中是否存在"),t("code",[s._v("helloworld")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("不存在，则创建一个")])]),s._v(" "),t("li",[t("p",[s._v("存在，则返回该字符串的地址")])])]),s._v(" "),t("hr"),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200711201919.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"效率对比"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#效率对比"}},[s._v("#")]),s._v(" 效率对比")]),s._v(" "),t("p",[s._v("测试"),t("code",[s._v("StringBuilder")]),s._v("与字符串"),t("code",[s._v("+")]),s._v("的效率对比：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200712161438.png",alt:""}})]),s._v(" "),t("blockquote",[t("p",[s._v("test_StringBuilder();    -- 2ms")]),s._v(" "),t("p",[s._v("test_String();                  -- 8897ms")])]),s._v(" "),t("p",[t("strong",[s._v("字符串"),t("code",[s._v("+")]),s._v("的操作效率低下的原因就是：")])]),s._v(" "),t("ol",[t("li",[t("p",[s._v("每次循环时都会创建StringBuilder和String对象，相当于每次都有两个"),t("code",[s._v("new")]),s._v("操作")])]),s._v(" "),t("li",[t("p",[s._v("使用Sting的字符拼接方式：内存中由于创建了较多的StringBuilder和String的对象，内存占用更大；如果进行GC同样会耗费时间")])])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"_4-intern方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-intern方法"}},[s._v("#")]),s._v(" 4. intern方法")]),s._v(" "),t("p",[s._v("【JDK8 文档描述】")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200712163219.png",alt:""}})]),s._v(" "),t("p",[s._v("如：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" str "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello world"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("intern")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("调用"),t("code",[s._v("intern()")]),s._v("方法来创建字符串时，先到字符串常量池中找有没有与要创建的字符串str")]),s._v(" "),t("p",[t("code",[s._v("equals")]),s._v("相等的串target")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("如果有，则返回字符串常量池中target的地址引用")])]),s._v(" "),t("li",[t("p",[s._v("没有，则创建str到字符串常量池中，返回str的地址")])])]),s._v(" "),t("p",[t("strong",[s._v("如何保证变量s指向的是字符牢常量池中的数据呢?")])]),s._v(" "),t("p",[s._v("方式一："),t("code",[s._v('String s = "Mr.Q";')]),s._v("字面量定义的方式")]),s._v(" "),t("p",[s._v("方式二：调用"),t("code",[s._v("intern()")]),s._v("方法")]),s._v(" "),t("h3",{attrs:{id:"new-string的讨论"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#new-string的讨论"}},[s._v("#")]),s._v(" new String的讨论")]),s._v(" "),t("p",[t("strong",[s._v("【讨论一】")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" s "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ab"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v('new String("ab")为什么会创建两个对象？')])]),s._v(" "),t("p",[s._v("查看字节码指令：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200712170820.png",alt:""}})]),s._v(" "),t("ol",[t("li",[t("p",[s._v("在堆上创建了一个")])]),s._v(" "),t("li",[t("p",[s._v("在字符串常量池中创建了一个（常量池之前没有的话）")])])]),s._v(" "),t("p",[t("strong",[s._v('new String("a") + new String("b")呢？')])]),s._v(" "),t("ul",[t("li",[s._v("对象1："),t("code",[s._v("new StrintBuilder()")])]),s._v(" "),t("li",[s._v("对象2："),t("code",[s._v('new String("a")')])]),s._v(" "),t("li",[s._v("对象3：字符串常量池中的"),t("code",[s._v('"a"')])]),s._v(" "),t("li",[s._v("对象4："),t("code",[s._v('new String("b")')])]),s._v(" "),t("li",[s._v("对象5：字符串常量池中的"),t("code",[s._v('"b"')])]),s._v(" "),t("li",[s._v("对象6："),t("code",[s._v('new String("ab")')])])]),s._v(" "),t("p",[s._v("【深入剖析】")]),s._v(" "),t("p",[s._v("StringBuilder的"),t("code",[s._v("toString()")]),s._v("：")]),s._v(" "),t("blockquote",[t("p",[s._v('toStirng()的调用，在字符串常量池中，并没有生成"ab"')]),s._v(" "),t("p",[s._v("解析接着看下面娓娓道来😈")])]),s._v(" "),t("hr"),s._v(" "),t("p",[t("strong",[s._v("【讨论二】")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200712182702.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("【s1和s2的分析】")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200712183933.png",alt:""}})]),s._v(" "),t("ul",[t("li",[t("p",[s._v("无论什么版本的JDK，s1创建在堆上")])]),s._v(" "),t("li",[t("p",[s._v("调用"),t("code",[s._v("intern()")]),s._v("方法，拷贝一份到字符串常量池中，s2记录的是字符串常量池中"),t("code",[s._v("11")]),s._v("的地址")])]),s._v(" "),t("li",[t("p",[s._v("二者存储的位置不同，自然是"),t("strong",[s._v("false")])])])]),s._v(" "),t("hr"),s._v(" "),t("p",[t("strong",[s._v("【s3和s4的分析】")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("s3记录的地址为堆空间上（非字符串常量池中）"),t("code",[s._v("11")]),s._v("的地址")])]),s._v(" "),t("li",[t("p",[s._v("s4请看下面解释（要说清楚牵扯的东西还有点多....）")])])]),s._v(" "),t("br"),s._v(" "),t("p",[t("strong",[s._v("问题的关键是此时字符串中是否存在"),t("code",[s._v("11")]),s._v("呢？")])]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v('new String("1") + new String("1");')]),s._v("创建完字符串对象，"),t("code",[s._v("append()")]),s._v("拼接完，在"),t("code",[s._v("toString()")]),s._v("返回的时候，其实在字符串常量池中并"),t("strong",[s._v('不存在"11"')])])]),s._v(" "),t("p",[s._v("根据上面的【讨论一】我们知道，在"),t("code",[s._v("new String()")]),s._v("时其实是创建了两个对象")]),s._v(" "),t("p",[t("code",[s._v("new")]),s._v("了两次之后再"),t("code",[s._v("append()")]),s._v("，那么在字符串常量池中为什么没有呢？我们需要查看一下StringBuilder的"),t("code",[s._v("toString()")]),s._v("源码的字节码指令")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200712185126.png",alt:""}})]),s._v(" "),t("p",[s._v("我们发现并"),t("strong",[s._v("没有ldc指令")]),s._v("，其实就拼接完没往常量池中放一份")]),s._v(" "),t("p",[s._v("可是，为什么JDK6和7会出现不同的答案呢？")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("因为JDK6的字符串常量池在永久代中，不在堆上，它会在常量池中新创建一个对象，就会有新的地址，这就回到了s1和s2的问题了，"),t("strong",[s._v("是false")])])]),s._v(" "),t("li",[t("p",[s._v("JDK7及之后字符串常量池虽然在概念上是属于元空间的，但是其实真实的位置是在"),t("strong",[s._v("堆上")]),s._v("的")])])]),s._v(" "),t("p",[s._v("【真实情况是这样的✔】")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200712191140.png",alt:""}})]),s._v(" "),t("p",[t("strong",[t("code",[s._v('String s4 = "11";')]),s._v(" 使用的是上一行代码"),t("code",[s._v("s3.intern();")]),s._v("执行后，s4变量记录的常量池中生成的”11”的地址")])]),s._v(" "),t("p",[s._v("🙃换句话说，图省空间，池子里没新创建，池子里引用的是已经在堆上创建了的"),t("code",[s._v("11")]),s._v("的地址")]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("【总结一下📔】")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200712192227.png",alt:""}})]),s._v(" "),t("p",[s._v("JDK7：此时字符串常量中并没有创建"),t("code",[s._v("11")]),s._v("，而是创建一个指向堆空间"),t("code",[s._v('new String("11")')]),s._v("的"),t("strong",[s._v("地址")])]),s._v(" "),t("h3",{attrs:{id:"拓展"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#拓展"}},[s._v("#")]),s._v(" 拓展")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200712194631.png",alt:""}})]),s._v(" "),t("p",[s._v("此时，"),t("code",[s._v("11")]),s._v("这个字符串对象在堆空间上和字符串常量池中各有一份，地址不相同")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200712214707.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"intern总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#intern总结"}},[s._v("#")]),s._v(" intern总结")]),s._v(" "),t("p",[s._v("总结String的"),t("code",[s._v("intern()")]),s._v("的使用：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" s "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"b"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ns"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("intern")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("JDK6 中，将这个字符串对象"),t("code",[s._v("s")]),s._v("尝试放入字符串常量池")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("如果字符串常量池中有，则并不会放入。返回已有的串池中的对象的地址")])]),s._v(" "),t("li",[t("p",[s._v("如果没有，"),t("strong",[s._v("会把"),t("font",{attrs:{color:"red"}},[s._v("此对象")]),s._v("复制一份(深拷贝)")],1),s._v("，放入字符串常量池，并返回字符串常量池中的"),t("strong",[s._v("对象地址")])])])]),s._v(" "),t("p",[s._v("JDK7 起，将这个字符串对象"),t("code",[s._v("s")]),s._v("尝试放入字符串常量池")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("如果字符串常量池中有，则并不会放入。返回已有的字符串常量池中的对象的地址")])]),s._v(" "),t("li",[t("p",[s._v("如果没有，"),t("strong",[s._v("则会把"),t("font",{attrs:{color:"red"}},[s._v("此对象的引用地址")]),s._v("复制一份(浅拷贝)")],1),s._v("，放入字符串常量池，并返回字符串常量池中的"),t("strong",[s._v("引用地址")])])])]),s._v(" "),t("p",[t("strong",[s._v("结论：对于程序中大量存在的字符串，尤其存在很多重复字符串时，使用 intern()可以节省内存空间")])])])}),[],!1,null,null,null);t.default=r.exports}}]);