(window.webpackJsonp=window.webpackJsonp||[]).push([[213],{539:function(t,s,a){"use strict";a.r(s);var n=a(3),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"ã€å¼•è¨€ã€‘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ã€å¼•è¨€ã€‘"}},[t._v("#")]),t._v(" ã€å¼•è¨€ã€‘")]),t._v(" "),s("p",[t._v("è¿™ä¸€åˆ‡çš„ä¸€åˆ‡ï¼Œè¿˜å¾—ä»ä¸€ä¸ªå«"),s("code",[t._v("volatile")]),t._v("çš„å…³é”®å­—è¯´èµ·")]),t._v(" "),s("p",[t._v("ã€çµé­‚æ‹·é—®å¼€å§‹ã€‘")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("é¢è¯•å®˜ï¼šJavaå¹¶å‘è¿™å—äº†è§£çš„æ€ä¹ˆæ ·ï¼Ÿè¯´è¯´ä½ å¯¹volatileå…³é”®å­—çš„ç†è§£ï¼Ÿ")])]),t._v(" "),s("li",[s("p",[t._v("é¢è¯•å®˜ï¼šèƒ½ä¸èƒ½è¯¦ç»†è¯´ä¸‹ä»€ä¹ˆæ˜¯å†…å­˜å¯è§æ€§ï¼Œä»€ä¹ˆåˆæ˜¯æŒ‡ä»¤é‡æ’åºå‘¢ï¼Ÿ")])]),t._v(" "),s("li",[s("p",[t._v("é¢è¯•å®˜ï¼švolatileæ€ä¹ˆä¿è¯å¯è§æ€§çš„ï¼Ÿå¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼Œä½ èƒ½è®²ä¸€ä¸‹åº•å±‚åŸç†æ˜¯æ€ä¹ˆå®ç°çš„å—ï¼Ÿ")])]),t._v(" "),s("li",[s("p",[t._v("é¢è¯•å®˜ï¼švolatileå…³é”®å­—æ˜¯æ€ä¹ˆä¿è¯æœ‰åºæ€§çš„ï¼Ÿ")])]),t._v(" "),s("li",[s("p",[t._v("é¢è¯•å®˜ï¼švolatileèƒ½ä¿è¯å¯è§æ€§å’Œæœ‰åºæ€§ï¼Œä½†æ˜¯èƒ½ä¿è¯åŸå­æ€§å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ")])]),t._v(" "),s("li",[s("p",[t._v("é¢è¯•å®˜ï¼šäº†è§£è¿‡JMMå†…å­˜æ¨¡å‹å—ï¼Ÿç®€å•çš„è®²è®²")])])]),t._v(" "),s("p",[t._v("åˆ°è¿™é‡Œï¼Œæˆ‘çš„çœ¼é‡Œå·²æ˜¯å¸¸å«æ³ªæ°´äº†ã€‚ä¸æ˜¯å› ä¸ºæˆ‘å¯¹ä»£ç çˆ±çš„æ·±æ²‰ï¼Œè€Œæ˜¯å› ä¸ºæˆ‘èœçš„çœŸè¯šï¼")]),t._v(" "),s("p",[t._v("æ²¡äº‹ï¼Œä¸å°±æ˜¯ä¸ªç ´"),s("code",[t._v("volatile")]),t._v("å—ï¼Ÿåˆ«å¿µäº†ï¼Œæˆ‘å­¦ä¹ è¿˜ä¸è¡Œå—ï¼")]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("PSï¼š")]),t._v(" æ–‡ç« çš„å†…å®¹æ˜¯æˆ‘çœ‹è§†é¢‘ï¼Œåšå®¢ï¼ŒæŸ¥èµ„æ–™çš„ç†è§£ã€‚åœ¨è¿™ä¸€å—å¯èƒ½å¾ˆå¤šäººçš„ç†è§£æœ‰æ‰€ä¸åŒï¼Œå°ç¼–æˆ‘å°šæ— å·¥ä½œç»éªŒï¼Œåªæ˜¯æ€»ç»“ç ”ç©¶æ¥å­¦ä¹ ï¼Œåšä¸ªé¢è¯•é¢˜çš„è®°å½•ã€‚æ–‡ç« å†…å®¹ä»ç†è§£åˆ°æŸ¥èµ„æ–™å­¦ä¹ å†åˆ°ç”»å›¾å†™å‡ºæ¥ï¼Œè‚äº†æŒºé•¿æ—¶é—´çš„å§ã€‚å¤§å®¶å½“åšä¸€ç¯‡é¢ç­‹æ¥çœ‹å°±å¥½ï¼Œä¸»è¦æ˜¯å›ç­”é¢è¯•é—®é¢˜ï¼Œè‡³äºæ·±å…¥åˆ°åº•å±‚é€šè¿‡å­—èŠ‚ç æ±‡ç¼–ç­‰æ¥é€šè¿‡ä»£ç è¯´æ˜ï¼Œä¿ºè¿˜åœ¨ç ”ç©¶ä¸­ã€‚æœ¬æ–‡åªæ˜¯æ¯”è¾ƒæµ…æ˜¾çš„å‘ç°é—®é¢˜ï¼Œè§£å†³é—®é¢˜çš„ã€‚ä¸åšå®é™…çš„å·¥ä½œå¼€å‘ã€‚å¦‚æœ‰ä¸æ­£è¯·ç«‹å³æŒ‡å‡ºã€‚")])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"_1-å¤šæ ¸å¹¶å‘ç¼“å­˜æ¶æ„"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-å¤šæ ¸å¹¶å‘ç¼“å­˜æ¶æ„"}},[t._v("#")]),t._v(" 1. å¤šæ ¸å¹¶å‘ç¼“å­˜æ¶æ„")]),t._v(" "),s("p",[t._v("ç¼“å­˜Cacheè®¾ç½®çš„ç›®çš„æ˜¯ä¸ºäº†è§£å†³ç£ç›˜å’ŒCPUé€Ÿåº¦ä¸åŒ¹é…çš„é—®é¢˜ã€‚ä½†æ˜¯ï¼Œå¯¹äºCPUæ¥è¯´ï¼ŒCacheè¿˜æ˜¯ä¸å¤Ÿå¿«ï¼Œç¼“å­˜çš„æ¦‚å¿µå†æ¬¡è¢«æ‰©å……ï¼Œä¸ä»…åœ¨å†…å­˜å’Œç£ç›˜ä¹‹é—´ä¹Ÿæœ‰Cacheï¼ˆç£ç›˜ç¼“å­˜ï¼‰ï¼Œè€Œä¸”åœ¨CPUå’Œä¸»å†…å­˜ä¹‹é—´æœ‰Cacheï¼ˆCPUç¼“å­˜ï¼‰ï¼Œä¹ƒè‡³åœ¨ç¡¬ç›˜ä¸ç½‘ç»œä¹‹é—´ä¹Ÿæœ‰æŸç§æ„ä¹‰ä¸Šçš„Cacheâ”€â”€ç§°ä¸º"),s("a",{attrs:{href:"https://zh.wikipedia.org/wiki/Internet",target:"_blank",rel:"noopener noreferrer"}},[t._v("Internet"),s("OutboundLink")],1),t._v("ä¸´æ—¶æ–‡ä»¶å¤¹æˆ–ç½‘ç»œå†…å®¹ç¼“å­˜ç­‰ã€‚å‡¡æ˜¯ä½äºé€Ÿåº¦ç›¸å·®è¾ƒå¤§çš„ä¸¤ç§"),s("a",{attrs:{href:"https://zh.wikipedia.org/wiki/%E7%A1%AC%E4%BB%B6",target:"_blank",rel:"noopener noreferrer"}},[t._v("ç¡¬ä»¶"),s("OutboundLink")],1),t._v("ä¹‹é—´ï¼Œç”¨äºåè°ƒä¸¤è€…æ•°æ®ä¼ è¾“é€Ÿåº¦å·®å¼‚çš„ç»“æ„ï¼Œå‡å¯ç§°ä¹‹ä¸ºCacheã€‚")]),t._v(" "),s("h3",{attrs:{id:"cpuç¼“å­˜"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cpuç¼“å­˜"}},[t._v("#")]),t._v(" CPUç¼“å­˜")]),t._v(" "),s("p",[t._v("CPUç¼“å­˜ï¼ˆCache Memoryï¼‰æ˜¯ä½äºCPUä¸å†…å­˜ä¹‹é—´çš„ä¸´æ—¶å­˜å‚¨å™¨ï¼Œå®ƒçš„å®¹é‡æ¯”å†…å­˜å°çš„å¤šã€‚ä½†æ˜¯äº¤æ¢é€Ÿåº¦å´æ¯”å†…å­˜è¦å¿«å¾—å¤šã€‚ç¼“å­˜å¤§å°æ˜¯CPUçš„é‡è¦æŒ‡æ ‡ä¹‹ä¸€ï¼Œè€Œä¸”ç¼“å­˜çš„ç»“æ„å’Œå¤§å°å¯¹CPUé€Ÿåº¦çš„å½±å“éå¸¸å¤§ï¼ŒCPUå†…ç¼“å­˜çš„è¿è¡Œé¢‘ç‡æé«˜ï¼Œä¸€èˆ¬æ˜¯å’Œå¤„ç†å™¨åŒé¢‘è¿ä½œï¼Œå·¥ä½œæ•ˆç‡è¿œè¿œå¤§äºç³»ç»Ÿå†…å­˜å’Œç¡¬ç›˜ã€‚")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200611160728.png",alt:""}})]),t._v(" "),s("p",[t._v("CPUç¼“å­˜å¯ä»¥åˆ†ä¸ºä¸‰çº§ï¼š")]),t._v(" "),s("p",[s("strong",[t._v("ä¸€çº§ç¼“å­˜L1")])]),t._v(" "),s("p",[t._v("ä¸€çº§ç¼“å­˜ï¼ˆLevel 1 Cacheï¼‰ç®€ç§°L1 Cacheï¼Œä½äºCPUå†…æ ¸çš„æ—è¾¹ï¼Œæ˜¯ä¸CPUç»“åˆæœ€ä¸ºç´§å¯†çš„CPUç¼“å­˜ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸€çº§ç¼“å­˜å¯ä»¥åˆ†ä¸ºä¸€çº§æ•°æ®ç¼“å­˜ï¼ˆData Cacheï¼ŒD-Cacheï¼‰å’Œä¸€çº§æŒ‡ä»¤ç¼“å­˜ï¼ˆInstruction Cacheï¼ŒI-Cacheï¼‰")]),t._v(" "),s("p",[s("strong",[t._v("äºŒçº§ç¼“å­˜L2")])]),t._v(" "),s("p",[t._v("L2 Cacheï¼ˆäºŒçº§ç¼“å­˜ï¼‰æ˜¯CPUçš„ç¬¬äºŒå±‚é«˜é€Ÿç¼“å­˜ï¼Œåˆ†å†…éƒ¨å’Œå¤–éƒ¨ä¸¤ç§èŠ¯ç‰‡ã€‚å†…éƒ¨çš„èŠ¯ç‰‡äºŒçº§ç¼“å­˜è¿è¡Œé€Ÿåº¦ä¸ä¸»é¢‘ç›¸åŒï¼Œè€Œå¤–éƒ¨çš„äºŒçº§ç¼“å­˜åˆ™åªæœ‰ä¸»é¢‘çš„ä¸€åŠã€‚L2é«˜é€Ÿç¼“å­˜å®¹é‡ä¹Ÿä¼šå½±å“CPUçš„æ€§èƒ½ï¼ŒåŸåˆ™æ˜¯è¶Šå¤§è¶Šå¥½ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("ä¸‰çº§ç¼“å­˜L3")])]),t._v(" "),s("p",[t._v("ä¸‰çº§ç¼“å­˜æ˜¯ä¸ºè¯»å–äºŒçº§ç¼“å­˜åæœªå‘½ä¸­çš„æ•°æ®è®¾è®¡çš„â€”ç§ç¼“å­˜ï¼Œåœ¨æ‹¥æœ‰ä¸‰çº§ç¼“å­˜çš„CPUä¸­ï¼Œåªæœ‰çº¦5%çš„æ•°æ®éœ€è¦ä»å†…å­˜ä¸­è°ƒç”¨ï¼Œè¿™è¿›ä¸€æ­¥æé«˜äº†CPUçš„æ•ˆç‡ã€‚")]),t._v(" "),s("p",[t._v("ä»»åŠ¡ç®¡ç†å™¨æŸ¥çœ‹CPUç¼“å­˜ä½¿ç”¨æƒ…å†µ:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200611161735.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200611162915.png",alt:""}})]),t._v(" "),s("p",[t._v("æ‰€ä»¥è¯´ï¼Œåœ¨æˆ‘ä»¬çš„ç¨‹åºæ‰§è¡Œæ—¶ï¼Œåœ¨CPUå’ŒCacheä¹‹é—´ï¼Œæ˜¯é€šè¿‡CPUç¼“å­˜æ¥åšäº¤äº’çš„ã€‚CPUä»CPUç¼“å­˜è¯»å–æ•°æ®ï¼ŒCPUç¼“å­˜ä»å†…å­˜ä¸­è¯»å–æ•°æ®ï¼›CPUå°†è®¡ç®—å®Œçš„æ•°æ®å†™å›åˆ°CPUç¼“å­˜ä¸­ï¼Œç„¶åCPUç¼“å­˜å†åŒæ­¥å›å†…å­˜ä¸­ï¼Œå†…å­˜å†å†™å›åˆ°ç£ç›˜ä¸­ã€‚")]),t._v(" "),s("h3",{attrs:{id:"jmmå†…å­˜æ¨¡å‹ç®€ä»‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jmmå†…å­˜æ¨¡å‹ç®€ä»‹"}},[t._v("#")]),t._v(" JMMå†…å­˜æ¨¡å‹ç®€ä»‹")]),t._v(" "),s("p",[t._v("JMMï¼ˆJava Memory Modelï¼‰, æ˜¯Javaè™šæ‹Ÿæœºå¹³å°å¯¹å¼€å‘è€…æä¾›çš„å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å†…å­˜å¯è§æ€§ã€æ˜¯å¦å¯ä»¥é‡æ’åºç­‰é—®é¢˜çš„æ— å…³å…·ä½“å¹³å°çš„ç»Ÿä¸€çš„ä¿è¯ã€‚")]),t._v(" "),s("p",[t._v("JMMå®šä¹‰äº†ä¸€ä¸ª"),s("strong",[t._v("çº¿ç¨‹ä¸ä¸»å­˜")]),t._v("ä¹‹é—´çš„"),s("strong",[t._v("æŠ½è±¡å…³ç³»")]),t._v("ï¼Œå®ƒå°±åƒæˆ‘ä»¬çš„æ•°æ®ç»“æ„ä¸­çš„é€»è¾‘ç»“æ„ä¸€æ ·ï¼Œåªæ˜¯æ¦‚å¿µæ€§çš„ä¸œè¥¿ï¼Œå¹¶ä¸æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œä½†æ˜¯èƒ½å¤Ÿè®©æˆ‘ä»¬æ›´å¥½çš„ç†è§£å¤šçº¿ç¨‹çš„åº•å±‚åŸç†ã€‚")]),t._v(" "),s("blockquote",[s("p",[t._v("é¦–å…ˆï¼Œä¸€å®šè¦å…ˆæ˜ç¡®ä¸€ä¸ªæ¦‚å¿µï¼šCPUçš„è¿ç®—æ˜¯éå¸¸éå¸¸å¿«çš„ï¼Œå’Œå…¶ä»–ç¡¬ä»¶ä¸åœ¨ä¸€ä¸ªé‡çº§ä¸Šã€‚")])]),t._v(" "),s("p",[t._v("Javaå†…å­˜æ¨¡å‹ç±»æ¯”äºä¸Šé¢ç¡¬ä»¶çš„å†…å­˜æ¨¡å‹ï¼Œå®ƒæ˜¯åŸºäº"),s("strong",[t._v("CPUç¼“å­˜æ¨¡å‹")]),t._v("æ¥æ„å»ºçš„ã€‚")]),t._v(" "),s("p",[t._v("æ¯ä¸€ä¸ªçº¿ç¨‹åœ¨æ“ä½œå…±äº«å˜é‡çš„æ—¶å€™ï¼Œéƒ½å°†å…±äº«å˜é‡æ‹·è´ä¸€ä»½åˆ°è‡ªå·±çš„å·¥ä½œåŒºé—´ä¸­ï¼ˆå› ä¸ºå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶åœ¨å†…å­˜ä¸­æ“ä½œæ•°æ®ï¼Œå°±åƒCPUä¸å†…å­˜ç›´æ¥äº¤äº’ä¸€æ ·ï¼Œé€Ÿåº¦éå¸¸æ…¢ï¼‰ï¼Œç­‰åˆ°å½“å‰çº¿ç¨‹çš„CPUè¿ç®—å®Œä¹‹åï¼Œåœ¨å†™å›ä¸»å†…å­˜ã€‚")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200611170126.png",alt:""}})]),t._v(" "),s("p",[t._v("å¦‚æœæ­¤æ—¶ä¸€ä¸ªå…±äº«å˜é‡å‘ç”Ÿäº†æ”¹å˜ï¼Œä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œå°±å¿…é¡»ç«‹åˆ»é€šçŸ¥å…¶ä»–çº¿ç¨‹è¿™ä¸ªå…±äº«å˜é‡çš„å€¼å‘ç”Ÿäº†æ”¹å˜ï¼Œè®©å…¶ä»–çº¿ç¨‹å·¥ä½œå†…å­˜ä¸­çš„å‰¯æœ¬æ›´æ–°ï¼Œä¿è¯æ‹¿åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚")]),t._v(" "),s("p",[t._v("åœ¨è¿™é€šçŸ¥ä¹‹é—´ï¼Œçº¿ç¨‹ä¹‹é—´å°±å¿…ç„¶ä¼šæœ‰è”ç³»å’Œæ²Ÿé€š")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200611170339.png",alt:""}})]),t._v(" "),s("p",[t._v("å°±å¥½æ¯”ä¸¤ä¸ªäºº"),s("strong",[t._v("åŒæ—¶")]),t._v("æ‹¿ç€"),s("strong",[t._v("åŒä¸€å¼ ")]),t._v("é“¶è¡Œå¡åˆ°é“¶è¡Œå–é’±ï¼Œå¡é‡Œæœ‰100å—ï¼Œä¸€ä¸ªäººå–äº†50ï¼Œè´¦æˆ·ä½™é¢ç«‹å³å°±å˜æˆäº†50ã€‚è™½ç„¶ä¸¤äººæ˜¯åŒæ—¶åŒæ­¥å¹¶è¡Œå–é’±ï¼Œä½†æ˜¯ç¬¬äºŒä¸ªäººæ˜¯åœ¨è¿™50çš„åŸºç¡€ä¸Šæ¥å–é’±çš„ï¼Œä¸å¯èƒ½è¿˜åœ¨100çš„åŸºç¡€ä¸Šå–é’±ã€‚")]),t._v(" "),s("p",[t._v("é‚£ä¹ˆï¼ŒJavaæ˜¯æ€ä¹ˆä¿è¯é“¶è¡Œå¡çš„ä½™é¢ç«‹å³å˜ä¸º50ï¼Œå¹¶ä¸”æ˜¯åšäº†ä»€ä¹ˆæ“ä½œæ¥ä¿è¯ä½™é¢çš„æ­£ç¡®æ€§å‘¢ï¼Ÿ")]),t._v(" "),s("h2",{attrs:{id:"_2-jmmå†…å­˜æ¨¡å‹éªŒè¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-jmmå†…å­˜æ¨¡å‹éªŒè¯"}},[t._v("#")]),t._v(" 2. JMMå†…å­˜æ¨¡å‹éªŒè¯")]),t._v(" "),s("h3",{attrs:{id:"volatileéªŒè¯å†…å­˜æ¨¡å‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#volatileéªŒè¯å†…å­˜æ¨¡å‹"}},[t._v("#")]),t._v(" volatileéªŒè¯å†…å­˜æ¨¡å‹")]),t._v(" "),s("p",[t._v("æ¥ï¼Œæ•´ä¸€æ®µä»£ç å†å” ......")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * @Author: Mr.Q\n * @Date: 2020-06-10 09:47\n * @Description:JMMå†…å­˜æ¨¡å‹éªŒè¯--volatileä¿è¯å¯è§æ€§æµ‹è¯•\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("VolatileVisibilityTest")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//æ­¤å¤„æ˜¯å¦æ·»åŠ volatile,æ¥éªŒè¯å†…å­˜æ¨¡å‹")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" initFlag "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ç­‰å¾…æ•°æ®ä¸­...."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("initFlag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--------------success-----------"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("prepareData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("prepareData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\nå‡†å¤‡æ•°æ®ä¸­...."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        initFlag "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//æ­¤å¤„ä¸ºç¬¬30è¡Œä»£ç ")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"initFlag = "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" initFlag"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"æ•°æ®å‡†å¤‡å®Œæˆï¼"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br")])]),s("p",[t._v("é¦–å…ˆï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨ç­‰å¾…æ•°æ®ï¼Œ"),s("code",[t._v("initFlag")]),t._v("åˆå§‹å€¼ä¸ºfalseï¼Œ"),s("code",[t._v("ï¼initFlag")]),t._v("è¿›å…¥åˆ°æ­»å¾ªç¯ä¸­å¡åœ¨æ­¤å¤„ã€‚")]),t._v(" "),s("p",[t._v("å¦ä¸€ä¸ªçº¿ç¨‹å‡†å¤‡æ•°æ®ï¼Œå°†"),s("code",[t._v("initFlag")]),t._v("ç½®ä¸ºtrueã€‚")]),t._v(" "),s("p",[t._v("ç”±äºæ˜¯é™æ€çš„æˆå‘˜å…±äº«å˜é‡ï¼Œä¿®æ”¹ä¹‹åç­‰å¾…çš„çº¿ç¨‹èƒ½å¤Ÿæ„ŸçŸ¥åˆ°ï¼Œæ­¤æ—¶è·³å‡ºæ­»å¾ªç¯ï¼Œæ‰“å°ä¿¡æ¯ï¼Œç¨‹åºè¿è¡Œç»“æŸã€‚")]),t._v(" "),s("p",[t._v("ä½†æ˜¯ï¼ŒçœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿ")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200611173929.png",alt:""}})]),t._v(" "),s("p",[t._v("æˆ‘ä»¬å‘ç°å¹¶æ²¡æœ‰ï¼Œæ­¤æ—¶ç¨‹åºä¾ç„¶å¤„äºæ­»å¾ªç¯ä¸­ï¼Œå³"),s("code",[t._v("initFlag")]),t._v("ä¾ç„¶ä¸º"),s("strong",[t._v("false")])]),t._v(" "),s("p",[t._v("å’¦ï¼Œè¿™æ˜¯æ€ä¹ˆè‚¥å››å‘¢ï¼Ÿ")]),t._v(" "),s("p",[t._v("å•çº¿ç¨‹ä¸‹è·‘ï¼Œæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚å¯è¿™æ˜¯åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œé—®é¢˜å°±æ¥äº†ã€‚")]),t._v(" "),s("p",[t._v("è¿™ä¹Ÿå°±é—´æ¥éªŒè¯äº†JMMçš„å­˜åœ¨ï¼Œå³æ¯ä¸ªçº¿ç¨‹åœ¨å·¥ä½œæ—¶ï¼Œéƒ½ä¼šå°†å…±äº«æ•°æ®æ‹·è´åˆ°è‡ªå·±çš„å·¥ä½œå†…å­˜æ¥æ“ä½œã€‚å¦‚æœä¸æ˜¯çš„è¯ï¼Œæ­¤å¤„å¤šçº¿ç¨‹ä¸‹æ‰§è¡Œä¹Ÿä¸ä¼šå‡ºç°é—®é¢˜ã€‚")]),t._v(" "),s("p",[t._v("è¿™æ—¶ï¼Œé‚£ä¸ªç”·äººï¼Œé‚£ä¸ªå«"),s("code",[t._v("volatile")]),t._v("çš„è“äººï¼Œå®ƒåŸºæƒ…æ»¡æ»¡çš„å‘æˆ‘ä»¬èµ°æ¥äº†ï¼")]),t._v(" "),s("p",[t._v("å…±äº«å˜é‡ä¸ä¸€è‡´æ˜¯å§ï¼Ÿæ“ä½œæ²¡äº†å¯è§æ€§æ˜¯å§ï¼Ÿæ¥å§ï¼Œè¿™ç§å°äº‹å°±äº¤ç»™æˆ‘å§å®è´ï¼Œä¹ˆä¹ˆå“’ğŸ˜˜")]),t._v(" "),s("p",[t._v("æˆ‘ä»¬æƒ³è¦è¾¾åˆ°è¿™æ ·çš„æ•ˆæœï¼š")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" initFlag "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("ç”¨"),s("code",[t._v("volatile")]),t._v("ä¿®é¥°"),s("code",[t._v("initFlag")]),t._v("å˜é‡ï¼Œåªè¦æœ‰çº¿ç¨‹åšäº†ä¿®æ”¹ï¼Œå…¶ä»–çº¿ç¨‹ç«‹å³å¯ä»¥æ„ŸçŸ¥ã€‚")]),t._v(" "),s("p",[t._v("æ­£ç¡®çš„è¿è¡Œç»“æœï¼Œè®©æ‰“å°å‡ºæˆåŠŸä¿¡æ¯ã€‚")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200611173952.png",alt:""}})]),t._v(" "),s("p",[t._v("é—®é¢˜æ˜¯è§£å†³äº†ã€‚è¿™æ—¶ï¼Œé¢è¯•å®˜ä¸åšé“çš„ç¬‘äº†ğŸ™ƒã€‚")]),t._v(" "),s("p"),t._v(" "),s("h3",{attrs:{id:"jmmå†…å­˜æ¨¡å‹8å¤§åŸå­æ“ä½œ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jmmå†…å­˜æ¨¡å‹8å¤§åŸå­æ“ä½œ"}},[t._v("#")]),t._v(" JMMå†…å­˜æ¨¡å‹8å¤§åŸå­æ“ä½œ")]),t._v(" "),s("p",[t._v("8å¤§åŸå­æ“ä½œå¤§å®¶å¯èƒ½éƒ½æœ‰äº†è§£ï¼Œä½†æ˜¯å…·ä½“åˆ°åœ¨åº•å±‚æ˜¯æ€ä¹ˆäº¤äº’çš„ï¼Ÿæ¯ä¸ªåŸå­æ“ä½œä¹‹é—´çš„å…³ç³»æ˜¯æ€æ ·çš„ï¼Ÿå¹¶æ²¡æœ‰å¾ˆè¯¦ç»†çš„è¯´æ˜ã€‚")]),t._v(" "),s("p",[t._v("é‚£ä¹ˆï¼Œæˆ‘ä»¬é€šè¿‡ä¸Šé¢çš„ç¨‹åºæ¥å…·ä½“åšä¸ªåº•å±‚åŸç†çš„åˆ†æï¼Œè¿™ä¹Ÿæ˜¯èƒ½å¤Ÿè®²æ¸…æ¥š"),s("code",[t._v("volatile")]),t._v("å…³é”®å­—ä¿è¯å¯è§æ€§æœ€ç›´è§‚çš„è¯´æ˜äº†ï¼")]),t._v(" "),s("p",[s("strong",[t._v("ã€JMMå†…å­˜æ¨¡å‹8å¤§åŸå­æ“ä½œã€‘")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200611221105.png",alt:""}})]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("readè¯»å–ï¼š")]),t._v(" ä»ä¸»å†…å­˜ä¸­è¯»å–æ•°æ®")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("loadè½½å…¥ï¼š")]),t._v(" å°†ä¸»å†…å­˜è¯»å–åˆ°çš„æ•°æ®å†™å…¥å·¥ä½œå†…å­˜")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("useä½¿ç”¨ï¼š")]),t._v(" ä»å·¥ä½œå†…å­˜è¯»å–å‡ºæ•°æ®æ¥è®¡ç®—")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("assignèµ‹å€¼ï¼š")]),t._v(" å°†CPUè®¡ç®—å‡ºçš„å€¼é‡æ–°èµ‹å€¼åˆ°å·¥ä½œå†…å­˜ä¸­")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("storeå­˜å‚¨ï¼š")]),t._v(" å°†å·¥ä½œå†…å­˜ä¸­æ›´æ”¹åçš„å€¼å†™å…¥åˆ°ä¸»å­˜")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("writeå†™å…¥ï¼š")]),t._v(" å°†storeå›å»çš„å˜é‡èµ‹å€¼ç»™ä¸»å­˜ä¸­çš„å˜é‡")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("locké”å®šï¼š")]),t._v(" å°†ä¸»å†…å­˜å˜é‡åŠ é”ï¼Œæ ‡è¯†ä¸ºçº¿ç¨‹ç‹¬å çŠ¶æ€")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("unlockè§£é”ï¼š")]),t._v(" å°†ä¸»å†…å­˜å˜é‡è§£é”ï¼Œè§£é”åå…¶ä»–çº¿ç¨‹æ‰èƒ½å†æ¬¡é”å®šè¯¥å˜é‡")])])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200611231806.png",alt:""}})]),t._v(" "),s("p",[t._v("è¿˜æ˜¯ä¸Šé¢ç¨‹åºçš„ä»£ç ï¼Œé’ˆå¯¹ä¸Šè¿°ç¨‹åºå‡ºç°çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ¥åšä¸ªæ·±å…¥çš„åˆ†æäº†è§£ï¼šæœ‰å›¾æœ‰çœŸç›¸ğŸ˜’")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200611215100.png",alt:""}})]),t._v(" "),s("p",[t._v("æˆ‘ä»¬å…ˆæ¥åˆ†æã€çº¿ç¨‹1ã€‘ï¼š")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("é¦–å…ˆï¼Œçº¿ç¨‹1å°†ä¸»å†…å­˜ä¸­çš„"),s("code",[t._v("initFlag = false")]),t._v(" readå‡ºæ¥ï¼›")])]),t._v(" "),s("li",[s("p",[t._v("å…¶æ¬¡ï¼Œå°†"),s("code",[t._v("initFlag = false")]),t._v(" æ‹·è´ä¸€ä»½åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼›")])]),t._v(" "),s("li",[s("p",[t._v("ç„¶åï¼ŒCPUå°†çº¿ç¨‹å·¥ä½œå†…å­˜ï¼ˆCPUç¼“å­˜ï¼‰ä¸­çš„æ•°æ®æ‹¿åˆ°è‡ªå·±çš„å¯„å­˜å™¨ä¸­æ¥è®¡ç®—ã€‚")])])]),t._v(" "),s("p",[t._v("æ­¤æ—¶ï¼Œ"),s("code",[t._v("ï¼initFlag")]),t._v("ä¸ºçœŸï¼Œçº¿ç¨‹1é˜»å¡åœ¨æ­»å¾ªç¯ä¸­ï¼Œç­‰å¾…æ•°æ®ä¸­......")]),t._v(" "),s("p",[t._v("å¯¹äºã€çº¿ç¨‹2ã€‘ï¼š")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("å‰ä¸‰æ­¥å®Œå…¨å’Œçº¿ç¨‹1çš„æ“ä½œä¸€æ ·ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯è¿™ä¹ˆå¹²çš„.")])]),t._v(" "),s("li",[s("p",[t._v("çº¿ç¨‹2ä¸­è°ƒç”¨äº†prepareDataæ–¹æ³•ä½¿"),s("code",[t._v("initFlag = true")])])]),t._v(" "),s("li",[s("p",[t._v("ç„¶åCPUå°†æ”¹å˜åçš„å€¼é‡æ–°èµ‹å€¼åˆ°å·¥ä½œå†…å­˜ä¸­ï¼Œæ­¤æ—¶çº¿ç¨‹2çš„å·¥ä½œå†…å­˜ä¸­"),s("code",[t._v("initFlag = true")])])]),t._v(" "),s("li",[s("p",[t._v("çº¿ç¨‹2çš„å·¥ä½œå†…å­˜å­˜å‚¨äº†trueï¼Œå¹¶å‡†å¤‡æ›´æ–°å›ä¸»å­˜ä¸­")])]),t._v(" "),s("li",[s("p",[t._v("çº¿ç¨‹2æ‰§è¡Œwriteæ“ä½œï¼Œå°†"),s("code",[t._v("initFlag = true")]),t._v("å†™å›åˆ°ä¸»å­˜ä¸­")])])]),t._v(" "),s("p",[t._v("æ­¤æ—¶ï¼Œä¸»å­˜ä¸­å­˜æ”¾çš„æ˜¯"),s("code",[t._v("initFlag = true")]),t._v("ã€‚è€Œçº¿ç¨‹1çš„å·¥ä½œå†…å­˜ä¸­ä»»ç„¶æ˜¯"),s("code",[t._v("initFlag = false")]),t._v("ã€‚å°±æ˜¯çº¿ç¨‹2æŠŠinitFalgæ”¹äº†ï¼Œçº¿ç¨‹1è¿˜ä¸çŸ¥é“ï¼Œä»ç„¶æ‹¿çš„æ˜¯åŸæ¥çš„å€¼ï¼Œå¯¼è‡´ç¨‹åºä¸€ç›´å¤„åœ¨æ­»å¾ªç¯ä¸­ã€‚è¿™å°±æ˜¯ç¨‹åºä¸ºä»€ä¹ˆå¡åœ¨äº†è¿™é‡Œçš„åŸå› ï¼")]),t._v(" "),s("p",[t._v("é‚£åæ¥åŠ ä¸Šäº†"),s("code",[t._v("volatile")]),t._v("å…³é”®å­—ï¼Œå®ƒæ˜¯æ€ä¹ˆä¿è¯çº¿ç¨‹2æ”¹å®ŒinitFlagåï¼Œçº¿ç¨‹1ç«‹é©¬å°±çŸ¥é“äº†å‘¢ï¼Ÿæ¢å¥è¯æ¥è¯´ï¼Œçº¿ç¨‹2æ›´æ”¹å®ŒinitFlagåï¼Œæ˜¯æ€ä¹ˆè®©çº¿ç¨‹1çš„å·¥ä½œå†…å­˜ä¸­æ‹·è´çš„å‰¯æœ¬ä¹Ÿç«‹å³æ›´æ–°å‘¢ï¼Ÿ")]),t._v(" "),s("h2",{attrs:{id:"_3-jmmç¼“å­˜ä¸ä¸€è‡´é—®é¢˜"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-jmmç¼“å­˜ä¸ä¸€è‡´é—®é¢˜"}},[t._v("#")]),t._v(" 3. JMMç¼“å­˜ä¸ä¸€è‡´é—®é¢˜")]),t._v(" "),s("p",[t._v("å°±åƒä¸Šé¢å›¾è§£çš„æƒ…å†µä¸€æ ·ï¼ŒJMMå‡ºç°äº†ç¼“å­˜ä¸ä¸€è‡´æ–°çš„é—®é¢˜ï¼Œå³çº¿ç¨‹2ä¿®æ”¹å®ŒinitFlagä¹‹åï¼Œçº¿ç¨‹1å·¥ä½œå†…å­˜ä¸­çš„å‰¯æœ¬å’Œä¸»å­˜ä¸­ä¸ä¸€è‡´çš„é—®é¢˜ã€‚")]),t._v(" "),s("p",[t._v("é‚£ä¹ˆï¼Œå¤§ä½¬ä»¬æ˜¯å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜çš„å‘¢ï¼Ÿ")]),t._v(" "),s("p",[t._v("8ä¸ªåŸå­æ“ä½œï¼Œè¿™ä¸è¿˜å‰©"),s("code",[t._v("lock")]),t._v("å’Œ"),s("code",[t._v("unlock")]),t._v("ä¹ˆï¼ä»–ä¿©å‘€ï¼Œå°±å¹²è¿™äº‹çš„ï¼")]),t._v(" "),s("h3",{attrs:{id:"æ€»çº¿åŠ é”"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ€»çº¿åŠ é”"}},[t._v("#")]),t._v(" æ€»çº¿åŠ é”")]),t._v(" "),s("p",[t._v("èµ·åˆï¼Œæ˜¯é€šè¿‡å¯¹æ•°æ®åœ¨æ€»çº¿ä¸ŠåŠ é”æ¥å®ç°çš„ï¼š")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200612081921.png",alt:""}})]),t._v(" "),s("p",[t._v("ä¸€ä¸ªçº¿ç¨‹åœ¨ä¿®æ”¹æ•°æ®æ—¶ï¼Œä¼šåŠ ä¸€æŠŠ"),s("code",[t._v("lock")]),t._v("é”åˆ°æ€»çº¿ä¸Šã€‚æ­¤æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å°±ä¸èƒ½å†å»è¯»å–æ•°æ®äº†ï¼Œç­‰åˆ°çº¿ç¨‹2å°†æ•°æ®ä¿®æ”¹å®Œå†™å›åˆ°ä¸»å­˜ï¼Œç„¶å"),s("code",[t._v("unlock")]),t._v("é‡Šæ”¾é”ï¼Œç„¶åå…¶ä»–çº¿ç¨‹æ‰èƒ½å¤Ÿè¯»å–ã€‚")]),t._v(" "),s("p",[t._v("è¿™æ ·ï¼Œå½“ç„¶ä¿è¯äº†å…¶ä»–çº¿ç¨‹æ‹¿åˆ°äº†æœ€æ–°çš„æ•°æ®ï¼Œæ•°æ®ä¸€è‡´æ€§å¾—åˆ°ä¿è¯äº†ï¼Œä½†æ˜¯å¤šæ ¸å¹¶è¡Œçš„æ“ä½œï¼Œåœ¨åŠ é”ä¹‹åå˜æˆäº†å•æ ¸ä¸²å‹çš„äº†ï¼Œæ•ˆç‡ä½ä¸‹ã€‚å°±è¿™æ ·çš„é€Ÿåº¦ï¼Œèƒ½å«å¹¶å‘å—ï¼Ÿè¿™è¿˜æ€ä¹ˆè¿‡åŒåä¸€å‘€ğŸ¤£ï¼")]),t._v(" "),s("h3",{attrs:{id:"mesiç¼“å­˜ä¸€è‡´æ€§åè®®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mesiç¼“å­˜ä¸€è‡´æ€§åè®®"}},[t._v("#")]),t._v(" MESIç¼“å­˜ä¸€è‡´æ€§åè®®")]),t._v(" "),s("blockquote",[s("p",[s("a",{attrs:{href:"https://zh.wikipedia.org/wiki/MESI%E5%8D%8F%E8%AE%AE",target:"_blank",rel:"noopener noreferrer"}},[t._v("MESIåè®®"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("å¤šä¸ªCPUä»ä¸»å†…å­˜è¯»å–åŒä¸€ä¸ªæ•°æ®åˆ°å„è‡ªçš„é«˜é€Ÿç¼“å­˜ï¼Œå½“å…¶ä¸­æŸä¸ªCPUä¿®æ”¹äº†ç¼“å­˜é‡Œçš„æ•°æ®ï¼Œè¯¥"),s("strong",[t._v("æ•°æ®ä¼šé©¬ä¸ŠåŒæ­¥å›ä¸»å†…å­˜")]),t._v("ï¼Œå…¶å®ƒCPUé€šè¿‡"),s("strong",[t._v("æ€»çº¿ä¾¦å¬æœºåˆ¶")]),t._v("å¯ä»¥æ„ŸçŸ¥åˆ°æ•°æ®çš„å˜åŒ–ï¼Œä»è€Œå°†è‡ªå·±ç¼“å­˜é‡Œçš„æ•°æ®å¤±æ•ˆã€‚")]),t._v(" "),s("p",[s("strong",[t._v("æ€»çº¿ä¾¦å¬ï¼š")])]),t._v(" "),s("p",[t._v("å½“å‡ ä¸ªç¼“å­˜å…±äº«ç‰¹å®šæ•°æ®å¹¶ä¸”å¤„ç†å™¨ä¿®æ”¹å…±äº«æ•°æ®çš„å€¼æ—¶ï¼Œæ›´æ”¹å¿…é¡»ä¼ æ’­åˆ°æ‰€æœ‰å…¶ä»–å…·æœ‰æ•°æ®å‰¯æœ¬çš„ç¼“å­˜ä¸­ã€‚è¿™ç§å˜åŒ–çš„ä¼ æ’­å¯ä»¥é˜²æ­¢ç³»ç»Ÿè¿å"),s("a",{attrs:{href:"https://en.wikipedia.org/wiki/Cache_coherence",title:"ç¼“å­˜ä¸€è‡´æ€§",target:"_blank",rel:"noopener noreferrer"}},[t._v("é«˜é€Ÿç¼“å­˜ä¸€è‡´æ€§"),s("OutboundLink")],1),t._v("ã€‚å¯ä»¥é€šè¿‡æ€»çº¿ä¾¦å¬æ¥å®Œæˆæ•°æ®æ›´æ”¹çš„é€šçŸ¥ã€‚"),s("strong",[t._v("æ‰€æœ‰ä¾¦å¬å™¨éƒ½ä¼šç›‘è§†æ€»çº¿ä¸Šçš„æ¯ç¬”äº¤æ˜“ã€‚å¦‚æœä¿®æ”¹å…±äº«ç¼“å­˜å—çš„äº‹åŠ¡å‡ºç°åœ¨æ€»çº¿ä¸Šï¼Œåˆ™æ‰€æœ‰ä¾¦å¬å™¨éƒ½ä¼šæ£€æŸ¥å…¶ç¼“å­˜æ˜¯å¦å…·æœ‰å…±äº«å—çš„ç›¸åŒå‰¯æœ¬ã€‚å¦‚æœç¼“å­˜å…·æœ‰å…±äº«å—çš„å‰¯æœ¬ï¼Œåˆ™ç›¸åº”çš„çª¥æ¢å™¨å°†æ‰§è¡Œæ“ä½œä»¥ç¡®ä¿ç¼“å­˜ä¸€è‡´æ€§")]),t._v("ã€‚è¯¥åŠ¨ä½œå¯ä»¥æ˜¯"),s("a",{attrs:{href:"https://forums.xilinx.com/t5/Embedded-Development-Tools/what-is-the-difference-between-cache-invalidate-and-cache-flush/td-p/74654",target:"_blank",rel:"noopener noreferrer"}},[t._v("åˆ·æ–°"),s("OutboundLink")],1),t._v("æˆ–"),s("a",{attrs:{href:"https://en.wikipedia.org/wiki/Cache_invalidation",title:"ç¼“å­˜å¤±æ•ˆ",target:"_blank",rel:"noopener noreferrer"}},[t._v("æ— æ•ˆ"),s("OutboundLink")],1),t._v("ç¼“å­˜å—ã€‚å®ƒè¿˜ä¾èµ–äºç¼“å­˜ä¸€è‡´æ€§åè®®æ¥æ”¹å˜ç¼“å­˜å—çŠ¶æ€ã€‚")]),t._v(" "),s("p",[t._v("MESIç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œé€šè¿‡å¯¹æ€»çº¿çš„ä¾¦å¬æœºåˆ¶ï¼Œå¾ˆå¥½åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚")]),t._v(" "),s("blockquote",[s("p",[t._v("æ²¡é”™ï¼Œç¡¬ä»¶ï¼å°±æ˜¯è¿™ä¹ˆç¡¬æ ¸ä¸”é«˜æ•ˆã€‚")])]),t._v(" "),s("p",[t._v("ã€ç®€å•æ€»ç»“ä¸€ä¸‹ã€‘ï¼š")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200612085809.png",alt:""}})]),t._v(" "),s("p",[t._v("æ€»çº¿ä¸Šå®‰è£…äº†å¤šä¸ªç›‘å¬å™¨ï¼Œå‘ç°æœ‰çº¿ç¨‹ä¿®æ”¹äº†å†…å­˜ä¸­çš„æ•°æ®ï¼Œå°±ä¼šä½¿å…¶ä»–çº¿ç¨‹å·¥ä½œåŒºé—´ä¸ä¸€è‡´çš„å‰¯æœ¬"),s("strong",[t._v("ç«‹å³å¤±æ•ˆ")]),t._v("ï¼Œç„¶åè®©ä»–ä»¬é‡æ–°å¹¶è¡Œè¯»å–ã€‚")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"_4-volatileå¯è§æ€§åº•å±‚å®ç°åŸç†"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-volatileå¯è§æ€§åº•å±‚å®ç°åŸç†"}},[t._v("#")]),t._v(" 4. volatileå¯è§æ€§åº•å±‚å®ç°åŸç†")]),t._v(" "),s("p",[t._v("ä¸Šé¢è®²äº†ç¡¬ä»¶å±‚é¢ä¸Šçš„å®ç°ï¼Œé‚£ä¹ˆï¼Œè½¯ä»¶ä¸Šæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ")]),t._v(" "),s("p",[t._v("æœ‰äº†æ€»çº¿ç›‘å¬å™¨ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æµ‹åˆ°çº¿ç¨‹ä¿®æ”¹æ•°æ®çš„è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œçº¿ç¨‹2ä¿®æ”¹äº†æ•°æ®ï¼Œç›‘å¬å™¨ä¹Ÿæ£€æµ‹åˆ°äº†ï¼Œçº¿ç¨‹1æ˜¯æ€ä¹ˆçŸ¥é“å¹¶ä¸”ä¿®æ”¹çš„å‘¢ï¼Ÿ")]),t._v(" "),s("p",[t._v("æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œçº¿ç¨‹é—´å„è‡ªå·¥ä½œéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œçº¿ç¨‹2ä¿®æ”¹äº†æ•°æ®ï¼Œå¹¶ä¸ä¼šå‘Šè¯‰çº¿ç¨‹1æˆ‘ä¿®æ”¹äº†ã€‚æ•°æ®éƒ½åœ¨å†…å­˜ä¸Šï¼Œå¤§å®¶å…±æœ‰çš„ï¼Œæˆ‘ä¿®æ”¹å‡­ä»€ä¹ˆè¦å‘Šè¯‰ä½ ğŸ˜’ï¼Ÿæ¢å¥è¯æ¥è¯´ï¼Œä»–ä»¬éƒ½æ˜¯é€šè¿‡ä¸»å­˜æ¥æ²Ÿé€šäº¤äº’çš„ã€‚")]),t._v(" "),s("p",[t._v("é‚£ä¹ˆï¼Œ"),s("code",[t._v("volatile")]),t._v("å…³é”®å­—æ˜¯æ€ä¹ˆä¿è¯ä¿®æ”¹çš„å¯è§æ€§çš„å‘¢ï¼Ÿ")]),t._v(" "),s("blockquote",[s("p",[t._v("volatileçš„ä»£ç æ˜¯ç”¨æ›´åŠ åº•å±‚çš„C/C++ä»£ç æ¥å®ç°çš„")])]),t._v(" "),s("p",[t._v("åº•å±‚çš„å®ç°ï¼Œä¸»è¦æ˜¯é€šè¿‡æ±‡ç¼–"),s("code",[t._v("lock")]),t._v("å‰ç¼€æŒ‡ä»¤ï¼Œå®ƒä¼šé”å®šå†…å­˜åŒºåŸŸçš„ç¼“å­˜ï¼ˆç¼“å­˜è¡Œé”å®šï¼‰ï¼Œå¹¶å†™å›åˆ°ä¸»å†…å­˜ä¸­ã€‚")]),t._v(" "),s("h3",{attrs:{id:"ä¿è¯å¯è§æ€§åŸç†éªŒè¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¿è¯å¯è§æ€§åŸç†éªŒè¯"}},[t._v("#")]),t._v(" ä¿è¯å¯è§æ€§åŸç†éªŒè¯")]),t._v(" "),s("p",[t._v("æˆ‘ä»¬å¯¹ç¨‹åºåšåæ±‡ç¼–ï¼ŒæŸ¥çœ‹æ±‡ç¼–ä»£ç ï¼š")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200612093014.png",alt:""}})]),t._v(" "),s("blockquote",[s("p",[t._v("ç”±äºæ±‡ç¼–ä»£ç æ¯”è¾ƒé•¿ï¼Œè™½ç„¶ä¿ºå­¦äº†å¾®æœºåŸç†ï¼Œä½†çœŸçš„æ˜¯çœ‹ä¸æ‡‚ğŸ˜­ã€‚å°±æŒ‘æœ€é‡è¦çš„ä¸€å¥æ‘˜å½•å‡ºæ¥è§£é‡Š")])]),t._v(" "),s("p"),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x0000000002c860bf")]),t._v("ï¼šlock add dword ptr "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("rsp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Oh")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("putstatic initFlag \n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("iqqcode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jmm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),t._v("VolatileVisibilityTest")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("prepareData")]),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("line "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("å¯¹åº”ä»£ç ä¸º")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("initFlag "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("A-32æ¶æ„è½¯ä»¶å¼€å‘è€…æ‰‹å†Œå¯¹lockæŒ‡ä»¤çš„è§£é‡Šï¼š")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("ä¼šå°†å½“å‰å¤„ç†å™¨ç¼“å­˜è¡Œçš„æ•°æ®"),s("font",{attrs:{color:"red"}},[s("strong",[t._v("ç«‹å³")])]),t._v("å†™å›åˆ°ç³»ç»Ÿå†…å­˜")],1)]),t._v(" "),s("li",[s("p",[t._v("è¿™ä¸ªå†™å›å†…å­˜çš„æ“ä½œä¼šå¼•èµ·åœ¨å…¶ä»–CPUé‡Œç¼“å­˜äº†è¯¥å†…å­˜åœ°å€çš„æ•°æ®æ— æ•ˆ")])])]),t._v(" "),s("p",[t._v("å°±æ˜¯é€šè¿‡"),s("code",[t._v("lock")]),t._v("æŒ‡ä»¤ï¼Œè®©initFlagç«‹å³å†™å›å†…å­˜ï¼Œä¸”è®©å…¶ä»–çº¿ç¨‹ä¸­çš„å‰¯æœ¬å¤±æ•ˆã€‚")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200612111249.png",alt:""}})]),t._v(" "),s("p",[t._v("ç›¸æ¯”äºæ­¤å‰åœ¨æ€»çº¿ä¸ŠåŠ çš„é‡é‡çº§é”ï¼Œ"),s("code",[t._v("lock")]),t._v("æŒ‡ä»¤åªæ˜¯åœ¨ä¼šå†™ä¸»å†…å­˜æ—¶åŠ äº†é”ï¼Œå°±æ˜¯ä»storeæ“ä½œå¼€å§‹æ‰åŠ é”ï¼Œè€Œæ­¤å‰çš„æ€»çº¿ä¸ŠåŠ é”æ˜¯ä»readå°±å¼€å§‹äº†ã€‚ä¸€æ—¦å†™å›ï¼Œç«‹å³"),s("code",[t._v("unlock")]),t._v("é‡Šæ”¾é”ã€‚ç”±äºCPUçš„è¯»å†™æ˜¯éå¸¸å¿«çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯éå¸¸éå¸¸ä¹‹çŸ­çš„ã€‚æ‰€ä»¥"),s("code",[t._v("volatile")]),t._v("æ˜¯è½»é‡çº§çš„é”ï¼Œæ€§èƒ½é«˜ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("Qï¼šå¦‚æœä¸åŠ  lock - unlock æŒ‡ä»¤ä¼šæ€æ ·ï¼Ÿ")])]),t._v(" "),s("p",[t._v("çº¿ç¨‹2åœ¨storeåˆ°writeä¹‹é—´ï¼Œè¿™æ—¶"),s("code",[t._v("initFlag = true")]),t._v("è¢«CPUä¿®æ”¹äº†å€¼ä½†æ˜¯è¿˜æ²¡æœ‰å†™å›ä¸»å†…å­˜ï¼Œæ€»çº¿ç›‘å¬æœºåˆ¶å‘ç°äº†æ•°æ£€æµ‹çš„æ®è¢«ä¿®æ”¹ï¼Œç«‹å³ä½¿çº¿ç¨‹1å·¥ä½œå†…å­˜çš„å‰¯æœ¬å¤±æ•ˆï¼Œçº¿ç¨‹1å†æ¬¡å»è¯»å–initFlagï¼Œä½†æ­¤æ—¶ç”±äºæ²¡æœ‰åŠ é”å¹¶ä¸”è¿˜æ²¡æ¥å¾—åŠä¿®æ”¹"),s("code",[t._v("initFlag = false")]),t._v("è¿™ä¸ªè„æ•°æ®ï¼Œçº¿ç¨‹1åˆå°†"),s("code",[t._v("initFlag = false")]),t._v("é”™è¯¯çš„æ•°æ®æ‹·è´åˆ°å·¥ä½œå†…å­˜ä¸­ï¼Œè¿˜æ˜¯å¤„äºæ­»å¾ªç¯ä¸­ï¼Œä¾ç„¶ä¼šå­˜åœ¨é—®é¢˜ã€‚")]),t._v(" "),s("p",[t._v("æ‰€ä»¥ï¼Œå¿…é¡»è¦åœ¨storeå’Œwriteä¹‹é—´åŠ ä¸Š"),s("strong",[t._v("lock")]),t._v("å’Œ"),s("strong",[t._v("unlock")]),t._v("ï¼Œé˜²æ­¢æ—¶é—´å·®å¸¦æ¥çš„è¯¯è¯»ã€‚")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200612113235.png",alt:""}})]),t._v(" "),s("p",[s("code",[t._v("volatile")]),s("strong",[t._v("ä¿è¯å¯è§æ€§ä¸æœ‰åºæ€§")]),t._v("ï¼Œä½†æ˜¯"),s("font",{attrs:{color:"red"}},[t._v("ä¸ä¿è¯è¯åŸå­æ€§")]),t._v("ï¼Œä¿è¯åŸåˆ™æ€§éœ€è¦å€ŸåŠ©"),s("code",[t._v("synchronized")]),t._v("è¿™æ ·çš„é”æœºåˆ¶")],1),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"_5-volatileä¸ä¿è¯åŸå­æ€§"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-volatileä¸ä¿è¯åŸå­æ€§"}},[t._v("#")]),t._v(" 5. volatileä¸ä¿è¯åŸå­æ€§")]),t._v(" "),s("h3",{attrs:{id:"ä¸ä¿è¯åŸå­æ€§éªŒè¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ä¿è¯åŸå­æ€§éªŒè¯"}},[t._v("#")]),t._v(" ä¸ä¿è¯åŸå­æ€§éªŒè¯")]),t._v(" "),s("p",[t._v("è¿˜æ˜¯é€šè¿‡ä»£ç æ¥è¯´æ˜é—®é¢˜ï¼š")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * @Author: Mr.Q\n * @Date: 2020-06-11 11:04\n * @Description:volatileä¸ä¿è¯åŸå­æ€§æµ‹è¯•\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("VolatileAtomicityTest")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" num "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("increase")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        num"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" threads "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" threads"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            threads"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" j "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" j "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" j"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("increase")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            threads"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//ä¸»çº¿ç¨‹é˜»å¡ï¼Œç­‰å¾…çº¿ç¨‹æ•°ç»„ä¸­çš„10ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œå†ç»§ç»­æ‰§è¡Œ")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),t._v(" thread "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" threads"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            thread"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("num"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// num <= 1000 * 10")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br")])]),s("blockquote",[s("p",[t._v("ç»“æœï¼šnum <= 10000")])]),t._v(" "),s("p",[t._v("æ­¤æ—¶æ­¤åˆ»ï¼Œæˆ‘å·²å¯¹å¹¶å‘ç¼–ç¨‹çš„ä»£ç å½»åº•å¹²æ‡µğŸ™‚ï¼Œå«ç€æ³ªï¼Œç»§ç»­å¾€ä¸‹å­¦ä¹ ï¼")]),t._v(" "),s("p",[t._v("æŒ‰é“ç†æ¥è¯´ç»“æœæ˜¯10000ï¼Œä½†æ˜¯è¿è¡Œä¸‹å¾ˆå¯èƒ½æ˜¯ä¸ªå°äº10000çš„å€¼ã€‚")]),t._v(" "),s("p",[t._v("å’¦ï¼Ÿvolatileä¸æ˜¯ä¿è¯äº†å¯è§æ€§å•Šï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹numçš„ä¿®æ”¹ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹åº”è¯¥ç«‹åˆ»çœ‹åˆ°å•Šï¼")]),t._v(" "),s("p",[t._v("å¯æ˜¯è¿™é‡Œçš„æ“ä½œ"),s("code",[t._v("num++")]),t._v("æ˜¯ä¸ªå¤åˆæ“ä½œï¼ŒåŒ…æ‹¬è¯»å–numçš„å€¼ï¼Œå¯¹å…¶è‡ªå¢ï¼Œç„¶åå†å†™å›ä¸»å­˜ã€‚")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200612145854.png",alt:""}})]),t._v(" "),s("ul",[s("li",[s("p",[t._v("å‡è®¾çº¿ç¨‹1ï¼Œè¯»å–äº†numçš„å€¼ä¸º0ï¼Œçº¿ç¨‹2åˆšå¥½å’Œçº¿ç¨‹2æ˜¯åŒæ­¥æ“ä½œï¼Œä¹Ÿä¸ºnum=0ï¼›")])]),t._v(" "),s("li",[s("p",[t._v("ä»–ä¿©éƒ½å¯¹numåšäº†+1æ“ä½œï¼Œ"),s("strong",[t._v("åŒæ—¶")]),t._v("å‡†å¤‡"),s("code",[t._v("write")]),t._v("ä¼šä¸»å†…å­˜ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("çœ‹è°å…ˆé€šè¿‡æ€»çº¿(åŒ…æ‹¬åŒæ—¶é€šè¿‡)")])]),t._v(" "),s("li",[s("p",[t._v("å‡è®¾æ˜¯çº¿ç¨‹1å…ˆé€šè¿‡ã€‚MESIä¼šå°†çº¿ç¨‹2å·¥ä½œå†…å­˜ä¸­"),s("code",[t._v("num = 1")]),t._v("çš„å‰¯æœ¬ç«‹åˆ»ç½®ä½æ— æ•ˆï¼Œæ­¤æ—¶çº¿ç¨‹1å·²å°†"),s("code",[t._v("num = 0 --\x3e 1")]),t._v("ä¿®æ”¹ï¼Œ"),s("code",[t._v("num = 1")])])]),t._v(" "),s("li",[s("p",[t._v("çº¿ç¨‹2åªèƒ½å†æ¬¡é‡æ–°è¯»å–"),s("code",[t._v("num = 1")]),t._v("ï¼Œç„¶åæ‰§è¡ŒåŠ ä¸€å†å›å†™ä¸»å†…å­˜ã€‚"),s("code",[t._v("num = 2")]),t._v("ï¼Œä½†æ˜¯å´æ‰§è¡Œäº†ä¸‰æ¬¡å¾ªç¯ï¼Œæ­¤æ—¶"),s("code",[t._v("i = 3")])])])]),t._v(" "),s("blockquote",[s("p",[t._v("å¦‚æœçº¿ç¨‹1å’Œçº¿ç¨‹2åŒæ—¶é€šè¿‡ï¼Œç”±äºä»–ä»¬å·¥ä½œå†…å­˜ä¸­numå‡ä¸º1ï¼Œæ‰€ä»¥è¿˜æ˜¯æ‰§è¡Œäº†3æ¬¡å¾ªç¯è€Œnumè‡ªå¢äº†2æ¬¡")])]),t._v(" "),s("p",[t._v("è¿™å°±æ˜¯num < 10000çš„åŸå› ã€‚å¦‚æœæ²¡æœ‰å‡ºç°ä¸Šè¿°æƒ…å†µï¼Œnum = 10000")]),t._v(" "),s("h3",{attrs:{id:"ã€é—®é¢˜è§£å†³ã€‘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ã€é—®é¢˜è§£å†³ã€‘"}},[t._v("#")]),t._v(" ã€é—®é¢˜è§£å†³ã€‘")]),t._v(" "),s("p",[s("strong",[t._v("1. åŒæ­¥åŠ é”è§£å†³volatileåŸå­æ€§é—®é¢˜")])]),t._v(" "),s("p",[t._v("ç¬¬ä¸€ç§è¡¥æ•‘æªæ–½å¾ˆç®€å•ï¼Œå°±æ˜¯ç®€å•ç²—æš´çš„çš„åŠ é”ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ç»™numåŠ 1è¿™ä¸ªæ–¹æ³•æ˜¯åŒæ­¥çš„ï¼Œè¿™æ ·æ¯ä¸ªçº¿ç¨‹å°±ä¼šäº•ç„¶æœ‰åºçš„è¿è¡Œï¼Œè€Œä¿è¯äº†æœ€ç»ˆçš„numæ•°å’Œé¢„æœŸå€¼ä¸€è‡´ã€‚")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200613090737.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("2. CASè§£å†³volatileåŸå­æ€§é—®é¢˜")])]),t._v(" "),s("p",[t._v("é’ˆå¯¹"),s("code",[t._v("num++")]),t._v("è¿™ç±»å¤åˆç±»çš„æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨JUCå¹¶å‘åŒ…ä¸­çš„åŸå­æ“ä½œç±»ï¼ŒåŸå­æ“ä½œç±»æ˜¯é€šè¿‡å¾ªç¯"),s("strong",[t._v("CAS")]),t._v("çš„æ–¹å¼æ¥ä¿è¯å…¶åŸå­æ€§çš„ã€‚")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200613090919.png",alt:""}})]),t._v(" "),s("p",[t._v("AtomicIntegerè¿™æ˜¯ä¸ªåŸºäºCASçš„æ— é”æŠ€æœ¯ï¼Œå®ƒçš„ä¸»è¦åŸç†å°±æ˜¯é€šè¿‡æ¯”è¾ƒé¢„æœŸå€¼å’Œå®é™…å€¼ï¼Œå½“å…¶æ²¡æœ‰å¼‚å¸¸çš„ä»¥åï¼Œå°±è¿›è¡Œå¢å€¼æ“ä½œã€‚"),s("code",[t._v("incrementAndGet")]),t._v("è¿™ä¸ªæ–¹æ³•å®é™…ä¸Šæ¯æ¬¡å¯¹numè¿›è¡Œ+1çš„è¿‡ç¨‹éƒ½è¿›è¡Œäº†æ¯”è¾ƒï¼Œå­˜åœ¨ä¸€ä¸ªretryçš„è¿‡ç¨‹ã€‚å®ƒåœ¨å¤šçº¿ç¨‹å¤„ç†ä¸­å¯ä»¥é˜²æ­¢è¿™ç§å¤šæ¬¡é€’å¢è€Œå¼•å‘çš„çº¿ç¨‹ä¸å®‰å…¨çš„é—®é¢˜")]),t._v(" "),s("h2",{attrs:{id:"_6-volatileä¿è¯æœ‰åºæ€§"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-volatileä¿è¯æœ‰åºæ€§"}},[t._v("#")]),t._v(" 6. volatileä¿è¯æœ‰åºæ€§")]),t._v(" "),s("p",[t._v("volatileä¿è¯æœ‰åºæ€§ï¼Œå°±æ˜¯ç¦æ­¢ç¼–è¯‘å™¨åœ¨ç¼–è¯‘é˜¶æ®µå¯¹æŒ‡ä»¤çš„é‡æ’åºé—®é¢˜ã€‚")]),t._v(" "),s("h3",{attrs:{id:"volatileç¦æ­¢æŒ‡ä»¤é‡æ’åº"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#volatileç¦æ­¢æŒ‡ä»¤é‡æ’åº"}},[t._v("#")]),t._v(" volatileç¦æ­¢æŒ‡ä»¤é‡æ’åº")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("VolatileSeriaTest")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//æ­¤å¤„a,bå˜é‡æ˜¯å¦æ·»åŠ volatileæ¥ä¿®é¥°")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Set")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" set "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HashSet")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" map "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HashMap")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            b "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("clear")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),t._v(" one "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                b "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" x "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"x"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),t._v(" two "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" y "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"y"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            one"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            two"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            one"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            two"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            set"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"x="')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"x"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('","')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"y="')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"y"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("set "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" --\x3e i = "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br")])]),s("p",[t._v("æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç¨‹åºä¸€å…±è·‘å‡ºäº†å››ç§æƒ…å†µï¼š")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200613080900.png",alt:""}})]),t._v(" "),s("p",[t._v("è¿™ä¸‰ç§æƒ…å†µï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200613081920.png",alt:""}})]),t._v(" "),s("p",[t._v("ä½†æ˜¯å‡ºç°äº†"),s("code",[t._v("x=0")]),t._v("ï¼Œ"),s("code",[t._v("y=0")]),t._v("å°±ä¸æ­£å¸¸äº†ï¼ŒåŸå› å°±æ˜¯ç¼–è¯‘å™¨å¯¹ç¨‹åºä½œäº†æŒ‡ä»¤é‡æ’åº")]),t._v(" "),s("p",[t._v("å½“ä¸¤ä¸ªçº¿ç¨‹ä»¥")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("x = aï¼›")])]),t._v(" "),s("li",[s("p",[t._v("a = 1;")])]),t._v(" "),s("li",[s("p",[t._v("y = b;")])]),t._v(" "),s("li",[s("p",[t._v("b = 1;")])])]),t._v(" "),s("p",[t._v("é¡ºåºæ¥æ‰§è¡Œï¼Œå°±ä¼šå‡ºç°"),s("code",[t._v("x=0")]),t._v("ï¼Œ"),s("code",[t._v("y=0")]),t._v("è¿™ç§ç‰¹æ®Šæƒ…å†µï¼Œè¿™æ˜¯å•çº¿ç¨‹ä¸‹ç°è±¡ä¸åˆ°çš„æƒ…æ™¯ã€‚")]),t._v(" "),s("blockquote",[s("p",[t._v("CPUæŒ‡ä»¤é‡æ’åºçš„å®šä¹‰ä¸ºï¼šCPUå…è®¸åœ¨"),s("strong",[t._v("æŸäº›æ¡ä»¶")]),t._v("ä¸‹è¿›è¡Œ"),s("strong",[t._v("æŒ‡ä»¤é‡æ’åº")]),t._v("ï¼Œä»…éœ€ä¿è¯"),s("strong",[t._v("é‡æ’åºåå•çº¿ç¨‹ä¸‹çš„è¯­ä¹‰ä¸€è‡´")])])]),t._v(" "),s("p",[t._v("ä¿è¯çš„æ˜¯å•çº¿ç¨‹ä¸‹çš„è¯­ä¹‰ä¸€è‡´ï¼Œå¤šçº¿ç¨‹æ—¶æ˜¯ä¸ä¿è¯çš„ï¼Œæ‰€ä»¥å°±éœ€è¦"),s("code",[t._v("volatile")]),t._v("æ¥ç¦æ­¢æŒ‡ä»¤é‡æ’åºäº†ã€‚")]),t._v(" "),s("p",[t._v("é‚£åˆ°åº•æ˜¯æ€ä¹ˆç¦æ­¢çš„å‘¢ï¼Ÿ")]),t._v(" "),s("blockquote",[s("p",[t._v("è¿™é‡Œåªæ˜¯ç®€å•çš„è¯´æ˜é—®é¢˜ï¼Œæ·±å…¥çš„æºç åˆ†æç ”ç©¶ï¼Œå¤§å®¶çœ‹çœ‹æºç æŸ¥æŸ¥èµ„æ–™å§ã€‚")]),t._v(" "),s("ul",[s("li",[t._v("é™„ä¸Šä¸€ç¯‡å‚è€ƒæ–‡ç« ï¼Œæ–‡ç« ä¸­åšäº†x = 0ï¼Œy = 0è¿™ç§æƒ…å†µçš„è®²è§£")]),t._v(" "),s("li",[t._v("ã€Š"),s("a",{attrs:{href:"https://www.jianshu.com/p/068ca23c38ba",target:"_blank",rel:"noopener noreferrer"}},[t._v("æŒ‡ä»¤é‡æ’åºä¸volatileå…³é”®å­—"),s("OutboundLink")],1),t._v("ã€‹")])])]),t._v(" "),s("p",[t._v("è¿™ä¸ªæ¶‰åŠåˆ°å†…å­˜å±éšœ(Memory Barrier)")]),t._v(" "),s("h3",{attrs:{id:"å†…å­˜å±éšœç®€ä»‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å†…å­˜å±éšœç®€ä»‹"}},[t._v("#")]),t._v(" å†…å­˜å±éšœç®€ä»‹")]),t._v(" "),s("p",[s("strong",[t._v("å†…å­˜å±éšœæœ‰ä¸¤ä¸ªèƒ½åŠ›ï¼š")])]),t._v(" "),s("ol",[s("li",[s("p",[t._v("å°±åƒä¸€å¥—æ …æ åˆ†å‰²å‰åçš„ä»£ç ï¼Œé˜»æ­¢æ …æ å‰åçš„æ²¡æœ‰æ•°æ®ä¾èµ–æ€§çš„ä»£ç è¿›è¡ŒæŒ‡ä»¤é‡æ’åºï¼Œä¿è¯ç¨‹åºåœ¨ä¸€å®šç¨‹åº¦ä¸Šçš„æœ‰åºæ€§ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("å¼ºåˆ¶æŠŠå†™ç¼“å†²åŒº/é«˜é€Ÿç¼“å­˜ä¸­çš„è„æ•°æ®ç­‰å†™å›ä¸»å†…å­˜ï¼Œè®©ç¼“å­˜ä¸­ç›¸åº”çš„æ•°æ®å¤±æ•ˆï¼Œä¿è¯æ•°æ®çš„å¯è§æ€§ã€‚")])])]),t._v(" "),s("p",[t._v("é¦–å…ˆï¼ŒæŒ‡ä»¤å¹¶ä¸æ˜¯ä»£ç è¡Œï¼ŒæŒ‡ä»¤æ˜¯åŸå­çš„ï¼Œé€šè¿‡"),s("code",[t._v("javap")]),t._v("å‘½ä»¤å¯ä»¥çœ‹åˆ°ä¸€è¡Œä»£ç ç¼–è¯‘å‡ºæ¥çš„æŒ‡ä»¤ï¼Œå½“ç„¶ï¼Œåƒ"),s("code",[t._v("int i=1;")]),t._v("è¿™æ ·çš„ä»£ç è¡Œä¹Ÿæ˜¯åŸå­æ“ä½œã€‚")]),t._v(" "),s("p",[t._v("åœ¨å•ä¾‹æ¨¡å¼ä¸­ï¼Œ"),s("code",[t._v("Instance ins = new Instance();")]),t._v("Â  Â å°±ä¸æ˜¯åŸå­æ“ä½œï¼Œå®ƒå¯ä»¥åˆ†æˆä¸‰æ­¥åŸå­æŒ‡ä»¤ï¼š")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("åˆ†é…å†…å­˜åœ°å€ï¼›")])]),t._v(" "),s("li",[s("p",[t._v("newä¸€ä¸ªInstanceå¯¹è±¡ï¼›")])]),t._v(" "),s("li",[s("p",[t._v("å°†å†…å­˜åœ°å€èµ‹å€¼ç»™insï¼›")])])]),t._v(" "),s("p",[t._v("CPUä¸ºäº†æé«˜æ‰§è¡Œæ•ˆç‡ï¼Œè¿™ä¸‰æ­¥æ“ä½œçš„é¡ºåºå¯ä»¥æ˜¯123ï¼Œä¹Ÿå¯ä»¥æ˜¯132ã€‚")]),t._v(" "),s("p",[t._v("å¦‚æœæ˜¯132é¡ºåºçš„è¯ï¼Œå½“æŠŠå†…å­˜åœ°å€èµ‹ç»™inståï¼ŒinsæŒ‡å‘çš„å†…å­˜åœ°å€è¿˜æ²¡æœ‰newå‡ºæ¥å•ä¾‹å¯¹è±¡ï¼Œè¿™æ—¶å€™ï¼Œå¦‚æœæ‹¿åˆ°insçš„è¯ï¼Œå…¶å®å°±æ˜¯ç©ºçš„ï¼Œä¼šæŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚")]),t._v(" "),s("p",[t._v("è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ"),s("strong",[t._v("åŒé‡æ£€æŸ¥å•ä¾‹æ¨¡å¼(DCL)")]),t._v(" ä¸­ï¼Œå•ä¾‹å¯¹è±¡è¦åŠ ä¸Švolatileå…³é”®å­—ã€‚")]),t._v(" "),s("p"),t._v(" "),s("p",[s("strong",[t._v("å†…å­˜å±éšœæœ‰ä¸‰ç§ç±»å‹å’Œä¸€ç§ä¼ªç±»å‹ï¼š")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("lfenceï¼šå³è¯»å±éšœ(Load Barrier)ï¼Œåœ¨è¯»æŒ‡ä»¤å‰æ’å…¥è¯»å±éšœï¼Œå¯ä»¥è®©é«˜é€Ÿç¼“å­˜ä¸­çš„æ•°æ®å¤±æ•ˆï¼Œé‡æ–°ä»ä¸»å†…å­˜åŠ è½½æ•°æ®ï¼Œä»¥ä¿è¯è¯»å–çš„æ˜¯æœ€æ–°çš„æ•°æ®ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("sfenceï¼šå³å†™å±éšœ(Store Barrier)ï¼Œåœ¨å†™æŒ‡ä»¤ä¹‹åæ’å…¥å†™å±éšœï¼Œèƒ½è®©å†™å…¥ç¼“å­˜çš„æœ€æ–°æ•°æ®å†™å›åˆ°ä¸»å†…å­˜ï¼Œä»¥ä¿è¯å†™å…¥çš„æ•°æ®ç«‹åˆ»å¯¹å…¶ä»–çº¿ç¨‹å¯è§ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("mfenceï¼Œå³å…¨èƒ½å±éšœï¼Œå…·å¤‡ifenceå’Œsfenceçš„èƒ½åŠ›ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("[ ] Lockå‰ç¼€ï¼šLockä¸æ˜¯ä¸€ç§å†…å­˜å±éšœï¼Œä½†æ˜¯å®ƒèƒ½å®Œæˆç±»ä¼¼å…¨èƒ½å‹å†…å­˜å±éšœçš„åŠŸèƒ½ã€‚")])])]),t._v(" "),s("p",[s("code",[t._v("volatile")]),t._v("ä¼šç»™ä»£ç æ·»åŠ ä¸€ä¸ªå†…å­˜å±éšœï¼ŒæŒ‡ä»¤é‡æ’åºçš„æ—¶å€™ä¸ä¼šæŠŠåé¢çš„æŒ‡ä»¤é‡æ’åºåˆ°å±éšœçš„ä½ç½®ä¹‹å‰")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200613084031.png",alt:""}})]),t._v(" "),s("blockquote",[s("p",[t._v("PSğŸ˜ï¼šåªæœ‰ä¸€ä¸ªCPUçš„æ—¶å€™ï¼Œè¿™ç§å†…å­˜å±éšœæ˜¯å¤šä½™çš„ã€‚åªæœ‰å¤šä¸ªCPUIè®¿é—®åŒä¸€å—å†…å­˜çš„æ—¶å€™ï¼Œå°±éœ€è¦å†…å­˜å±éšœäº†ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"jmmçš„happens-beforeåŸåˆ™"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jmmçš„happens-beforeåŸåˆ™"}},[t._v("#")]),t._v(" JMMçš„Happens-BeforeåŸåˆ™")]),t._v(" "),s("p",[t._v("Happens-Before æ˜¯javaå†…å­˜æ¨¡å‹ä¸­çš„è¯­ä¹‰è§„èŒƒï¼Œæ¥é˜è¿°æ“ä½œä¹‹é—´å†…å­˜çš„å¯è§æ€§ï¼Œå¯ä»¥ç¡®ä¿ä¸€æ¡è¯­å¥çš„æ‰€æœ‰â€œå†™å†…å­˜â€æ“ä½œå¯¹å¦ä¸€æ¡è¯­å¥æ˜¯å¯è§çš„ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("Happens-BeforeåŸåˆ™å¦‚ä¸‹ï¼š")])]),t._v(" "),s("ol",[s("li",[s("p",[t._v("ç¨‹åºæ¬¡åºè§„åˆ™ï¼šä¸€ä¸ªçº¿ç¨‹å†…ï¼ŒæŒ‰ç…§ä»£ç é¡ºåºï¼Œä¹¦å†™åœ¨å‰é¢çš„æ“ä½œå…ˆè¡Œå‘ç”Ÿäºä¹¦å†™åœ¨åÂ  Â é¢çš„æ“ä½œï¼›")])]),t._v(" "),s("li",[s("p",[t._v("é”å®šè§„åˆ™ï¼šä¸€ä¸ªunLockæ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹åŒä¸€ä¸ªé”é¢lockæ“ä½œï¼›")])]),t._v(" "),s("li",[s("p",[t._v("volatileå˜é‡è§„åˆ™ï¼šå¯¹ä¸€ä¸ªå˜é‡çš„å†™æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œï¼›")])]),t._v(" "),s("li",[s("p",[t._v("ä¼ é€’è§„åˆ™ï¼šå¦‚æœæ“ä½œAå…ˆè¡Œå‘ç”Ÿäºæ“ä½œBï¼Œè€Œæ“ä½œBåˆå…ˆè¡Œå‘ç”Ÿäºæ“ä½œCï¼Œåˆ™å¯ä»¥å¾—å‡ºæ“ä½œAå…ˆè¡Œå‘ç”Ÿäºæ“ä½œCï¼›")])]),t._v(" "),s("li",[s("p",[t._v("çº¿ç¨‹å¯åŠ¨è§„åˆ™ï¼šThreadå¯¹è±¡çš„start()æ–¹æ³•å…ˆè¡Œå‘ç”Ÿäºæ­¤çº¿ç¨‹çš„æ¯ä¸ªä¸€ä¸ªåŠ¨ä½œï¼›")])]),t._v(" "),s("li",[s("p",[t._v("çº¿ç¨‹ä¸­æ–­è§„åˆ™ï¼šå¯¹çº¿ç¨‹interrupt()æ–¹æ³•çš„è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºè¢«ä¸­æ–­çº¿ç¨‹çš„ä»£ç æ£€æµ‹åˆ°ä¸­æ–­äº‹ä»¶çš„å‘ç”Ÿï¼›")])]),t._v(" "),s("li",[s("p",[t._v("çº¿ç¨‹ç»ˆç»“è§„åˆ™ï¼šçº¿ç¨‹ä¸­æ‰€æœ‰çš„æ“ä½œéƒ½å…ˆè¡Œå‘ç”Ÿäºçº¿ç¨‹çš„ç»ˆæ­¢æ£€æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Thread.join()æ–¹æ³•ç»“æŸã€Thread.isAlive()çš„è¿”å›å€¼æ‰‹æ®µæ£€æµ‹åˆ°çº¿ç¨‹å·²ç»ç»ˆæ­¢æ‰§è¡Œï¼›")])]),t._v(" "),s("li",[s("p",[t._v("å¯¹è±¡ç»ˆç»“è§„åˆ™ï¼šä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆå…ˆè¡Œå‘ç”Ÿäºä»–çš„finalize()æ–¹æ³•çš„å¼€å§‹ï¼›")])])]),t._v(" "),s("p",[t._v("ä»¥ä¸Šçš„happens-beforeåŸåˆ™ä¸ºvolatileå…³é”®å­—çš„å¯è§æ€§æä¾›äº†å¼ºåˆ¶ä¿è¯ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("å¹¶å‘ç¼–ç¨‹ä¸‰å¤§ç‰¹æ€§ï¼š")])]),t._v(" "),s("ol",[s("li",[s("p",[t._v("å¯è§æ€§")])]),t._v(" "),s("li",[s("p",[t._v("åŸå­æ€§")])]),t._v(" "),s("li",[s("p",[t._v("æœ‰åºæ€§")])])]),t._v(" "),s("p",[s("strong",[t._v("å¹¶å‘ä¸‰ç‰¹æ€§æ€»ç»“")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[t._v("ç‰¹æ€§")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("volatile")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("synchronized")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("Lock")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("Atomic")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("åŸå­æ€§")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("æ— æ³•ä¿éšœ")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("å¯ä»¥ä¿éšœ")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("å¯ä»¥ä¿éšœ")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("å¯ä»¥ä¿éšœ")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("å¯è§æ€§")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("å¯ä»¥ä¿éšœ")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("å¯ä»¥ä¿éšœ")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("å¯ä»¥ä¿éšœ")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("å¯ä»¥ä¿éšœ")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("æœ‰åºæ€§")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("å¯ä»¥ä¿éšœ")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("å¯ä»¥ä¿éšœ")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("å¯ä»¥ä¿éšœ")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("æ— æ³•ä¿éšœ")])])])]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("ã€æ–‡ç« å‚è€ƒã€‘")]),t._v(" "),s("ol",[s("li",[s("p",[s("a",{attrs:{href:"https://baike.sogou.com/v6164.htm?fromTitle=CPU%E7%BC%93%E5%AD%98",target:"_blank",rel:"noopener noreferrer"}},[t._v("CPUç¼“å­˜ - æœç‹—ç™¾ç§‘"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://zh.wikipedia.org/wiki/%E7%BC%93%E5%AD%98",target:"_blank",rel:"noopener noreferrer"}},[t._v("ç¼“å­˜"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/73126227",target:"_blank",rel:"noopener noreferrer"}},[t._v("é¢è¯•å®˜æœ€çˆ±çš„volatileå…³é”®å­—ï¼Œä½ ç­”å¯¹äº†å—ï¼Ÿ"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://www.jianshu.com/p/068ca23c38ba",target:"_blank",rel:"noopener noreferrer"}},[t._v("JavaæŒ‡ä»¤é‡æ’åºä¸volatileå…³é”®å­—"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[t._v("Java Volatileå…³é”®å­—ã€å…¬ä¼—å·ï¼šå¹¶å‘ç¼–ç¨‹ç½‘ã€‘")])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"http://rrd.me/gDawW",target:"_blank",rel:"noopener noreferrer"}},[t._v("volatileçš„åŸç†åˆ†æ"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://blog.csdn.net/lsunwing/article/details/83154208?depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.nonecase",target:"_blank",rel:"noopener noreferrer"}},[t._v("volatileæ˜¯æ€ä¹ˆä¿éšœå†…å­˜å¯è§æ€§ä»¥åŠé˜²æ­¢æŒ‡ä»¤é‡æ’åºçš„"),s("OutboundLink")],1)])])])])}),[],!1,null,null,null);s.default=e.exports}}]);