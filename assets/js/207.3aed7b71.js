(window.webpackJsonp=window.webpackJsonp||[]).push([[207],{533:function(s,t,a){"use strict";a.r(t);var n=a(3),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[t("img",{attrs:{src:"https://images.unsplash.com/photo-1593642703013-5a3b53c965f6?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjkwODQwfQ",alt:"4 laptops with black background",title:"XPS"}})]),s._v(" "),t("h2",{attrs:{id:"_1-system-gc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-system-gc"}},[s._v("#")]),s._v(" 1. System.gc()")]),s._v(" "),t("p",[s._v("在默认情况下，通过"),t("code",[s._v("System.gc()")]),s._v("或者 "),t("code",[s._v("Runtime. getRuntime().gc()")]),s._v("的调用，会"),t("strong",[s._v("显式触发Full GC")]),s._v("，同时对老年代和新生代进行回收，尝试释放被丢弃对象占用的内存。")]),s._v(" "),t("p",[s._v("然而"),t("code",[s._v("System.gc()")]),s._v("调用附带一个免责声明，无法保证对垃圾收集器的调用")]),s._v(" "),t("blockquote",[t("p",[s._v("只是提醒JVM进行GC，不保证JVM一定会GC。类似于线程的优先级")])]),s._v(" "),t("p",[t("strong",[s._v("System.gc()不一定会立即进行垃圾回收：")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SystemCGTest")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SystemCGTest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//提醒JVM的垃级回收器执行gc，但是不确定是否马上执行gc")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("gc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("finalize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"重写finalize方法，对象自我拯救..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("不同的结果出现：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/imgs01/20200725110204.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/imgs01/20200725110219.png",alt:""}})]),s._v(" "),t("p",[t("code",[s._v("gc()")]),s._v("的底层实现是")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runtime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getRuntime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("gc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/imgs01/20200725110431.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("System.runFinalization会强制立即进行垃圾回收：")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SystemCGTest")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SystemCGTest")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//提醒JVM的垃级回收器执行gc，但是不确定是否马上执行gc")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("gc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//调用finalize(),强制GC立即进行垃圾回收")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("runFinalization")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("finalize")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"重写finalize方法，对象自我拯救..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("blockquote",[t("p",[s._v("只会出现：重写finalize方法，对象自我拯救...这一种结果")])]),s._v(" "),t("p",[t("code",[s._v("runFinalization()")]),s._v("会强制调用引用的对象的"),t("code",[s._v("finalize()")]),s._v("方法，而只在回收垃圾对象时GC才会调用"),t("code",[s._v("finalize()")]),s._v("，所以推导得出"),t("code",[s._v("runFinalization()")]),s._v("会使JVM立即进行垃圾回收")]),s._v(" "),t("br"),s._v(" "),t("p",[s._v("JVM实现者可以通过"),t("code",[s._v("System.gc()")]),s._v("调用来决定JVM的GC行为。而一般情况下，"),t("strong",[s._v("垃圾回收应该是自动进行的，无须手动触发")]),s._v("。")]),s._v(" "),t("p",[s._v("在些特殊情况下，如我们正在编写一个性能基准测试，保证起始点和空间够用，可以在运行之间调用"),t("code",[s._v("System. gc()")])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"_2-内存溢出"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-内存溢出"}},[s._v("#")]),s._v(" 2. 内存溢出")]),s._v(" "),t("p",[s._v("javadoc中对"),t("code",[s._v("OutofMemoryError")]),s._v("的解释是，"),t("font",{attrs:{color:"red"}},[s._v("没有空闲内存")]),s._v("，"),t("font",{attrs:{color:"#0686"}},[s._v("并且垃圾收集器也无法提供更多内存")]),s._v("。")],1),s._v(" "),t("p",[t("strong",[s._v("1. 没有空闲内存")])]),s._v(" "),t("p",[s._v("造成没有空闲内存的原因有二：")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("堆内存设置不够"),t("code",[s._v("-Xms")]),s._v("、"),t("code",[s._v("-Xmx")]),s._v("来调整")])]),s._v(" "),t("li",[t("p",[s._v("代码中创建了大对象，长时间存在引用而不能被垃圾回收器回收（内存泄漏）")])])]),s._v(" "),t("blockquote",[t("p",[s._v("永久代：java.lang.OutOfMemoryError：PermGen space")]),s._v(" "),t("p",[s._v("元空间：java.lang.OutOfMemoryError：Metaspace")])]),s._v(" "),t("p",[t("strong",[s._v("2. 无法提供更多内存")])]),s._v(" "),t("p",[s._v("意思就是GC回收了垃圾对象之后，仍然没有足够的内存空间来存储。GC完之后，才报OOM")]),s._v(" "),t("p",[t("strong",[s._v("【OOM举例】")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/imgs01/20200725150646.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"oom调试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#oom调试"}},[s._v("#")]),s._v(" OOM调试")]),s._v(" "),t("p",[s._v("【参数设置】")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("-Xms8m")]),s._v("（设置堆空间）")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("-Xmx8m")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("-XX:+HeapDumpOnOutOfMemoryError")]),s._v("("),t("strong",[s._v("OOM时导出Dump文件，进行分析")]),s._v(")")])])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * @Author: Mr.Q\n * @Date: 2020-08-05 11:58\n * @Description:堆空间OOM测试,dump快照分析\n *\n * -Xms8m\n * -Xmx8m\n * -XX:+HeapDumpOnOutOfMemoryError\n */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HeapOOM")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" bufffer "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//1MB")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HeapOOM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" list "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HeapOOM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HeapOOM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                count"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"count = "')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("p",[s._v("生成Dump文件，查看内存情况")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/imgs01/20200805121422.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/imgs01/20200805121514.png",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"_3-内存泄漏"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-内存泄漏"}},[s._v("#")]),s._v(" 3. 内存泄漏")]),s._v(" "),t("p",[t("strong",[s._v("内存泄漏Memory Leak")]),s._v("：对象不再使用了，但是GC又无法将其回收")]),s._v(" "),t("p",[s._v("尽管内存泄漏并不会立刻引起程序崩溃，但是一旦发生内存泄漏，程序中的可用内存就会被逐步蚕食，直至耗尽所有内存，最终出现 "),t("code",[s._v("OutofMemory")]),s._v("异常，导致程序崩溃。")]),s._v(" "),t("p",[s._v("内存泄漏"),t("strong",[s._v("可能")]),s._v("导致内存溢出，并不绝对。")]),s._v(" "),t("p",[s._v("注意，这里的存储空间并不是指物理内存，而是指"),t("strong",[s._v("JVM虚拟内存大小")]),s._v("，这个虚拟内存大小取决于磁盘交换区设定的大小。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/imgs01/20200725152701.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("【Memory Leak举例】")])]),s._v(" "),t("ol",[t("li",[t("p",[t("strong",[s._v("单例模式")]),s._v("。单例的生命周期和类是一样长的，因为是"),t("code",[s._v("static")]),s._v(" 类型。所以单例程序中，如果持有对外部对象的引用的话，那么这个外部对象是不能被回收的，则会导致内存泄漏的产生。")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("一些提供close的资源未关闭，导致内存泄漏")]),s._v("。数据库连接、网络连接Socket和 IO 连接必须手动close，否则是不能被回收的。")])])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"_4-常用的jvm参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-常用的jvm参数"}},[s._v("#")]),s._v(" 4. 常用的JVM参数")]),s._v(" "),t("p",[t("code",[s._v("-Xss2M")]),s._v(" ：设置JVM栈内存大小")]),s._v(" "),t("p",[t("code",[s._v("-Xms20M")]),s._v("：设置堆内存初始值")]),s._v(" "),t("p",[t("code",[s._v("-Xmx20M")]),s._v("：设置堆内存最大值")]),s._v(" "),t("p",[t("code",[s._v("-Xmn10M")]),s._v("：设置堆内存中新生代大小")]),s._v(" "),t("p",[t("code",[s._v("-XX:SurvivorRatio=8")]),s._v("：设置堆内存中新生代Eden 和 Survivor 比例")]),s._v(" "),t("p",[t("code",[s._v("-XX:PermSize=10M")]),s._v("：设置方法区内存初始值")]),s._v(" "),t("p",[t("code",[s._v("-XX:MaxPermSize=10M")]),s._v("：设置方法区内存最大值")]),s._v(" "),t("p",[t("code",[s._v("-XX:MaxDirectMemorySize=10M")]),s._v("：设置堆内存中新生代大小")]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"_5-再谈引用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-再谈引用"}},[s._v("#")]),s._v(" 5. 再谈引用")]),s._v(" "),t("blockquote",[t("p",[s._v("【面试题】：强引用、软引用、弱引用、虚引用有什么区别？具体使场景是什么？")])]),s._v(" "),t("p",[s._v("我们希望能描述这样一类对象：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("当内存空间还足够时，则能保留在内存中；")])]),s._v(" "),t("li",[t("p",[s._v("如果内存空间在进行垃圾收集后还是很紧张，则可以抛弃这些对象。")])])]),s._v(" "),t("p",[s._v("在JDK1.2版之后，Java对引用的概念进行了扩充，将引用分为")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("强引用（ Strong Reference）")])]),s._v(" "),t("li",[t("p",[s._v("软引用（ Soft Reference）")])]),s._v(" "),t("li",[t("p",[s._v("弱引用（ Weak Reference）")])]),s._v(" "),t("li",[t("p",[s._v("虚引用（ Phantom Reference）")])])]),s._v(" "),t("p",[s._v("4种，这种引用强度依次逐渐减弱")]),s._v(" "),t("p",[t("strong",[s._v("强引用（ StrongReference）")]),s._v("：传统定义的“引用”，即"),t("code",[s._v("Object obj = new Object()")]),s._v("这种引用关系。无论任何情况下，只要强引用关系还存在，"),t("font",{attrs:{color:"[[ff4d4f]]"}},[s._v("垃圾收集器就永远不会回收掉被强引用的对象")]),s._v("。")],1),s._v(" "),t("p",[t("strong",[s._v("软引用（ SoftReference）")]),s._v("：在系统"),t("u",[s._v("将要")]),s._v("发生内存溢出之前，将会把这些对象列入回收范围之中进行第二次回收。如果回收后还没有足够的内存，才会抛出内存溢出异常。"),t("font",{attrs:{color:"[[ff4d4f]]"}},[s._v("没有足够的内存空间才会回收")])],1),s._v(" "),t("p",[t("strong",[s._v("弱引用（ WeakReference）")]),s._v("：被弱引用关联的对象"),t("font",{attrs:{color:"[[ff4d4f]]"}},[s._v("只能生存到下一次垃圾收集之前")]),s._v("。当垃圾收集器工作时，无论内存空间是否足够，都会回收掉被弱引用关联的对象。")],1),s._v(" "),t("p",[t("strong",[s._v("虚引用（ PhantomReference）")]),s._v("：一个对象是否有虚引用的存在，完全不会对其生存时间构成影响，也"),t("font",{attrs:{color:"[[ff4d4f]]"}},[s._v("无法通过虚引用来获得一个对象的实例")]),s._v("。为一个对象设置虚引用关联的唯一目的就是——能在这个对象被收集器回收时收到一个系统通知，进行对象回收跟踪。")],1),s._v(" "),t("p",[t("img",{attrs:{src:"https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/imgs01/20200725181424.png",alt:""}})])])}),[],!1,null,null,null);t.default=e.exports}}]);